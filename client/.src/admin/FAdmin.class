' Gambas class file

' Copyright (C) 2008-2012 Drs. Richard Terry, Ian Haywood

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'-----------------------------------------------------------------------------------------
' PURPOSE         The main admin module which as the name suggests is
'                 for administrative functions
'                 FPreferencesAdminGlobal = pathways etc, global to program
'                 FImportLegacyData = import legacy data - not functioning
'                 FRoomSetup = setup for room peculiar settings eg printers
'                 FAdminRequests = set up who we send requests to, maintain request names
'                 FImportPostcodes = An (Austrlian at the moment) postcode import wizard
'                 FHL7Management = set up providers sending us HL7 or scanned docs
'                 FIXME this is then a misnomer
'                 FAdminVaccinations = set up vaccination schedules, add vaccine names
'HOW THIS WORKS   User clicks on the 'Admin' button on the main button bar
'                 FMain.btnSection_Admin_Click(), which instantiates this form and
'                 calls (Init) where only FPreferencesAdminGlobal is instantiated. All other
'                 forms are loaded when a particular tab is clicked on.
'SAVING SETTINGS  As this and its child forms are never 'closed' here, when the program
'                 finally quites, FMain.Settings_Save will save any settings changes
'                 There are no settings on this form to load.
'BUGS             Please report to rterry@pacific.net.au
'------------------------------------------------------------------------------------------
'Constants to describe the tabs on the main form
'-----------------------------------------------
Private Const cUsers As Integer = 0                         'Setup Users, permissions etc.
Private Const cGlobalPreferences As Integer = 1             'Global prefs such as location of hl7 downloads, scanned files     
Private Const cVaccination As Integer = 2                   'Setup vaccination schedules on a per-state basis or per user basis
Private Const cRequestMaintenance As Integer = 3            'Maintain requests e.g lists of requests, providers of services
Private Const cHL7Tools As Integer = 4                     'Tools to check hl7 eg check DIR to see if a file has been imported
Private Const cImport As Integer = 5                        'Iimport patients, legacy data, postcodes etc
Private Const cExport As Integer = 6                       'Export patient records
Private Const cDeveloper As Integer = 6                     'Temporary just for me to to be run/used 
Private Const cMedicareSchedule As Integer = 7              'medicare schedule of item numbers  
'-------------------------------------------------
'Constants to describe the tabs on tabstrip_import
'-------------------------------------------------
Private Const cPatientDemographicData As Integer = 0    
Private Const cCodingSystemData As Integer = 1   
Private Const cDrugData As Integer = 2   
Private Const cLegacyClinicalData As Integer = 3
Private Const cPostcodeData As Integer = 4   
'----------------------------     
'Declare forms to later embed
'----------------------------  
Private form_global_preferences As FAdminPreferencesGlobal  
Private form_import_patients As FImportPatientsWizard
Private form_developer_only As FDevelop 'only for richard's use REMOVE ME AT SOME STAGE RICHARD
Private form_import_legacy As FImportLegacyData
Private form_admin_requests As FAdminRequests
Private form_postcodes As FImportPostcodes
Private form_HL7Management As FHL7Management
Private form_admin_vaccines As FAdminVaccinations
Private form_admin_toolbar_images As FToolBarImages
Private form_staff As FStaff
Private form_medicare_schedule As FDescriptorsBrowser
Private form_import_coding_systems As FImportCoding

Public Sub Init()
   '---------------------------------------------------------------
   'Forms loaded only 'on-demand', so only want the one we see first
   'this routine is called from FMain.btnSection_Admin_Click()
   '----------------------------------------------------------------
   With Form_staff = New FStaff(Vbox_users)
      
   End With
   With form_global_preferences = New FAdminPreferencesGlobal(Vbox_GlobalPreferences)
      .Init()
   End With
   
End

Public Sub Settings_Save()
   '--------------------------------------------------------------------------
   'This is only ever called on program termination from FMain.Settings_Save()
   '--------------------------------------------------------------------------   

   Try form_import_patients.Settings_Save()
   Try form_global_preferences.Settings_Save()
   Try form_import_legacy.Settings_Save()
   Try form_admin_requests.Settings_Save() 'may not be loaded
   Try form_HL7Management.Settings_Save()
   Try form_admin_vaccines.Settings_Save()
   Try form_medicare_schedule.Settings_Save()
   Try form_import_coding_systems.Settings_Save()
   
End

Public Sub TabStrip1_Click()
   '--------------------------------------------------------------------
   'This is the main tabstrip on this form, load other forms 'on demand'
   '--------------------------------------------------------------------   
   
   Inc Application.Busy
   Select Case Tabstrip1.Index
         
      Case cImport
         If IsNull(form_import_patients) Then
            form_import_patients = New FImportPatientsWizard(Vbox_ImportPatients)
         End If
      Case cExport     
      Case cRequestMaintenance
         If IsNull(form_admin_requests) Then
            form_admin_requests = New FAdminRequests(Vbox_Requests)
            With form_admin_requests
               .Init()
            End With
         End If
      Case cHL7Tools
         If IsNull(form_HL7Management) Then
            With form_HL7Management = New FHL7Management(HBox_HL7Tools)
               .Init()
            End With
         Endif
      Case cVaccination
         If IsNull(form_admin_vaccines) Then
            form_admin_vaccines = New FAdminVaccinations(HBox_Vaccinations)
            form_admin_vaccines.Init()
         End If
       Case cMedicareSchedule
         If IsNull(form_medicare_schedule) Then
           With form_medicare_schedule = New FDescriptorsBrowser(HBox_MedicareSchedule) 
             .Init() 
           End With
           
         Endif
      ' Case cDeveloper
      '    If IsNull(form_developer_only) Then
      '       form_developer_only = New FDevelop(HBox_danger)
      '    End If
      ' ' Case cImages
      '    If IsNull(form_admin_toolbar_images) Then
      '       With form_admin_toolbar_images = New FToolBarImages(VBox_Images)
      '         .Init()
      '       End With
      '    End If   
   End Select
   Dec Application.Busy
End

Public Sub tabstrip_Import_Click()
   '-------------------------------------------
   'User has selected  Import from the main tab
   '-------------------------------------------
   Inc Application.Busy
   Select Case Last.Index
      Case cCodingSystemData
        If IsNull(form_import_coding_systems) Then
           form_import_coding_systems = New FImportCoding(Vbox_ImportCoding)
        End If 
      Case cDrugData 
      Case cLegacyClinicalData
         If IsNull(form_import_legacy) Then
            form_import_legacy = New FImportLegacyData(Vbox_ImportLegacy)
         End If
         
      Case cPostcodeData
         If IsNull(form_postcodes) Then
            form_postcodes = New FImportPostcodes(Vbox_ImportPostcodes)
         End If
         
   End Select
   Dec Application.Busy
End
