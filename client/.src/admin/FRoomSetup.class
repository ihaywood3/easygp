' Gambas class file
' Copyright (C) 2008,2009 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
' Amodule to allow setting up of room preferences such as printers
Private help As Collection
Private branches As Collection
Private fk_branch As Integer
Private fk_clinic As Integer

Public Sub form_Open()
   Init()
End

Public Sub form_Close()
  
  Settings_Save()
  
End
Public Sub Init()
  Help_Create()
  branches = modUtil.LoadCombo(cmbBranches, modAdminDBI.Clinics_Get(), "branch")


End



Public Sub SliderFont_Change()

  tlHelp.Font.size = Last.value

End

Private Sub Settings_Save()


  

End

Private Sub Settings_Load()


  

End


Public Sub Help_Create()
   tlhelp.text = "<html><head><title>Document Storage Site</title></head><body>"
 
   "<h2>Room Setup</h2>"
  "<p>This will tell EasyGP where how you wish to set up your clinic rooms."

      "<P><B>Default Printer</B><BR>."
      "<P>This should be the printer in your room you wish to use to print plain paper documents. "
      "Within EasyGP you can over-ride this at any time to print to any printer on the network."
      "<P><B>Script Printer</B><BR>."
      "<P>In many clinic rooms, the staff member will have to print to pre-formatted script paper.</P>"
      "<P>Please test your printers to ensure they are working satisfactorily before saving these defaults.</P>"
 
  End

Public Sub EditArea_Buttons_Click()

  Select Case Last.tag
  Case "new"
      Room_New()
  Case "save"
      Save()
  End Select
  

End

Public Sub EditArea_Clear()
  
  modEditAreaHelpers.EditArea_Clear(Vbox_EditArea)
  
End

Public Sub Room_New()
  EditArea_Clear()
  txtRoom.SetFocus()

  
End

Public Sub Save()
   '--------------------------------------------------------
   'Save defaults for a room - at this stage - just printers
   '--------------------------------------------------------
   Dim Room_Default As New Collection
   Room_Default!fk_clinic = fk_branch
   Room_Default!room = Trim(txtRoom.text)
   If cmbScriptPrinter.index <> -1 Then Room_Default!script_printer = cmbScriptPrinter.Text
   If cmbDefaultPrinter.index <> -1 Then Room_Default!default_printer = cmbDefaultPrinter.Text
   'modAdminDBI.
End
Public Sub Branch_Display()
   '--------------------------------------------------------------------
   'Display the branch highlighted in the branches combo in editing area
   
   'fixme combine with FGlobalPreferences
   '--------------------------------------------------------------------
   
  txtBranch_Street1.text = branches[cmbBranches.index]!street
  txtBranch_suburb.text = branches[cmbBranches.index]!town
  txtBranch_state.text = branches[cmbBranches.index]!state
  txtBranch_Postcode.text = branches[cmbBranches.index]!postcode
  fk_branch = branches[cmbBranches.index]!fk_branch 
  fk_clinic = branches[cmbBranches.index]!fk_clinic


End
Public Sub EditArea_Combo_Click()
 
   'fixme combine with FGlobalPreferences
    Branch_Display()

End

Public Sub tbTestPrinter_Click()
  Dim printername As String

  Select Case Last.tag
  Case "test plain"
   printername = const.available_printers[cmbDefaultPrinter.index]
   Shell "lp -d " & Left(printername, InStr(printername, ":") - 1) & " " & "templates/testpage.pdf" Wait
  Case "test script"
     printername = const.available_printers[cmbScriptPrinter.index]
     Shell "lp -d " & Left(printername, InStr(printername, ":") - 1) & " " & "templates/testpage.pdf" Wait
  End Select


End
