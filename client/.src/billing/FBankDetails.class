' Gambas class file

' Copyright (C) 2008-2016 Dr Ian Haywood, Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'
' A class to collect patients bank details to pass to medicare on-line
' These details are not saved in the back-end, a one-off task
'-----------------------------------------------------------------------------
'
Static Public account_number As String
Static Public bsb As String
Static Public account_name As String

Public Sub _new()
   
  lblMeasure.text = "Account Number     "
  modEditAreaHelpers.Resize_labels(Vbox_Editarea, lblMeasure)
   
End

Public Sub Form_Open()
   
  tbBSB.Text = bsb
  tbAcctName.Text = account_name
  tbAcctNum.Text = account_number 
   
End


Public Sub btnOK_Click()
   

   If Validate() Then 
     bsb = tbBSB.Text
     account_number = tbAcctNum.Text
     account_name = tbAcctName.Text
     Me.Close(True)
   Endif

End

Public Sub btnCancel_Click()

   Me.Close

End

Private Function Validate() As Boolean
   
   Dim re As RegExp
   Dim s As String
   
   If Trim(tbBSB.text) = "" Then Return
   s = Replace$(tbBSB.text, " ", "")
   s = Replace$(s, "-", "")
   re = New RegExp(s, "^[0-9]{6}$")
   If re.Offset = -1 Then
      Message.Error("BSB must be six digits")
      Return False
   Endif
   s = Replace$(tbAcctNum.Text, " ", "")
   s = Replace$(s, "-", "")
   re = New RegExp(s, "^[0-9]{4,10}$")
   If re.Offset = -1 Then
      Message.Error("Account number must be 5 to 10 digits")
      Return False
   Endif
   If Len(tbAcctName.Text) < 2 Then
      Message.Error("Must provide an account name")
      Return False
   Endif
   Return True
   
End

