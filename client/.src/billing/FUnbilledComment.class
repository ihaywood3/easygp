' Gambas class file

Private fk_appointment As Variant
Private GV As GridView
Private row_key As Integer
Private patient As Collection

Public Sub Run() As Boolean
   
   Return Not Me.ShowModal()
   
End

Public Sub Init(fk_app As Variant, gvw As GridView, the_key As Integer, P As Collection)
   
   fk_appointment = fk_app
   row_key = the_key 
   GV = gvw 
   patient = P
   
End

Public Sub btnOK_Click()
   
   Dim sFontHeight As Integer = GV.Font.Height

   If modDBConnect.update("clerical.bookings", Null, ["pk": fk_appointment, "comment_for_billing": Trim(txtcomment.text)]) Then
      modDBConnect.CommitTrans
      GV[row_key, 2].RichText = "<P><B>" & patient!title & " " & Left(patient!firstname, 1) & " " & patient!surname & "</B>"
      GV[row_key, 2].RichText &= "<BR>" & Trim(txtcomment.text) & "</P>"
      GV.Rows[row_key].Height = sFontHeight * 2.2  
      Me.Close(True)
   Else
      Message.Info("An error occurred trying to save the comment")
   Endif
   
End

Public Sub btnCancel_Click()
   
   Me.Close
   
End
