' Gambas class file

' Copyright (C) 2008-2014 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
Private form_archive As FArchiveDocuments
Private Form_ManageRecalls As FRecallManagement
Private form_StaffTasks As FStaffTasks
Private form_toohardbasket As FScanningTooHardBasket
Private form_record_visit As FRecordVisit
Private form_accountmanagement As FAccountManagement
Private form_Invoice As FRecordVisit
Private form_makeappointments As FMakeAppointments
Private Form_ReadOnly_Clinical As FCLericalReadOnlyClinical
Private Form_Contacts As FContacts
Private Form_Patients As FPatients
Private Const ctab_Appointments As Integer = 0
Private Const cTab_Invoices As Integer = 1
Private Const cTab_Scanning As Integer = 2
Private Const cTab_Patients As Integer = 3
Private Const cTab_Contacts As Integer = 4
Private Const cTab_Recalls As Integer = 5
Private Const cTab_Clinical As Integer = 6
Private Const Archive_current As Integer = 0
Private Const Archive_Legacy As Integer = 1
Static Private form_clerical As FClerical
Private tl As TextLabel

Static Public Sub Get_Main_Tab_Index() As Integer
   
   Return form_clerical.TabStrip1.Index
   
End

Public Sub Form_Open()
   
   form_clerical = Me
   TabStrip1.index = 0
   
   With form_makeappointments = New FMakeAppointments(VBox_Appointments)
      .Init()
   End With
   
End

Public Sub TabStrip1_Click()
   
   Dim sDir As String
   
   Select Case Last.Index
      Case cTab_Invoices                                                     'the main appointments/billing screen
         If IsNull(form_Invoice) Then
            With form_Invoice = New FRecordVisit(Vbox_Invoice)
               .Init()
            End With
         Endif
      Case cTab_Scanning                                                     ' do all the scanning here
         If Not modFiles.Dir_Working("document_scanning_directory") Then     'can't read or write to the directory
            If Not IsNull(tl) Then                                           'does the min-help textlabel exist yet                      
               If tl.tag = "scanning" Then Return                            'Yes, and its tag indicates clicked on same tab
            Else 
               With tl = New TextLabel(VBox_Scanning)                        'label is null, create it
                  .background = Color.White
                  .Expand = True 
                  .text = ""  
                  .Padding = 10
               End With     
            End If   
            With tl 
               .text = "<P><H3><B>Scanning Documents Directory</B></P>"
               .text &= "<P>Directory name: "
               .tag = "scanning"
               If sDir = "" Then    
                  .text &= " has not been set by Admin</P>"
               Else
                  .text &= sDir & " (System Default)<P>" & Mini_Help("scanning")
               End If  
               .Visible = True   
               .Reparent(VBox_Scanning) 
            End With
         Else
            Try tl.tag = ""
            Try tl.Hide                                                         'ok, now present, delete it if there
            If IsNull(form_archive)                                             'show the expected form
               With form_archive = New FArchiveDocuments(VBox_Scanning)
                  .Init()
               End With
            End If
         End If   
      Case cTab_Clinical                                                       ' Limited clinical patient data                    
         If IsNull(Form_ReadOnly_Clinical) Then
            With Form_ReadOnly_Clinical = New FCLericalReadOnlyClinical(VBox_Read_Only_Clinical)
               '.Init()
            End With
         Endif
         ' Case cTab_Documents
         '    If Not modFiles.Dir_Working("document_archiving_directory") Then
         '       If Not IsNull(tl) Then
         '          If tl.tag = "archived" Then Return    
         '       Else   
         '          With tl = New TextLabel(VBox_Read_Only_Clinical)
         '             .background = Color.White
         '             .Expand = True 
         '             .text = "" 
         '             .Padding = 10
         '          End With
         '       End If   
         '       With tl  
         '          .text = "<P><H3><B>Archived Documents Directory</B></P>"
         '          .text &= "<P>Directory name: "
         '          .tag = "archived"
         '          If sDir = "" Then    
         '             .text &= " has not been set by Admin</P>"
         '          Else
         '             .text &= sDir & " (System Default)<P>" & Mini_Help("document archiving")
         '          End If  
         '          .Visible = True    
         '          .Reparent(VBox_Read_Only_Clinical)
         '       End With
         '    Else
         '       Try tl.Hide  
         '       Try tl.tag = ""
         '       If IsNull(form_documentsimported) Then
         '          With form_documentsimported = New FDocumentsImported(VBox_Read_Only_Clinical)
         '             .Init()
         '          End With
         '       End If
         '    End If   
      Case cTab_Patients
         If IsNull(Form_Patients) Then
            Form_Patients = New FPatients(Vbox_Patients)
         Endif
      Case cTab_Contacts
         If IsNull(Form_Contacts) Then
            Form_Contacts = New FContacts(Vbox_Contacts)
         End If   
      Case cTab_Recalls
         If IsNull(Form_ManageRecalls) Then
            Form_ManageRecalls = New FRecallManagement(VBox_Recalls)
         Endif
         
   End Select
   ' Catch
   '  Return
   
End

Public Function Mini_Help(keyword As String) As String
   
   Dim stext As String
   
   sText = "<P>EasyGP was unable to read or write to the " & keyword & " directory.<P>" 
   "There could be several reasons for this, for example:"
   "<UL>"
   "<LI>Admin has not yet configured the pathway on your local or networked machine"
   "<LI>You may have network connection problems"
   "<LI>If using samba shares you may not have mounted the share correctly"
   "</UL>"
   "<P>Please fix the problem or discuss with your system administrator before accessing this section again</P>"
   "Please consult the help files Admin/Global Preferences section"
   Return sText
   
End

Public Sub Form_Close()
   
   form_clerical = Null
   form_archive = Null
   Form_ManageRecalls = Null
   form_StaffTasks = Null
   form_toohardbasket = Null
   'form_documentsimported = Null
   form_record_visit = Null
   form_accountmanagement = Null
   form_Invoice = Null
   form_makeappointments = Null
   
End

Public Sub Settings_Save()
   
   Try form_archive.Settings_Save()
   Try Form_ManageRecalls.Settings_Save
   Try form_record_visit.Settings_Save
   Try Form_ReadOnly_Clinical.Settings_Save
   Try Form_ReadOnly_Clinical.Settings_Save
End
