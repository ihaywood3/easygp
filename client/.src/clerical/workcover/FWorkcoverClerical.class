' Gambas class file

' Copyright (C) 2008-2015 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'--------------------------------------------------------------------------------
' PURPOSE        : Allow viewing/re-printing of workcover documents by staff
'                : Staff can also modify a limited subset of the workcover fields
'                  - the employer, the person's occupation, the claim number
'                    When this form is embedded in the clerical sections
'                    see: FClericalReadOnlyClinical
'--------------------------------------------------------------------------------

Private fk_patient As Integer
Private Patient As Collection
Private bExit As Boolean
Private Workcover_Forms As Collection
Private Form_Workcover As FWorkcoverNSW
Private regex As Regexp
Private CurrentConsult As CConsult
Private Obs As Observer
Private PDF_Form As FPdf

Static Private Form_Workcover_Clerical As FWorkcoverClerical

Public Sub _new()
   
   Form_Workcover_Clerical = Me
   With Form_Workcover = New FWorkcoverNSW(VBox_Workcover)
      .Visible = False
      .Set_Embedded_Form_Name("FWorkcoverClerical")
      .tbSave.Visible = True
   End With
   With PDF_Form = New FPdf(Vbox_PDf)                              'Pdf form to show any scanned doc's
      .BtOpen.Visible = False
      .BtPrint.Visible = True
      .BtPrint.Enabled = True 
      .btZoomIn.Visible = True
      .btZoomOut.Visible = True
   End With
   
End

Public Sub Set_Fk_Patient(fkp As Integer)
   
   fk_patient = fkp
   
End

Public Sub Set_Patient(cons As CConsult)
   'Called from FClericalReadOnlyClinical to display workcover forms and limited editing   
   
   CurrentConsult = cons
   Patient = CurrentConsult!patient

End

Static Public Sub Form_Display(pdf_filename As String)
   'Called from FWorkcoverNSW.Visit_Display()
   
   Form_Workcover_Clerical.WorkcoverForm_Display(pdf_filename)
   
End Sub

Public Sub WorkcoverForm_Display(pdf_filename As String)
   
   PDF_Form.Load_PDF(pdf_filename, False, False) 'do show error but don't delete temporary file (the same file can be re-used over/over again)
   
End


Public Sub Reload()
   
   With Form_Workcover
      If IsNull(currentConsult) Then
         currentConsult = New CConsult(patient, const.ConsultType_ClericalNote)
      Endif
      .Gui_Disable_For_Clerical_Use()
      .Init(currentconsult)
      .Visible = True
   End With
   ' tbSave.enabled = True  
   
End

Public Sub tbSave_Click()
   '---------------------------------------------
   'Saves changes (if any) to the workcover claim 
   '---------------------------------------------
   
End
