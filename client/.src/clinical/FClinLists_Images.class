' Gambas class file

Private Currentconsult As CConsult

Public Sub Init(cons As CConsult)
   
   Currentconsult = cons
   Images_Reload
   
End

Public Sub Current_Consult_Exists() As Boolean
   
   If Not IsNull(currentconsult) Then Return True 
   
End

Public Sub Gui_Clear()
   
   lcImages.Clear 
   currentconsult = Null
   
End

Public Sub lcImages_Menu()
   '------------------------------------
   'Show popup menu over the images list
   'fixme this does not exist
   '-------------------------------------   
   
   If lcImages.Count Then
      
   Endif
   
End

Public Sub lcImages_Click()
   
   '----------------------------------------------------------------------------------
   'User has clicked on one row of the list container - hence selecting a patient
   'put that patient into the current patient collection, and photo into patient_photo
   '----------------------------------------------------------------------------------
   Dim CP As Collection
   
   If lcImages.Count Then
      CP = Currentconsult!progress_notes_images[Last.children[Last.index].tag]
      If IsNull(CP!tag) Then
         FClinical.Editor_ShowPage_External("images", "Image:" & Str(CP!pk), CP)
      Else
         FClinical.Editor_ShowPage_External("images", CP!tag, CP)
      Endif
      
   Endif
   
End

Public Sub Images_Reload(Optional bRefresh As Boolean = False)
   '--------------------------------------------------
   'Displays list of patient images or force a reload
   '-------------------------------------------------
   
   Dim I As Collection
   Dim lcRow As CImageRow
   
   lcImages.Clear()
   If bRefresh Then Currentconsult.Refresh("progress_notes_images")
   For Each I In Currentconsult!progress_notes_images
      lcRow = New CImageRow(lcImages, I)
   Next
   
End
