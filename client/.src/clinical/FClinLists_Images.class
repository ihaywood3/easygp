' Gambas class file

' Copyright (C) 2014 Dr. Richard Terry
' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.
' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'-----------------------------------------------------------------------
' PURPOSE   to display images associated with the patients file
'-----------------------------------------------------------------------
Private Currentconsult As CConsult

Public Sub Init(cons As CConsult)
   
   Currentconsult = cons
   Images_Reload
   
End

Public Sub Current_Consult_Exists() As Boolean
   
   If Not IsNull(currentconsult) Then Return True 
   
End

Public Sub Gui_Clear()
   
   lcImages.Clear 
   currentconsult = Null
   
End

Public Sub lcImages_Menu()
   '------------------------------------
   'Show popup menu over the images list
   'fixme this does not exist
   '-------------------------------------   
   
   If lcImages.Count Then
      
   Endif
   
End

Public Sub lcImages_Click()
   
   '----------------------------------------------------------------------------------
   'User has clicked on one row of the list container - hence selecting a patient
   'put that patient into the current patient collection, and photo into patient_photo
   '----------------------------------------------------------------------------------
   Dim CP As Collection
   
   If lcImages.Count Then
      CP = Currentconsult!progress_notes_images[Last.children[Last.index].tag]
      If IsNull(CP!tag) Then
         FClinical.Editor_ShowPage_External("images", "Image:" & Str(CP!pk), CP)
      Else
         FClinical.Editor_ShowPage_External("images", CP!tag, CP)
      Endif
      
   Endif
   
End

Public Sub Images_Reload(Optional bRefresh As Boolean = False)
   '--------------------------------------------------
   'Displays list of patient images or force a reload
   '-------------------------------------------------
   
   Dim I As Collection
   Dim lcRow As CImageRow
   
   lcImages.Clear()
   If bRefresh Then Currentconsult.Refresh("progress_notes_images")
   For Each I In Currentconsult!progress_notes_images
      lcRow = New CImageRow(lcImages, I)
   Next
   
End
