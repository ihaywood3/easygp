' Gambas class file
' Copyright (C) 2008-2011 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
' Public Allergies As Collection
' Public patient As cPatient
' Public bediting As Boolean
' Public bEmbedded As Boolean
' Public bExit As Boolean
' Public currentallergy As cAllergy
Private currentconsult As CConsult
Private v As Variant 
Private fk_pasthistory As Integer
Private cProgressNote_Section As Integer

' Public Sub Form_Open()
' 
'    cmbDebug.Add("Current allergy", 0)
'    cmbDebug.Add("All allergies", 1)
'    Me.Center()
'    Init()
'   
' End
' 
' Public Sub EditArea_Set_Label_widths()
'    Dim HB As HBox
'    Dim aLabel As label
'    Dim hCtrl As control
'    lblMeasure.text = "Date Of Reaction " 
'     For Each hctrl In VboxEditArea.children
'       If hctrl Is HBox
'           HB = hctrl
'           For Each hctrl In HB.Children
'              If hCtrl Is Label Then
'                alabel = hCtrl
'                 If alabel.autoresize = False Then
'                     alabel.width = lblMeasure.Width
'                 End If
'                End If
'           Next
'       End If
'    Next
'    FMain.tbMeasure.Caption = "Generic Specific Reaction"
'    chkGenericSpecific.width = FMain.tbMeasure.Width
'   ' FMain.tbMeasure.Caption = "Sensitivity"
'   ' rbAllergy.width = FMain.tbMeasure.Width
'   ' rbSensitivity.width = FMain.tbMeasure.Width
'    'chkDefinate.width = FMain.tbMeasure.Width
' End
' 
' Public Sub cmbDebug_Click()
'    '--------------------------------------------------------
'   'Just here whilst debugging the code.
'   'If you are here you've clicked on the combobox at the top
'   '---------------------------------------------------------
'    Select Case cmbDebug.Index
'    Case 0
'       FClinical.teDebugOutput.Clear()
'    Case 1
'         FClinical.teDebugOutput.Clear()
'     End Select
'    
' End
' 
' Public Sub Form_Close()
'   '------------------
'   'Save splits layout
'   '------------------
'   Settings_Save()
' End
' 
Public Sub Init(cons As CConsult)
'   '--------------------------------
'   'Do all the initialization things
'   '--------------------------------
    Try Settings_Load()
'   EditArea_Set_Label_widths()
'   EditArea_Clear()
   currentconsult = cons  
 
   
End

Public Sub form_Close()
  
   Settings_Save()
  
End


Private Sub Settings_Save()


  

End

Private Sub Settings_Load()


  

End


Public Sub Form_Save()
  
   FClinical.Refresh_AllPreviousNotes()
  
End

' 
' Public Sub Settings_Save()
'    If bEmbedded Then
'        Settings["Allergies_Embedded/VSplit_Allergies.Layout"] = VSplit_Allergies.layout
'    Else
'        Settings["Allergies/VSplit_Allergies.Layout"] = VSplit_Allergies.layout
'     
'    End If
' 
' End
' 
' Public Sub Settings_Load()
'    If bEmbedded Then
'       VSplit_Allergies.layout = Settings["Allergies_Embedded/VSplit_Allergies.Layout"]
'    Else
'     VSplit_Allergies.layout = Settings["Allergies/VSplit_Allergies.Layout"]
'    
'    End If
' 
' End
' 
' 
' Public Sub EditArea_Clear()
'    'Clear the editing area, re-set current Allergy
'     bExit = True                                      'stop re-entrance into change routines
'     Vbox_EditArea.BackGround = Color.White             'remove red outline around edit area  ?remove colour leave red
'     Vbox_EditArea.Padding = 0                         
'     listview1.Visible = False                         'remove popup list if showing
'     txtDate.text = ""                            'clear the text boxes
'     txtProduct.text = ""
'     txtGeneric.text = "" 
'     txtClass.text = ""
'     gridview1.Columns.Count = 0
'     gridview1.Clear()
'     listview1.Clear()
'     listview1.Visible = False
'     '------------------------------------------------------------------
'     'Create new Allergy instance,fill with default values where possible
'     '------------------------------------------------------------------
'     currentAllergy = New cAllergy
'     currentAllergy.fk_reaction = const.ReactionType_Allergy
'     rbAllergy.value = True
'     chkGenericSpecific.Value = False
'     chkDefinate.Value = True
'     bEditing = False                'not in edit mode
'     txtDate.text = Format(Now, "dd/mm/yyyy")
'     txtProduct.SetFocus()
'     bExit = False
'  
' End
' 
' Public Sub txtEditArea_GotFocus()
' 
'    Last.BackGround = Color.rgb(95, 255, 175)
' 
' End
' Public Sub txtEditArea_LostFocus()
' 
'    Last.BackGround = Color.White
' 
' End
' 
' 
' 
' Public Sub rbEditArea_Click()
' 
'   
' Select Case Last.tag
' Case "allergy"
' Case "sensitivity"
' End Select
' 
' End
' 
' Public Sub chkEditArea_Click()
' Select Case Last.tag
' Case "generic specific"
' Case "definate"
' End Select
'   
' 
' End
' Public Sub listview1_KeyPress()
'   
'      If Key.code = Key.return Then
'      
'        listview1_DblClick()
'      End If
'   
' End
' Public Sub listview1_DblClick()
'      Select Case Last.tag.tag
'      
'      Case "product"
'          product_select()
'      Case "generic"
'      Case "class"
'      Case "reaction"
'      End Select
'     
'   
' End
' Public Sub product_select()
'     listview1.MoveCurrent
'     txtProduct.text = listview1.Item.Text
'     currentallergy.product = listview1.Item.Text
'     currentallergy.prodcode = listview1.Item.Key
'     ListView1.Visible = False
'     modAllergyDBI.Product_Generic_Class_Get(Me)
'     
'   
' End
' 
' Public Sub EditArea_Change()
'   Select Case Last.tag
'   Case "date"
'      If Len(Trim(txtDate.text)) Then
'       Try currentallergy.date_noted = Val(txtdate.text)
'      End If 
'   Case "product"
'        modAllergyDBI.Products_Get(txtProduct, listview1)
'   Case "generic"
'   Case "class"
'   End Select
' End
' 
' Public Sub Editarea_KeyPress()
'    Select Case Key.Code
'    Case Key.Down
'       If listview1.Visible Then
'            listview1.MoveFirst
'            listview1.Item.Selected = True
'            listview1.setfocus
'       End If
'    Case Key.Return
'    End Select
'    
' End
' 
' Public Sub EditArea_KeyRelease()
' 
'   Select Case Last.tag
'   Case "brand"
'   Case "generic"
'   End Select   
'   
' 
' End
' 
' Public Sub EditArea_GotFocus()
' 
'   Select Case Last.tag
'   Case "product"
'     With listview1
'       .left = txtProduct.Left
'       .top = HBox_Product.top + hBox_Product.Height
'       .width = HBox_Product.width / 2
'     End With
'   End Select
'   
' 
' End
' 
' 
' Public Sub EditAreaButtons_Click()
' 
'   Select Case Last.tag
'   Case "accept"
'   
'   Case "new allergy"
'        EditArea_Clear()
'   End Select
'   
' 
' End
' 
' Public Sub Button1_Click()
' 
' '  textbox1.text = columnview1.Columns[2].width
' 
' End

Public Sub Form_Open()

  

End


Public Sub mnuHealthIssues_Click()
   '---------------------------------------------------
   'User wants to link a request form to a health issue
   'The menu tag = the pk_pasthistory
   '---------------------------------------------------
  
  Select Case Last.tag
  Case "general notes", "remove link"
    txtHealthIssue.text = "General Notes"
    fk_pasthistory = 0
    cProgressNote_Section = const.cSection_GeneralNotes
  Case Else
    txtHealthIssue.text = currentconsult!past_history[Last.tag]!description
    fk_pasthistory = Last.tag
    cProgressNote_Section = const.cSection_Allergies
  End Select
End

Public Sub EditArea_Clear()

   modEditAreaHelpers.mnuHealthIssues_Refresh(currentconsult, mnuHealthIssues)
End
Public Sub EditArea_Resize_Labels()
   '-------------------------------------------------------------------
   'Adjust all lables as per current system font to make sure text fits
   '-------------------------------------------------------------------
   modEditAreaHelpers.Resize_labels(Vbox_EditArea_Outer, lblmeasure)
 End
