' Gambas class file

' Copyright (C) 2008-2012 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.

Private Nuitrition_Score As Integer 
Private Nuitrition_RedFlags As Collection
Private possible_problems As Collection 


Public Sub Form_Open()
  
  Init()
  
End
Public Sub Init()
   possible_problems = New Collection 
End

Public Function Nuitrition_RedFlags_Get() As Collection
  
  Return possible_problems
  
End

Public Function Nuitrition_Score_Get() As Integer
  
  Return Nuitrition_Score
  
End

Public Sub EditArea_TextBox_GotFocus()

 Last.BackGround = Color.rgb(95, 255, 175)

End

Public Sub EditArea_TextBox_LostFocus()

   Last.BackGround = Color.white


End


 Public Sub Nuitrition_Score_Calculate()
  '---------------------------------------------------
  '   validates at least 1 option button set
  '   checks all option buttons and calculates the total
  ' the tag of each option button is set to 1-5
  '-------------------------------------------------------
  Dim hCtrl As Control
 ' Dim lbl As Label
  Dim HBoxContainer As HBox
  Dim HBoxRadioButtonContainer As HBox
  Dim rb As RadioButton
  Dim possible_problem As String
  possible_problems = New Collection 
  Nuitrition_Score = 0
  For Each hctrl In VBox_Nuitrition.children
   If hctrl Is Hbox Then
       HBoxContainer = hCtrl
       possible_problem = HBoxContainer.tag
       For Each hctrl In HBoxContainer.Children
         If hctrl Is Hbox Then
            HBoxRadioButtonContainer = hCtrl
             For Each hctrl In HBoxRadioButtonContainer.children
                  If hctrl Is RadioButton Then
                     rb = hctrl
                     If rb.value = True And rb.tag <> "hidden" Then
                       ' If rb.name = "rbDenturesProblems" Then
                           'dentures were not scored in the RACGP sample
                           Nuitrition_Score += Val(rb.tag)
                       ' End If
                         If Val(rb.tag) <> 0 Then
                              possible_problems.Add(possible_problem, possible_problems.count)
                         End If
                         Break
                     End If
                  End If
             Next
         ' Else
            'The child is a label
           ' lbl = hctrl
          '  possible_problem = HBoxRadioButtonContainer.tag
           ' possible_problem = lbl.text
         End If   
      Next
   End If
  Next
 lblNuitritionScore.text = Str(Nuitrition_Score)
  If Nuitrition_Score < 4 Then
       lblNuitritionRisk.text = "(good)"
  Else If Nuitrition_Score > 5 Then 
         lblNuitritionRisk.text = "(high risk)"
  Else
         lblNuitritionRisk.text = "(moderate risk)"
  End If 
End 

Public Sub rbNuitrition_Click()
   '------------------------------
   'Calculate the nuitrition score
   '------------------------------
   Nuitrition_Score_Calculate()
   
End

Public Sub EditArea_Clear()
  rbNuitrition_Clear()
 ' modEditAreaHelpers.EditArea_Clear(VBox_Nuitrition)
  
End
Public Sub rbNuitrition_Clear()
  '---------------------------------------------------
  ' re-sets all the radiobuttons for nuitrition
  ' should be removed and use modEditAreaHelpers but
  ' it wouldn't work for some reason
  '-------------------------------------------------------
  Dim hCtrl As Control
  Dim HBoxContainer As HBox
  Dim HBoxRadioButtonContainer As HBox
  Dim rb As RadioButton
  
  For Each hctrl In VBox_Nuitrition.Children
   If hctrl Is Hbox Then
       HBoxContainer = hCtrl
       For Each hctrl In HBoxContainer.Children
         If hctrl Is Hbox Then
            HBoxRadioButtonContainer = hCtrl
            For Each hctrl In HBoxRadioButtonContainer.children
             
                  If hctrl Is RadioButton And hctrl.tag = 6 Then 
                     rb = hctrl
                     rb.value = True 
                      Break
                  
                  End If
             Next
         End If   
       Next
   End If
  Next

End  

Public Sub rbNuitrition_Leave()

  modEditAreaHelpers.Hightlight_Label(Last.parent.parent, False)

End
Public Sub rbNuitrition_Enter()

  modEditAreaHelpers.Hightlight_Label(Last.parent.parent, True)

End

Public Sub Button1_Click()

End
