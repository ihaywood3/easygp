' Gambas class file





' Gambas class file
' Copyright (C) 2008-2011 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
Public $himage As Image

Public Sub Form_Open()

End



Public Function Image_Save(ImagePath As String, tablename As String, Optional fk_Image As Integer = 0) As Integer
'   '------------------------------------------------
'   'Saves an image file to tablename
'   'return its key
'   '------------------------------------------------
'   Dim hFile As Stream
'   Dim buffer As Byte
'   Dim picText As String
'   Dim img As Image
'   Dim newPicture As Result
'   Dim pictureData As String
'   Dim scale As Float
'   Dim sql As String
'  
' '  hfile = Open ImagePath For Input 'As #hfile
'  ' hfile = Open ImagePath For Read 'As #hfile"
'    hfile = Open ImagePath For Input 'As #hFile
'     While Not Eof(hFile)
'       Read #hFile, buffer, Lof(hFile)
'       
'       If buffer < 32 Or buffer > 126 Then
'           picText = picText & "\\\\" & modConsultDBI.Coct(buffer)
'       Else
'         Select buffer
'           Case 92    ' mask  "|" char
'             picText = picText & "\\\\134"
'           Case 39    ' mask "'" char
'             picText = picText & "\\'"
'           Default
'             picText = picText & Chr$(buffer)
'         End Select
'       End If
'     Wend
'   Close #hFile
'    '-----------------------------------
'    'Start transaction, insert the piccie
'    '------------------------------------
'    If fk_image Then
'      sql = "UPDATE " & tablename & " SET image = "
'      sql &= "E'" & picText & "'"
'      sql &= " WHERE  pk = " & fk_image
'      $Result = modDBConnect.exec_query(sql)
'      Return fk_image
'    Else
'     sql = "insert into " & tablename & "(image) "
'     sql &= "values(E'" & picText & "') returning pk"
'     $Result = modDBConnect.exec_query(sql)
'     Return $Result!pk
'    End If
'   
   
End

Public Sub Button1_Click()

    Dim tempfile As String
    Dim sql As String
   ' Image_Save()
    'Return 
   '-----------------------------------------------------------
   'Load a file and insert into the editor either image or text
   'todo -the text
   '-----------------------------------------------------------
   Dialog.Title = "Select Image File"
   Dialog.Filter = ["*.png", "Image Files", "*", "All files"]
'   If Dialog.OpenFile() Then Return
   '----------------------------------------------------
   'Ok, check this is a valid image (e.g they could have
   'changed the file selector to any file
   '-----------------------------------------------------
 '  Try FImageGet.$hImage = Image.Load(Dialog.Path)
   '  PictureBox1.Picture = Picture.Load(Dialog.Path)
     Wait
     modDBConnect.BeginTrans()
     modConsultDBI.Image_Save("/tmp/gambas.1000/2359/2.tmp.png")
     modDBConnect.CommitTrans()
   '  sql = "INSERT INTO temp_images VALUES( 'Dialog.Path', lo_import('"
    ' sql = "INSERT INTO temp_images(image) VALUES( '"
   '  sql &= Dialog.Path & "')" 
    ' sql = " INSERT INTO demo_blob(name, image) VALUES('test', lo_import('/tmp/gambas.1000/1956/1.tmp.png'))"
   '  sql = "Select lo_creat(-1)"
   '  modDBConnect.exec_query(sql)
    ' sql = "Select lo_creat(-1) lo_import('/tmp/gambas.1000/1956/1.tmp.png')"

    ' modDBConnect.exec_query(sql)
     modDBConnect.CommitTrans()
     
   ' If Not Error Then 
   '    ' FImageGet.ShowModal()       
   '   '  Insert_Picture1("clipboard")
   ' Else
   '   ' Try teNotes.Insert(File.Load(Dialog.Path))
   '    PictureBox1.Picture = Picture.Load(Dialog.Path)
   '    If Error Then
   '       Message.Info("An error occurred whilst trying to insert the file.\n")
   '    End If
   ' End If
   ' 


End

Public Sub Button3_Click()

 ' Public Function Image_get(pk_image As Integer) As String
  Dim $Result As Result
  Dim tempFile As String
  Dim tempPicture As Variant
  $Result = modDBConnect.exec_query("Select * from temp_images WHERE pk=1")
   If $Result.count Then
      tempFile = Temp() & ".png"
      tempPicture = $Result!image
       If tempPicture.data Then 
         File.Save(tempFile, tempPicture.data)
      End If
   End If



End
