' Gambas class file

' Copyright (C) 2008-2016 Dr Richard TERRY

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'----------------------------------------------------------------------
' PURPOSE      A form to present the GPCOG dementia screen
' LICENCE      http://www.gpcog.com.au/faq.php#C1
'
' 2. What are the costs for using the GPCOG?
' 
' The GPCOG is free for clinicians and researchers.
' Use of the website or downloading the paper-and-pencil test doesn't cost anything. 
' However, we do ask you not to change any content of the GPCOG and also to have the original reference printed on the worksheets
' (Brodaty et al, JAGS 2002; 50:530-534). Commercial companies seeking permission to use the GPCOG should write to gpcog@unsw.edu.au.  
' 
' 3. Can I reprint the GPCOG?
' 
' If you are using the GPCOG for clinical purposes, you can download and print out as many copies of the paper GPCOG in as many languages as you wish.
' You can also access the website and administer the web-based GPCOG as many times as you wish.
' However, if you intend to re-print the GPCOG for your own research articles, published work or website,
' we ask you to seek permission from the Journal of the American Geriatrics Society.
' We also ask you to acknowledge the authors of the original GPCOG publication in any publication arising from your research work with the GPCOG. 
' 

' GPCOG Patient Examination
' Unless specified, each question should only be asked once.
' Name and address for subsequent recall
' "I am going to give you a name and address. After I have said it, I want you to repeat it. Remember this name and address because I am going to ask you to tell it to me again in a few minutes: John Brown, 42 West Street, Kensington"
' 
' (Allow a maximum of 4 attempts but do not score yet)
' Time Orientation
' What is the date? (accept exact only)	
' Clock Drawing (visuospatial functioning) use a paper with a printed circle.
' Please mark in all the numbers to indicate the hours of a clock (correct spacing required).	
' For a correct response (above), the numbers 12, 3, 6, and 9 should be in the correct quadrants of the circle
' and the other numbers should be approximately correctly placed.
' Please mark in hands to show 10 minutes past eleven o'clock (11:10).	
' For a correct response (above), the hands should be pointing to the 11 and the 2,
' but do not penalise if the respondent fails to distinguish the long and short hands.
' Information
' Can you tell me something that happened in the news recently? (recently = in the last week)	
' Respondents are not required to provide extensive details, as long as they demonstrate awareness of a recent news story. 
' If a general answer is given, such as "war", "a lot of rain", ask for details.
' If unable to give details, the answer should be scored as incorrect.
' Recall
' What was the name and address I asked you to remember?
' Score 1 for each of the 5 components - John, Brown, 42, West Street, Kensington.	
'   GPCOG Patient Score =  /9	
' GPCOG Informant Interview
' Ask the informant: "Compared to a few years ago"
' Does the patient have more trouble remembering things that have happened recently?	
' Does he or she have more trouble recalling conversations a few days later?	
' When speaking, does the patient have more difficulty in finding the right word or tend to use the wrong words more often?	
' Is the patient less able to manage money and financial affairs (e.g., paying bills, budgeting)?	
' Is the patient less able to manage his or her medication independently?	
' Does the patient need more assistance with transport (either private or public)?	
' Score 1 point for each "no" answer.
'   Informant Score =  /6	
' Combined (overall) score =  /15
'
'----------------------------------------------------------------------
Private currentconsult As CConsult
Private total As Integer
Private total_informant As Integer
Private yes_button_already_clicked As Integer
Private yes_button_already_clicked_informant As Integer
Private bExit As Boolean

Public Sub Init(cons As CConsult)
   
   currentconsult = cons
   Build_Form() 
   tbReset_Click
End

Public Sub Build_Form()
   '   "This is a new screening test developed in Australia for use in general practice. It is shorter than the "
   ' "MMSE and incorporates the clock drawing test. Only if the test result is in the doubtful "
   ' "area does it need to include some additional information to be obtained from a suitable informant.</P>"
   ' ""
   ' "<B>Scoring</B>"
   ' "Add correct scores from items 2-6:"
   ' "<UL><LI>9 = cognitively intact – no need for informant interview"
   ' "<LI>4 or less = cognitively impaired – no need for informant interview"
   ' "<LI>5-8 = uncertain – needs informant interview"
   ' "</UL>"
   ' "<P><B>Informant interview score:</B> No, 3 or less = cognitively impaired</P>"
   ' "<B>Reference</B><I> Brodaty H, Pond D et al. The GPCOG: a new screening test for dementia designed for general practice."
   ' "J Am Geriatric Soc 2002; 50: 530-34</I>"
   ' 
   
   TextLabel1.text = ""
   "<P ALIGN=CENTER><B>Score answers correct yes/no</B> - "
   "Unless specified, Each question should only be asked once.</P>"
   textLabel2.text = ""
   "<P ALIGN=LEFT><i> I am going to give you a name And address. " 
   "After I have said it, I want you to repeat it. Remember this name "
   "and address because I am going to ask you to tell it to me again in "
   "a few minutes: </I>John Brown 42 West Street Kensington. (Score at the end of test). </P>"
   textLabel3.text =
      "<P ALIGN=LEFT>What is the Date</P>"
   textLabel4.text =
      "<P ALIGN=LEFT><STRONG><I><SPAN STYLE=\"font-weight: normal\">Please "
   "mark in all the numbers to indicate the hours of a clock</SPAN></I></STRONG></P>"
   textLabel5.text =
      "<P ALIGN=LEFT><STRONG><I><SPAN STYLE=\"font-weight: normal\">"
   "Please mark in hands io show 10 minutes past eleven o'clock (11:10)</SPAN></I></STRONG></P>"
   tlNews.text = "" 
   "<P ALIGN=LEFT><STRONG><I><SPAN STYLE=\"font-weight: normal\">"
   " Can you tell me something that happened In the news recently?(recently = In the last week)</SPAN></I></STRONG></P>"
   
   tlNews.text = "" 
   "<P ALIGN=LEFT><STRONG><I><SPAN STYLE=\"font-weight: normal\">"
   "What was the name and address I asked you to remember?</P>"
   
   lblInstructions_Q1.text = "<P><B>Name and address for subsequent recall</B> (Allow a max 4 attempts)</P>"
   lblInstructions_Q2.text = "<P><B>Time Orientation</B><BR>Exact date only allowed</P>"
   lblInstructions_Q3.text = "<P><B>Clock Drawing Visuospacial Functioning</B><BR>Use a paper with a printed circle<BR>"
   "For a correct response, the numbers 12, 3, 6, and 9 should be in the correct quadrants of the circle"
   "and the other numbers should be approximately correctly placed.</P>"
   lblInstructions_Q4.text = "<P>For a correct response, the hands should be pointing to the 11 and the 2,"
   "but do not penalise If the respondent fails to distinguish the long and short hands.</P>"
   
   tlNews.text = "Can you tell me something that happened in the news recently? "
   textlabel12.text = "What was the name and address I asked you to remember?"
   lblInstructions_News.text = ""
   "<P>Respondents are not required to provide extensive details, as long as they demonstrate awareness of a recent news story. "
   "If a general answer is given, such as \"war\", \"a lot of rain\", ask for details."
   "If unable to give details, the answer should be scored as incorrect.</P>" 
   lblInstructions_RecallAddress.text = "Score for each of the 5 components "
   lblInstructions_Informant.text = "Ask the informant: 'Compared to a few years ago'..."
   tlInformantQ1.width = tlNews.Width
   
End

Public Sub Add_Score()
   
End

Public Sub Decision_support()
   '--------------------------------------------------------------------------
   'Displays 'entry level' first point of contact basic how to use this module
   'to develop a good mental health plan
   '---------------------------------------------------------------------------
   
   modUtilGUI.Decision_Support_Help_Show(General_Help(), "GPCOG - General Help")
   
End

Public Function General_Help() As String
   
   Dim help As String
   
   help = ""
   "<P><B>What is the purpose of the GPCOG?</B></P>"
   "The GPCOG is a screening instrument rather than a diagnostic test. It is very brief but at the same "
   "time very sensitive to detect cognitive impairment. However, this does not mean that the GPCOG is perfect "
   "in detecting cases. It might miss cases (false negatives) or misclassify someone as cognitive impaired even "
   "though they are fine (false positives). The chances to do so are very little though and depend on the prevalence "
   "of cognitive impairment in the given population."
   "<P><B>Scoring the questions</B><BR><UL>"
   "<LI>0-4/9 = cognitive impairment do usual investigations"
   "<LI>5-8/9 = do the informant interview" 
   "<LI>9/9   = no cognitive impairment"
   "</UL><p>"
    "<P><B>Scoring the Informant Interview</B><BR><UL>"
   "<LI> 0 to 3 in the informant interview in conjunction with a score of 5 to 8 in the patient interview indicates cognitive impairment"
   "<LI>difficulties in less than 3 areas (i.e. score of 4 to 6) he/she can be considered cognitively intact for the time being" 
    "</UL><p>"
   "<p><b>Things to keep in mind when administering</B><P>"
   "<P>In general, the"
   "administration of the GPCOG is very simple. However, there are some"
   "basic things to bear in mind:</p>"
   "<ul>"
   "<li/>"
   "If you are administering the "
   "GPCOG for the first time it might be a good idea to familiarise"
   "yourself with both the paper-and-pencil and the web-based GPCOG"
   "prior to first administration to allow for a smooth flow of the"
   "test. There is a training video available for you to watch online if"
   "you wish. Just click <a href=\"http://gpcog.com.au/video.php\">here</a>."
   "<li/>"
   "Make sure, patients are wearing their glasses / hearing aids If applicable "
   "<li/>"
   "Unless specified, each question should only be asked once."
   "<li/>"
   "Read out each question as it is presented On the screen"
   "<li/>"
   "Speak clearly and slowly. "
   "<li/>"
   "Keep disturbances and "
   "interruptions at a minimum. For instance have a &quot;Please do not"
   "disturb&quot; sign up on your door. "
   "<li/>"
   "When interviewing a carer/informant, make sure that you"
   "only score patient difficulties that have been a change compared to"
   "a few years ago. "
   "</ul>"
   "<p><b>Do I have to complete the informant interview?</b></P>"
   "If the patient scores 5 to 8 out of 9 in the cognitive assessment, you "
   "do have to complete the informant interview to obtain more "
   "information about the patient's abilities. Please "
   "note that you do not have to complete the informant interview the"
   "same day though. You can also complete it over the phone if that is"
   "more convenient.<BR>"
   "If the patient scores 9 or 0 to 4 out of 9 the "
   "informant interview is not mandatory. However, you may conduct it if"
   "you wish</p>"
   Return help
   
End



Public Sub RadioButtons_Click()
   
   If bexit Then Return
   If Last.tag = "yes" Then total += 1
   If yes_button_already_clicked Then       'no button was set to true
      If Last.tag = "no" Then total -= 1 
   End If   
   lblScore.text = Str(total)
   yes_button_already_clicked = False   
   
End

Public Sub RadioButtons_MouseDown()
   
   Dim rb As RadioButton
   Dim hCtrl As Control
   If bexit Then Return
   For Each hCtrl In Last.parent.children       
      If hctrl Is RadioButton Then 
         rb = hctrl
         If rb.tag = "yes" Then                    
            If rb.value = True Then
               yes_button_already_clicked = True
               Break
            End If
         End If   
      Endif
   Next
   
End

Public Sub rbRecallAddress_MouseDown()
   
   Dim rb As RadioButton
   Dim hCtrl As Control
   
   If bexit Then Return
   For Each hCtrl In Last.parent.children       
      If hctrl Is RadioButton Then 
         rb = hctrl
         If rb.tag = "no" Then                    
            If rb.value = True Then
               yes_button_already_clicked = True
               Break
            End If
         End If   
      Endif
   Next
   
End

Public Sub rbRecallAddress_Click()
   
   If bexit Then Return
   If Last.tag = "yes" Then total += 1
   If yes_button_already_clicked Then       'no button was set to true
      If Last.tag = "no" Then total -= 1 
   End If   
   lblscore.text = Str(total)
   yes_button_already_clicked = False 
   
End

Public Sub rbInformant_MouseDown()
   
   Dim rb As RadioButton
   Dim hCtrl As Control
   
   If bExit Then Return
   For Each hCtrl In Last.parent.children       
      If hctrl Is RadioButton Then 
         rb = hctrl
         If rb.tag = "no" Then                    
            If rb.value = True Then
               yes_button_already_clicked_informant = True
               Break
            End If
         End If   
      Endif
   Next
   
End

Public Sub rbInformant_Click()
   If bExit Then Return
   If Last.tag = "no" Then total_informant += 1
   If yes_button_already_clicked Then       'no button was set to true
      If Last.tag = "yes" Then total_informant -= 1 
   End If   
   lblScore.text = Str(total)
   yes_button_already_clicked_informant = False 
   
End

Public Sub tbReset_Click()
   bExit = True
 
   RadioButton1.value = False 
   RadioButton2.value = False 
   RadioButton3.value = False 
   RadioButton4.value = False 
   RadioButton5.value = False 
   RadioButton6.value = False 
   RadioButton7.value = False 
   RadioButton8.value = False 
   RadioButton9.value = False 
   RadioButton10.value = False 
   RadioButton11.value = False 
   RadioButton12.value = False 
   RadioButton13.value = False 
   RadioButton14.value = False 
   RadioButton15.value = False 
   RadioButton16.value = False 
   RadioButton17.value = False 
   RadioButton18.value = False 
   RadioButton19.value = False 
   RadioButton20.value = False 
   RadioButton21.value = False 
   RadioButton22.value = False 
   RadioButton23.value = False 
   RadioButton24.value = False 
   RadioButton25.value = False 
   RadioButton26.value = False 
   RadioButton27.value = False 
   RadioButton28.value = False 
   RadioButton29.value = False 
   lblScore.text = 0
   bExit = False
End
