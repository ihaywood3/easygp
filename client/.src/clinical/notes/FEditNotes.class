' Gambas class file

' Copyright (C) 2008-2011 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'-------------------------------------------------------------------------
' PURPOSE   An exerimental form to allow editing of consults data <> today
'-------------------------------------------------------------------------
Private currentconsult As CConsult  
Private progressnote As Collection

Public Sub Init(Cons As CConsult)
   currentconsult = Cons
   Load_Notes()
   
End

Public Sub Load_Notes()
   Dim NotesViewer As WebView
   Dim NotesEditor As TextEdit
   Dim sep As Separator
   Dim HB As HBox        'container to hold each days notes
   Dim tl As TextLabel
   Dim last_fk_consult As Integer
   Dim fk_consult As Integer
   Dim NotesBox As VBox
   Dim sNotesHtml As String
   Dim Editor As FEditor
   
    tlMeasure.width = lcNotes.Width - 300
 For Each progressnote In currentconsult!progress_notes
     With HB = New HBox(lcNotes)
      ' .Expand = True  
       .width = lcNotes.Width
     '  .height = 150
       .AutoResize = True
       .Padding = 1
       .Background = Color.White
     End With
     With tl = New TextLabel(HB) As "lcNotes_Date"
       .width = 120
       .Font.Bold = True   
       .Expand = False   
       .Background = Color.white
       If last_fk_consult <> progressnote!fk_consult Then
          .text = "<P STYLE=\"background: #ffffff\"><FONT COLOR=\"#000000\">" & Format(progressnote!consult_date, "dd/mm/yyyy") & "</FONT></P>"
          last_fk_consult = progressnote!fk_consult
       End If  
     End With 
     sNotesHtml = modConsultDBI.Images_Get(progressnote!notes)
     tlMeasure.text = "<P STYLE=\"background: #ffffff\"><FONT COLOR=\"#000000\">" & sNotesHtml & "</FONT></P>"
     With NotesBox = New VBox(HB)
       .Expand = True 
       .height = tlMeasure.Height + 20
     End With
 
     With NotesViewer = New Webview(NotesBox) As "WebView_Notes"
        .html = sNotesHtml
       .tag = progressnote 
       .Expand = True   
       .Background = Color.white
     End With
     With Editor = New FEditor(NotesBox)
       .Visible = False 
       .lblHeading.visible = False  
       .teNotes.RichText = sNotesHtml
       .Border = False  
     End With
     ' With sep = New Separator(NotesBox)
     '   .height = 3
     ' End With
   ' sCurrentDate = Format(progressnote!consult_date, "dd/mm/yyyy")
     listview1.Add(progressnote!pk_progressnote, Format(progressnote!consult_date, "dd/mm/yyyy"))
     
 Next 
   
End

Public Sub WebView_Notes_dblClick()
    Dim hctrl As Control
    Dim TE As FEditor
    
    Last.Visible = False   
    For Each hCtrl In Last.parent.children
      If Hctrl Is FEditor Then
         TE = Hctrl 
         TE.DataChange_Update_Indicators(False)
         TE.Visible = True 
         Te.SetFocus()
         Break
      Endif
    Next
   
End

Public Sub Settings_Save()
   
   
   
End
Public Sub Settings_Load()
   
   
   
End
