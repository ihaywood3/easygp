' Gambas class file

Private template As CRow
Private Embedded_In_Form As String
Private pk_template As Integer

Public Sub Run() As Boolean
   
   Return Not Me.ShowModal()
   
End

Public Sub Set_Embedded_In_Form(form_name As String)
   
   Embedded_In_Form = form_name    
   
End

Public Sub Init(shtml As String, Optional template_key As Integer, Optional template_name As String) 'fixme fix progressnote editor to pass this then remove the options
   '----------------------------------------
   'Expects the html of the richtext control
   '----------------------------------------

   Template = New CRow
   If template_key Then
      Template.put_unchanged(template_key, "pk_template")
   Endif
   Template!fk_staff = modDBConnect.currentUser!fk_staff
   Template!template = shtml
   Template!shared = False 
   txtTemplateName.text = template_name   
   
End

Public Sub btnOK_Click()
   
   If txtTemplateName.text = "" Then
      txtTemplateName.SetFocus() 
   Else
      Template!name = Trim(txtTemplateName.text) 
   Endif
   Select Case Embedded_In_Form 
      Case "FProgressNoteEditor" 
         modProgressNotes.Templates_Save(template)
      Case "FReferrals"
         modReferralsDBI.Templates_Save(template)
   End Select
   modDBConnect.CommitTrans()
   
   Me.Close(True)
   
End

Public Sub btnCancel_Click()
   
   Me.Close
   
End

Public Sub txtTemplateName_LostFocus()
   
   Last.background = Color.White 
   
End

Public Sub txtTemplateName_GotFocus()
   
   Last.BackGround = Color.rgb(95, 255, 175)
   
End
