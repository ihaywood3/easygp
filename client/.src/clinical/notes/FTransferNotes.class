' Gambas class file

' Copyright (C) 2008-2011 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'----------------------------------------------------------------------------
'PURPOSE          Allow transfer of a progress note to another persons file
'                 with appropriate audit trail. This allows for the situation
'                 where one writes in the wrong file
'-------------------------------------------------------------------------
Private From_Patient As Collection
Private To_Patient As Collection
Private To_Patient_Row As CPatientSelectRow

Public Sub Run() As Boolean
   
   Return Not Me.ShowModal()
   
End

Public Sub Form_Open()
   
   Me.Center
   Me.Title = "TRANSFER CLINICAL NOTES"
End

Public Sub Init(fp As Collection, Notes As String)
   
   Dim FPR As CPatientSelectRow
   
   WebView1.HTML = Notes
   From_Patient = fp 
   FPR = New CPatientSelectRow(ListContainer1, fp)
   With ColumnView1
      .Columns.count = 3 
   End With
   
End

Public Sub btnOK_Click()
   
   Me.Close(True)
   
End

Public Sub btnCancel_Click()
   
   Me.Close
   
End

Public Sub EditAreaTextBox_GotFocus()
   
   Last.BackGround = Color.rgb(95, 255, 175)
   With ColumnView1  
      .top = Last.Parent.Parent.top
      .left = Last.Parent.Left
      .width = Last.width
      .Visible = False   
      .Raise() 
   End With
   
End

Public Sub Patients_Find() 
   
   Dim AllPatients As New Collection
   Dim patient As Collection
   Dim sql_in_english As String
   Dim P As Picture
   Dim bPhotoConfirmed As Boolean = False 
   
   Inc Application.Busy
   
   AllPatients = modContactsDBI.patients_get_firstname_surname(Trim(txtFindPatient.text))
   sql_in_english = AllPatients!sql_in_english
   AllPatients.Remove("sql_in_english")
   If AllPatients.count = 0 Then 
      txtFindPatient.SetFocus()
      Dec application.Busy
      
      Return
   Else  
      '----------------------------------------------------
      'One or more patients.
      'If one, get their photo if it exists and load record
      '----------------------------------------------------
      If AllPatients.count = 1 Then  
         Vbox_Search.Visible = False    
         For Each To_Patient In AllPatients
            
            To_Patient_Row = New CPatientSelectRow(ListContainer2, To_Patient)
            
         Next
      Else  
         ' '---------------------
         ' 'more than one patient
         ' '---------------------
         ' mnuView.Visible = False 
         ' mnuSections.Visible = False   
         ' mnuDecisionSupport.Visible = False  
         ' mnuHelp.visible = False
         ' Dec Application.Busy
         ' Vbox1.Visible = False  
         ' form_select = New FPatientsSelect(Me)
         ' obs = New Observer(form_select.btnCancel) As "SelectPatient"     
         ' form_select.Init(AllPatients, sql_in_english, "FClinical") 'was Me
         ' form_select.Visible = True 
         ' 
      Endif
   End If   
   
   Dec application.Busy
   
End

Public Sub EditAreaTextBox_KeyRelease()
   
   Patients_Find()
   
End
