' Gambas class file

' Copyright (C) 2008-2013 Dr. Richard Terry
' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.
' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
' ---------------------------------------------------------------------------------------------------
' PURPOSE     - A module to allow entry of persons recreational drug use
' FIXME:      -
' NOTES       -
'             - 
' BUGS        - 
'----------------------------------------------------------------------------------------------------

Private currentconsult As CConsult
Private substances As Collection
Private substance As Collection
Private common_lu_route_administration_keys As String[] 'only use a few match these to the cmbRouteTaken
Private fk_recreationaldrug As Integer

Public Sub Init(cons As CConsult)
   
  currentconsult = cons 
  lblMeasure.text = "  Age Last Used  " 'this label auto-resizes and used to set the widest label in the edit area
  modEditAreaHelpers.Resize_labels(Vbox_EditArea, lblMeasure)
  substances = modUtil.LoadCombo(cmbSubstances, modRecreationalDrugs.Recreational_Drugs_Get(), "drug")
  cmbRouteTaken.Add("inhaled", 0)    
  cmbRouteTaken.Add("intramuscular", 1)
  cmbRouteTaken.Add("intranasal", 2)    
  cmbRouteTaken.Add("intravenous", 3)    
  cmbRouteTaken.Add("oral", 4)    
  cmbRouteTaken.Add("subcutaneous", 5)    
  cmbRouteTaken.Add("topical", 6)    
  common_lu_route_administration_keys = New String[7]
  common_lu_route_administration_keys[0] = const.route_administration_inhaled
  common_lu_route_administration_keys[1] = const.route_administration_intramuscular
  common_lu_route_administration_keys[2] = const.route_administration_intranasal
  common_lu_route_administration_keys[3] = const.route_administration_intravenous
  common_lu_route_administration_keys[4] = const.route_administration_oral
  common_lu_route_administration_keys[5] = const.route_administration_subcutaneous
  common_lu_route_administration_keys[6] = const.route_administration_topical
  cmbSubstances_Click()
  Reload()
  

  
End

Public Sub Save()
   
  'Save the recreational drug
   
   Dim recreationalDrug As CRow
   
   If HBox_EditArea.Padding = 0 Then Return
   If Not RecreationalDrug_Valid() Then Return 
   recreationalDrug = New CRow  
   If fk_recreationaldrug <> 0 Then
      recreationalDrug.put_unchanged(fk_recreationaldrug, "fk_recreationaldrug")
   Endif
   recreationalDrug!fk_consult = currentconsult.GetPK() 
   recreationalDrug.Save()
   modDBConnect.CommitTrans
   Reload()
   
End

Public Sub Reload()
  '----------------------------------
  'Reload the users recreational drugs
  '----------------------------------- 
   
End

Public Sub RecreationalDrug_Valid() As Boolean
   'Returns true if enough information to save this recreational drug 
  
   
   
End

Private Sub Settings_Load()
   
   Vsplit_Main.Layout = Settings["FRecreationalDrugs/VSplit_Main.Layout", [1, 1]] 
   
End

Public Sub Settings_Save()
   
   Settings["FRecreationalDrugs/VSplit_Main.Layout"] = Vsplit_Main.Layout
   
End


' -- work on recreational drug use tables
' drop table clin_history.data_recreational_drugs;
' 
' Create table clin_history.lu_recreational_drugs
' (pk serial primary key,
' drug text not null,
' alternative_names text default null,
' illict boolean not null default true);
' 
' comment on table clin_history.lu_recreational_drugs is
' 'A list of common recreational drugs';
' comment on column clin_history.lu_recreational_drugs.alternative_names is
' 'a space-separated list of alternative names or subtypes';
' comment on column clin_history.lu_recreational_drugs.illict is
' 'true if illegal to use recreationally in most Australian jurisdictions';
'  
' Insert into clin_history.lu_recreational_drugs (drug, alternative_names, illict) values ('nicotine','cigarette cigar rollies chop-chop', false);
' Insert into clin_history.lu_recreational_drugs (drug, alternative_names, illict) values ('alcohol','ethanol booze piss goon drink mixers',false);
' Insert into clin_history.lu_recreational_drugs (drug,alternative_names, illict) values ('opiate', 'heroin morphine oxycodone oxies smack shit ms-contin', true);
' Insert into clin_history.lu_recreational_drugs (drug,alternative_names, illict) values ('cocaine','crack rock coke powder', true);
' Insert into clin_history.lu_recreational_drugs (drug,alternative_names, illict) values ('caffeine','coffee', false);
' Insert into clin_history.lu_recreational_drugs (drug,alternative_names, illict) values ('cannabis', 'THC skunk weed grass green bud synthetic-cannabis mary-jane wacky-baccy', true);
' -- God only knows what "synthetic cannabis" actually is!
' Insert into clin_history.lu_recreational_drugs (drug,alternative_names, illict) values ('benzodiazepines','valium xanax mogadon moggies serepax serries', true);
' Insert into clin_history.lu_recreational_drugs (drug,alternative_names, illict) values ('inhalants','solvents glue', false);
' Insert into clin_history.lu_recreational_drugs (drug,alternative_names, illict) values ('petrol','fuel gas', false);
' insert into clin_history.lu_recreational_drugs (drug,alternative_names,illict) values  ('amphetamine', 'metamphetamine ice speed methylphenidate ritalin looey', true);
' -- contrary to the firm belief of many users there is no effective difference between
' -- "speed" and "ice": the same mixture of amphetamines created in the backyard lab
' -- will be sold by dealers as "ice" to increase cachet (and so value)
' Insert into clin_history.lu_recreational_drugs (drug,alternative_names, illict) values ('psychedelics','LSD angel-dust acid shrooms mushies', true);
' -- technically angel dust is phencycline, and mushrooms may contain a 
' -- variety of compounds, chiefly mescaline, but again clinically it doesn't really make
' -- a difference
' insert into clin_history.lu_recreational_drugs (drug,alternative_names, illict) values ('MDMA','xtc ecstasy extasy', true);
' -- in practice "ecstasy" often has the same issue as "ice": whatever claimed by the dealer
' -- the pill will usually contain plain old amphetamine
' Insert into clin_history.lu_recreational_drugs (drug,alternative_names, illict) values ('kava','', false);
' -- yes it is legal, apparently
' 
' 
' 
' 
' 
' CREATE TABLE clin_history.data_recreational_drugs
' (
'   pk serial primary key,
'   fk_consult integer not null,
'   fk_lu_recreational_drug integer not null,
'   age_started integer default null,
'   age_last_used integer default null,
'   substance_amount integer default null,
'   fk_substance_unit_amount integer default null,
'   fk_lu_substance_frequency integer default null,
'   fk_lu_route_administration integer default null,
'   notes text,
'   deleted boolean,
'   CONSTRAINT data_recreational_drugs_fk_consult FOREIGN KEY (fk_consult)
'       REFERENCES clin_consult.consult (pk) MATCH SIMPLE
'       ON UPDATE NO ACTION ON DELETE NO ACTION,
'   CONSTRAINT data_recreational_drugs_fk_lu_recreational_drug FOREIGN KEY (fk_lu_recreational_drug)
'       REFERENCES clin_history.lu_recreational_drugs (pk) MATCH SIMPLE
'       ON UPDATE NO ACTION ON DELETE NO ACTION
'  );
' 
' Comment on table clin_history.data_recreational_drugs is
' 'A list of the patient''s recreational drug use
'  - note it is not possible to be absolutely precise about age started/stopped drugs a use can start stop, so comments should be added to the notes field';
' comment on column  clin_history.data_recreational_drugs.fk_lu_recreational_drug is 'foreign key to clin_history.lu_recreational_drugs';
' comment on column  clin_history.data_recreational_drugs.age_started is 'the age the patient first used this drug';
' comment on column  clin_history.data_recreational_drugs.age_last_used is 'the age the patient last used or stopped using the drug';
' comment on column  clin_history.data_recreational_drugs.substance_amount is 'the quantity of the substance e.g 10 if say 10gm of alcohol per day see lu_substance_frequency';
' comment on column  clin_history.data_recreational_drugs.fk_lu_substance_frequency is 'foreign key to common.lu_units but front end will allow on day/week/month/year';
' comment on column  clin_history.data_recreational_drugs.fk_substance_unit_amount is 'the units for the substance amount eg gm key to common.lu_units (to be restricted in the front end';
' comment on column  clin_history.data_recreational_drugs.fk_lu_route_administration is 'key to common.lu_route_administration';
' comment on column  clin_history.data_recreational_drugs.notes is 'any qualifying information about the drug eg, ''used intermittently 20-30, stopped in 30''s, started again in 40''s';
' 
' truncate db.lu_version;
' insert into db.lu_version (lu_major,lu_minor) values (0, 259);
' 
' 

Public Sub cmbSubstances_Click()

    If cmbSubstances.text = "alcohol" Then
       lblQuantity.text = "gms per"
    Endif

End
