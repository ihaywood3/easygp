' Gambas class file

' Copyright (C) 2008-2013 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
Private The_Collection As Collection
Private bExit As Boolean
Private bKeyValid As Boolean

Public Sub Form_Open()
  
   Init()
   
  
End

Public Sub Init()
 lblMeasure.text = "Prenatal Diagnostic Counselling   "
 modEditAreaHelpers.Resize_labels(VBox_EditArea, lblMeasure)
End

Public Sub txtBox_EditArea_Change()

 Select Case Last.tag
 Case "menarche"
 
 End Select
 

End
Public Sub DateChooser1_Activate()
     Last.tag.text = Format(Last.value, "dd/mm/yyyy")
     Last.tag.SetFocus()
     HBox_Calander.Visible = False  
End

Public Sub DateChooser1_LostFocus()
   DateChooser1.visible = False  
End

Public Sub EditArea_TextBox_GotFocus()
  Dim hCtrl As Control
  Dim Tbtn As ToolButton
  Select Case Last.tag
    Case "menarche", "pill stopped date", "lmp", "early pregnancy scan" ""
        For Each Hctrl In Last.parent.children
         If hctrl Is ToolButton Then
            Tbtn = hctrl
            Tbtn.Visible = True
         End If
        Next
        DateChooser1.tag = Last
  End Select

 Last.BackGround = Color.rgb(95, 255, 175)

End

Public Sub EditArea_TextBox_LostFocus()
   Select Case Last.tag
   Case "pill stopped date", "lmp", "early pregnancy scan"
      If Not IsDate(Last.text) Then
         bExit = True   
         Last.text = ""
         bExit = False
      End If
   End Select
   Last.BackGround = Color.white


End
Public Function EditArea_Textbox_ExcludeKeys(keycode As Integer, tag As String) As Boolean
   '----------------------------------------------------------
   'PURPOSE       Restrict key presses for validation purposes
   'HOW IT WORKS  see routines names
   'FIXME         Ian would do this much simpler I'm sure
   '-----------------------------------------------------------
   Select Case tag
     Case "cycle lengh"
         bKeyValid = modUtil.AllowKeys(const.AllowKeys_NumbersOnly, keycode)
     Case "menarche", "lmp", "early pregnancy scan"
          bKeyValid = modUtil.AllowKeys(const.AllowKeys_DateFormat, keycode)
     Case Else
         bKeyValid = True
     End Select
     Return bKeyValid
End

Public Sub EditArea_TextBox_KeyPress()
  bkeyvalid = EditArea_Textbox_ExcludeKeys(key.code, Last.tag)
  If bkeyvalid = False Then
      Stop Event
      Return
  End If
  Select Case Key.Code
      Case Key.Return, Key.tab
          Select Case Last.tag
          Case "menarche"
                txtCycleLengh.SetFocus()
          Case "cycle lengh"
               rbCycleRegularYes.SetFocus()
          Case "pill stopped date"
               rbPreDiagnosticCounsellingYes.SetFocus()
          Case "lmp"
               rbSureLMPYes.SetFocus()
          Case "early pregnancy scan"
               txtScanResult.SetFocus()
          Case "scan result"
             '  rtLatexAllergyYes.SetFocus()
          Case "relevant past history"
      End Select
  Case Key.Down
      ' If listview1.Visible Then
      '    listview1.SetFocus()
      '    listview1.MoveFirst
      '    listview1.Item.Selected = True
      ' End If
    '  Select Case Last.tag
 End Select
End



Public Sub rbSureLMP_KeyPress()

    Select Case Key.code
      Case Key.return, Key.Tab
         If Last.tag = "no" Then
               rbLMPNormalYes.SetFocus
         Else
                rbSureLMPNo.SetFocus()
        End If
    End Select

End

Public Sub rbLMPNormal_KeyPress()
   Select Case Key.code
      Case Key.return, Key.Tab
         If Last.tag = "no" Then
               rbPlannedYes.SetFocus
         Else
                 rbLMPNormalNo.SetFocus()
        End If
  End Select
 

End

Public Sub rbPlanned_KeyPress()
   Select Case Key.code
      Case Key.return, Key.Tab
         If Last.tag = "no" Then
              rbInfertilityYes.SetFocus
         Else
                rbPlannedNo.SetFocus()
        End If
  End Select

End


Public Sub rb3Miscarriages_KeyPress()
 Select Case Key.code
      Case Key.return, Key.Tab
         If Last.tag = "no" Then
          '  rbCaesariansYes.SetFocus
         Else
          '  rb3MiscarriagesNo.SetFocus()
        End If
  End Select
  

 

End

Public Sub rbCaesarians_KeyPress()
 Select Case Key.code
      Case Key.return, Key.Tab
         If Last.tag = "no" Then
            txtRelevantPastHistory.SetFocus
         Else
          '  rbCaesariansNo.SetFocus()
        End If
  End Select

  

End

Public Sub rbCycleRegular_KeyPress()
 Select Case Key.code
      Case Key.return, Key.Tab
         If Last.tag = "no" Then
            txtLMP.SetFocus
         Else
            rbCycleRegularNo.SetFocus()
        End If
  End Select

 

End

Public Sub rbInfertility_KeyRelease()

   Select Case Key.code
      Case Key.return, Key.Tab
         If Last.tag = "no" Then
           txtPillStoppedDate.SetFocus
         Else
            rbInfertilityNo.SetFocus()
        End If
  End Select


End

Public Sub rbPreDiagnosticCounselling_KeyPress()
 Select Case Key.code
      Case Key.return, Key.Tab
         If Last.tag = "no" Then
            txtEarlyPregnancyScan.SetFocus
         Else
            rbPreDiagnosticCounsellingNo.SetFocus()
        End If
  End Select

  

End

Public Sub rtLatexAllergy_KeyPress()
 Select Case Key.code
      Case Key.return, Key.Tab
         If Last.tag = "no" Then
            rb3MiscarriagesYes.SetFocus
         Else
        '   rtLatexAllergyNo.SetFocus()
        End If
  End Select
 

End

Public Sub EditAreaButtons_Click()
   Select Case Last.tag
   Case "pick date"
 ' For Each Hctrl In Last.parent.children
       With HBox_Calander
            .top = Last.Parent.Parent.top + Last.Parent.Height
            .left = Last.Parent.left
            .Raise()
        End With     
   
    DateChooser1.Parent.Visible = True 
    DateChooser1.Parent.Raise 
    DateChooser1.SetFocus
   End Select  
End

Public Sub EditArea_TextBox_Change()

  If bExit Then Return 

End
