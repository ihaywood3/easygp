' Gambas module file

' Copyright (C) 2008-2013 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'---------------------------------------------------------------------
' A module for the database routines for pregnancies
' --------------------------------------------------------------------

Public Function Presentations_Get() As Collection 
   '------------------------------------ 
   ' Return a list of baby presentations
   ' -----------------------------------
   ' Dim R As Result
   'Dim p As New String[] 
   
   Return modDBConnect.exec_query_collection("Select * from clin_pregnancy.lu_presentations")
   
   ' R = modDBConnect.exec_query("Select * from clin_pregnancy.lu_presentations") 
   ' If R.count Then
   '    For Each R
   '       p.Add(R!presentation)
   '    Next
   ' Endif
   ' Return p
End

Public Function Patient_Is_Pregnant(fk_patient As Integer) As Boolean
   'temporary fixme   proof of concept to put up patient is pregnant in Fclinical   
   
   Dim R As Result
   Dim sql As String
   
   sql = "Select * from clin_pregnancy.vwPregnancies where fk_patient = " & fk_patient
   R = modDBConnect.exec_query(sql)
   If R.count <> 0 Then
      Return True
   Endif
   
End

Public Function Delivery_Types_get(Optional bsort As Boolean = False) As Collection
   
   Dim sql As String
   
   sql = "Select * from clin_pregnancy.lu_delivery_types "
   If bsort Then sql &= "order by type"
   Return modDBConnect.exec_query_collection(sql) 
   
End

Public Function Onset_Labour_Types_Get(Optional bsort As Boolean = False) As Collection
   
   Dim sql As String
   
   sql = "Select * from clin_pregnancy.lu_onset_labour "
   If bsort Then sql &= "order by type"
   Return modDBConnect.exec_query_collection(sql) 
   
End

Public Function Antenatal_Visits_Get(fk_patient As Integer) As Collection 
   '------------------------------------------------------------------------------
   'ordered by visit date, not key e.g back visits may be transcribed from a sheet
   '------------------------------------------------------------------------------   
   Return modDBConnect.exec_query_collection("Select * from clin_pregnancy.vwAnteNatal_Visits where fk_patient =" & fk_patient & " ORDER BY visit_date")
   
End

Public Sub Pregnancies_Get(fk_patient As Integer) As Collection
   
   Return modDBConnect.exec_query_collection("Select * from clin_pregnancy.vwPregnancies where fk_patient=" & fk_patient & " order by edc")  
   
End
