' Gambas class file

' Copyright (C)2008-2014 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.
' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'----------------------------------------------------------------------
' A Form to all the user to change the prescribing scope on the fly
' -----------------------------------------------------------------
Private drug_search_scope As String[]

Public Sub Run() As Boolean
   
   Return Not Me.ShowModal()
   
End

Public Sub Init()

   Dim chapter As Collection
   Dim chkbox As CheckBox
   Dim chapters As Collection
   
   chapters = modPrescribingDBI.Chapters_Get()
   For Each chapter In chapters
      With chkbox = New CheckBox(Vbox_Chapters) 
         .Expand = True
         .text = chapter!chapter_name
         .tag = chapter
         .height = 28
         .value = modAdminDBI.Config_Get(chapter!chapter, False, False, modDBConnect.currentUser!fk_clinic)
      End With
      Vbox_Chapters.Height = (chapters.count + 1) * 28
   Next
   
End

Public Sub btnOK_Click()

   Dim cb As CheckBox
   
   drug_search_scope = New String[]
    
   For Each cb In Vbox_Chapters.Children
      If cb.Value = True Then
         drug_search_scope.Add(cb.Tag!chapter, drug_search_scope.count)
      Endif
   Next
   FPrescriptions.Search_Scope_Update(drug_search_scope)
   Me.Close(True)
   
End

Public Sub btnCancel_Click()
   
   Me.Close
   
End
