' Gambas class file
' Copyright (C) 2008,2011 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.

Private fk_pasthistory As Integer
Private cProgressNote_Section As Integer
Private currentconsult As CConsult
Private bEmbedded As Boolean             'If true the form is embedded in a frmConsultNotes editor
Private embedded_in_form As String
Private embedded_form As String          'the form this form is embedded in
Private Brands As Collection
Private Brand As Collection



Public Sub set_embedded(flag As Boolean, embeddedinform As String)
   '--------------------------------------------------
   'If this form is embeded from another form set flag
   'embeddedinform = either "notes" or "documents"
   '--------------------------------------------------
   bEmbedded = flag
   embedded_in_form = embeddedinform
End

Public Sub Save()
  
  
   FClinical.Refresh_AllPreviousNotes()
End

Public Sub TextLabel1_MouseDown()

  

End

Public Sub Form_settings(mode As String)
  
  Select Case mode
    Case "save"
        ' Settings["Tasks_Embedded_" & Parent_Form & "/HSplit_EditArea_Inner.Layout"] = HSplit_EditArea_Inner.Layout
        ' Settings["Tasks_Embedded_" & Parent_Form & "/HSplit_EditArea_Outer.Layout"] = HSplit_EditArea_Outer.Layout
        ' Settings["Tasks_Embedded_" & Parent_Form & "/Vsplit_Script.Layout"] = Vsplit_Script.Layout
    Case "load"
      
  End Select
  
End

Public Sub Init(cons As CConsult)
  
  currentconsult = cons
  
End


Public Sub mnuHealthIssues_Click()
   '---------------------------------------------------
   'User wants to link a request form to a health issue
   'The menu tag = the pk_pasthistory
   '---------------------------------------------------
  
  Select Case Last.tag
  Case "general notes", "remove link"
    txtHealthIssue.text = "General Notes"
    fk_pasthistory = 0
    cProgressNote_Section = const.cSection_GeneralNotes
  Case Else
    txtHealthIssue.text = currentconsult!past_history[Last.tag]!description
    fk_pasthistory = Last.tag
    cProgressNote_Section = const.cSection_Prescriptions
  End Select
End

Public Sub EditArea_TxtBox_KeyRelease()

  Select Case Last.tag
    Case "drug"
         Brands_Get()
  End Select

End

Public Sub EditArea_TxtBox_GotFocus()

   With columnview1
      .top = Vbox_EditArea_Left_Textboxes.top + Last.parent.top + Last.parent.height + HBox_PrescribeFor.height
      .left = Last.Left
      .width = Last.width  
      .Visible = False
      .Raise
      
   End With

End

Public Sub Brands_Get()
  
  With columnview1
      .Clear()
      .Columns.count = 2
  End With
  
  brands = modPrescribingDBI.Brands_Get(Trim(txtDrug.text))
  If brands.count Then
      For Each brand In brands
 
       ColumnView1.add(brand!pk, 0)
        columnview1[brand!pk][0] = brand!brand
        Next
        columnview1.Visible = True  
  Endif
  
End
