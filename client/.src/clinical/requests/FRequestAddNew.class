' Gambas class file

' Copyright (C) 2008-2014 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
Private sql As String
Private $Result As Result
Private Providertypes As Collection
Public RQI As New CRequestItem
Private term As String

Public Sub Run() As Boolean

   Return Not Me.ShowModal()

End

Public Sub btnOK_Click()

   Me.Close(True)

End

Public Sub btnCancel_Click()

   Me.Close

End

Public Sub Provider_Get_All_Types()
   '-------------------------------------------
   'Gets list of all provider types by category
   '--------------------------------------------

   Dim x As Integer
   Dim PT As CRequestProviderTypes

   sql = "Select * from contacts.lu_categories where category ILIKE $$%Provider%$$ ORDER BY category"
   $Result = modDBConnect.exec_query(sql)
   providertypes = New Collection
   For Each $Result
      PT = New CRequestProviderTypes
      PT.pk = $Result!pk
      PT.type = $Result!category
      cmbProvidertypes.Add($Result!category, x)
      providertypes.Add(PT, x)
      Inc x
   Next

End

Public Sub form_Open()

   modDBConnect.ensure_logon()
   Provider_Get_All_Types
   textlabel1.text = "<P><B>Missing Pathology Term</B></P>"
   textlabel1.text &= "<P>The term " & term & " has"
   textlabel1.text &= "not been found in the database lookup tables</P>"
   "<P>Before the request form can be imported, this new term must be added to our"
   "database</P>"
   "<P>If you choose not to add this term, the form involved will not be"
   "imported.</P>"
   sql = "Select * from clin_requests.lu_type"
   $Result = modDBConnect.exec_query(sql)

   RQI.fk_type = const.Request_Type_Pathology 'default to this

End

Public Sub rblaterality_Click()

   Select Case Last.tag
      Case "none"
         RQI.fk_laterality = const.LateralityNone
      Case "left"
         RQI.fk_laterality = const.LateralityLeft
      Case "right"
         RQI.fk_laterality = const.LateralityRight
      Case "both"
         RQI.fk_laterality = const.LateralityBoth
   End Select

End

Public Sub txtNewRquest_Change()

   RQI.item = Trim(txtRequest.text)

End

Public Sub cmbProviderTypes_Click()

   RQI.fk_type = ProviderTypes[cmbProvidertypes.index].pk

End
