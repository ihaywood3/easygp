' Gambas module file
' Copyright (C) 2008,2009 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.

Private $hConn As Connection
Private $Result As Result
Private sql As String

Public Sub TargetDisease_get(lv As listview, txt As Textbox)
  '---------------------------------------------------
  'Gets a list of target diseases to vaccinate against
  '---------------------------------------------------
  Dim x As Integer
  If Not (txt) Then Return
  sql = "Select * from clin_vaccination.lu_target WHERE "  
  SQL &= "target ILIKE '%" & Lower(Trim(txt.text)) & "%' "
  $Result = modDBConnect.exec_query(sql)
  'Print $Result.Count
  lv.clear
  If $Result.count Then
     For Each $Result
          lv.Add(x, $Result!target)
          Inc x
      Next
      With lv
         .Raise
         .Visible = True
         .tag = txt
     End With
  Else
     lv.Visible = False
     
  End If
 End
Public Sub Vacccines_Guess(lv As listview, sString As String)
 
   
End 

Public Sub SerialNumbers_GetList(lv As listview)
  
  '---------------------------------------------------
  'Gets a list of serial numbers to vaccinate against
  '---------------------------------------------------

  
End
Public Sub Vaccination_Sites_Get(lv As listview)
 '---------------------------------------------------
  'Gets a list of vaccination sites
  '---------------------------------------------------
  sql = "Select * from common.lu_route_administration order by route;"
  modDBConnect.exec_query(sql)
  lv.Clear()
  For Each $Result
     lv.Add($Result!pk, $Result!route)
  Next
  If lv.count Then
     lv.Visible = True
  Else
     lv.Visible = False
  End If
  
End
Public Sub Vaccines_get(lv As listview)
  '---------------------------------------------------
  'Gets a list of vaccines for a particular target disease
  '---------------------------------------------------

  
  
  
  
End
Public Sub Schedules_get(lv As listview)
  '---------------------------------------------------
  'Gets a list of current Schedules and their vaccines
  'shows the schedules in the listview.
  '---------------------------------------------------
  Dim Schedules As Collection
  Dim Vaccines As collection
  Dim x As Integer
  Dim schedule As New Collection
  Dim vaccine As New Collection
  sql = "Select * from clin_vaccination.lu_schedules order by schedule_text"
  $Result = modDBConnect.exec_query(sql)
  lv.Clear()
  If $Result.count Then
     'Print "schedules exist"
     For Each Result
          '--------------------------------------------------
          'Create a new schedule, fill schedule and vaccines
          'add the schedule  name to the viewing list
          '-------------------------------------------------
          schedule = New cVaccineSchedule
          With schedule
             .pk = $Result!pk
             .Name = $Result!schedule_text
             .Age_From_Months = $Result!Age_from_months
             .Age_To_Months = $Result!Age_To_Months
             .ATSI = $Result!aboriginal_tsi_only
             .female_only = $Result!female_Only
            ' .season = $Result!season FIXME oNCE HAVE A VIEW
             .fk_season = $Result!fk_season = False
             ' vaccines_data_changed As Boolean
             lv.Add(x, $Result!schedule_text)
             Schedules.Add(schedule, x)
          End With
      Next
     
  Else
     'Print "No schedules exist"  
  End If
  
  
End
