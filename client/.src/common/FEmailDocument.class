' Gambas class file

' Copyright (C) 2014 Dr. Richard Terry, Dr. Ian Haywood

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY ; without Even the implied warranty Of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'
'---------------------------------------------------------
' Simple Gui to allow user to email something to a patient
'---------------------------------------------------------

Private filenames As String[]
Private currentconsult As CConsult

Public Sub Init(cons As CConsult, fns As String[])
   
   Dim comm As Collection

   Me.title = "Email Document"
   filenames = fns
   currentconsult = cons
   txtDocument.text = File.Name(filenames[0]) 'at moment am only passing this a single filename to test
   
   For Each comm In currentconsult!comms
      If comm!fk_type = const.CommModalityEmail Then
         txtEmailAddress.text = comm!value
      Endif
   Next
   
End

Public Sub Run() As Boolean
   
   Return Not Me.ShowModal()
   
End

Private Sub Send_Email_Encrypted_Zip()
   
   Dim p As CPrintTask
   Dim f As String
   
   p = New CPrintTask
   
   ' f = p.Latex_To_Pdf(File.Load("/home/ian/example.tex"))
   p.Send_Email_Encrypted_Zip(filenames, "rterry@internode.on.net", "guimaster")
   p.Finish()
   
End

Public Sub btnOK_Click()
   
   Send_Email_Encrypted_Zip  
   Me.Close(True)
   
End

Public Sub btnCancel_Click()
   
   Me.Close
   
End

