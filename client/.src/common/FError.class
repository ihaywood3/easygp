' Gambas class file


Public Sub CloseButton_Click()

 
  Inc Application.Busy
  If chkSendReport.Value = True Then
    SendReport()
    Wait
  Endif
  Me.Close(0)
  Quit   
  Dec Application.busy
End

Public Sub SetMessage(msg As String)
  
  teError.Text = msg
  
End

Public Sub SendReport()
  
  Dim thelog As String
  Dim buffer As String
  Dim curl As New HttpClient
  
  curl.URL = "https://ozdocit.org/cgi-bin/reportbug-easygp.cgi"
  curl.Async = False
  curl.Timeout = 60
  buffer = "Subject: [EASYGP] error report\n\n" & Log.GetWholeLog()
  curl.Post("text/plain", buffer)
  If curl.Status < 0 Then
    Log.ErrorMsg("curl failed:" & curl.Reason)
  Endif
  If Lof(curl) Then Read #curl, buffer, Lof(curl)
  Close #curl
  If Left$(buffer, 2) <> "OK" Then
    Log.ErrorMsg("ozdocit.org returned error:" & buffer)  
  Endif
End
