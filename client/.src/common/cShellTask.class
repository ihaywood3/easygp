' Gambas class file

Inherits CTask
' Copyright (C) 2013-2014 Dr. Ian Haywood

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'----------------------------------------------------------------------

'  class to allow printing entirely in the background
'  largely duplicates the functionality of modPrinting and should replace it...eventually

Static Private file_num As Integer = 0


Public Sub _new()
  Dim s As String
   
  Super.Init(["/bin/sh"])
  Me.Send("umask 077\nset -e\n")
  s = Temp$()
  s = Left$(s, RInStr(s, "/"))
  Me.Send("cd " & s & "\n") 

End

' create a unique temporary filename
Static Public Sub Get_File(ending As String, Optional contents As String) As String
   
 Dim s As String
 
 s = Temp$() & "." & ending
 If Not IsNull(contents) Then File.Save(s, contents)
   
End

Static Public Sub Change_Ending(fname As String, new_ending As String) As String
  Dim i As Integer
   
  i = RInStr(fname, ".")
  If i = 0 Then Return fname
  Return Left$(fname, i) & new_ending
   
End


Public Sub Kill(fname As String)
   
  Me.Send(Subst$("rm '&1'", fname)) 
   
End

Public Sub Finish()
   
  Me.Send("echo '~FINISH~'") 
   
End




