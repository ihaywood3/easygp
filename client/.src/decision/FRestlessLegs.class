' Gambas class file

' Gambas class file

' Copyright (C) 2008-2014 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
' please note the ownership of this material
' 
' A form class to allow the GP to adminster the Restless Legs Rating Scale
' Questions reproduced with permission of the authors
' 
' Source:
' The International Restless Legs Syndrome Study Group. Validation of the International Restless Legs Syndrome Study
' Group Rating Scale for restless legs syndrome. Sleep Med 2003;4(2):121-132.
'--------------------------------------------------------------------------------------------------------------
Private currentconsult As CConsult
Private questions_answered As Integer
Private score As Integer   
Private chkBoxes As New CheckBox[]

Public Sub Init(c As Cconsult)
   
   Dim sHtml As String
   
   currentconsult = c  
   tlheading.text = "<P>Patients must meet International Restless Legs Syndrome Study Group (IRLSSG) criteria for the "
   "diagnosis of Restless Legs Syndrome (RLS) before administration of the questionnaire as follows</P>"
   
   Make_Questionaire
   tlacknowledgement.text = ""
   "The International Restless Legs Syndrome Study Group. Validation of the International Restless Legs Syndrome Study"
   "Group Rating Scale for restless legs syndrome. Sleep Med 2003;4(2):121-132"
   
   sHtml = ""
   "<P>The International Restless Legs Syndrome Study Group. Validation of the International Restless Legs Syndrome Study"
   "Group Rating Scale for restless legs syndrome. Sleep Med 2003;4(2):121-132.</P>"
   "<P><B>INSTRUCTIONS FOR EXAMINER</B></P>"
   "<P>1) Patients must meet International Restless Legs Syndrome Study Group (IRLSSG) criteria for the "
   "diagnosis of Restless Legs Syndrome (RLS) before administration of the questionnaire which are as follows:"
   "<UL>"
   "<LI> The Desire to move the extremities usually associated with discomfort or disagreeable sensations in the "
   "extremities."
   "<LI> Motor Restlessness  -patients move to relieve the discomfort, for example walking, or to provide a "
   "counter-stimulus to relieve the discomfort, for example, rubbing the legs."
   "<LI> Symptoms are worse at rest with at least temporary relief by activity."
   "<LI> Symptoms are worse later in the day or at night.</P>"
   "</UL>"
   "<B>Exception</B> — If the patient previously met IRLSSG criteria and has undergone a "
   "spontaneous remission or is participating in a drug study with subsequent significant "
   "alteration of symptoms.<BR>"
   "<B>Exception</B> - The patient at one time got relief of symptoms by activity but is now so severe "
   "that no such relief is possible.<BR>"
   "<B>Exception</B> - The patient at one time was worse later in the day or at night, but is now so "
   "severe that symptoms are equal day and night.<BR>"
   "<B>Exception</B> - The questionnaire may also be administered To normal controls."
   "<P>2) Have the patient rate his/her symptoms for the ten questions. The patient and not the "
   "examiner should make the ratings, but the examiner should be available to clarify any misunderstandings "
   "the patient may have about the questions. "
   modUtil.Decision_Support_Help_Show(sHtml, "Restless Legs Syndrome Rating Scale")
   
End

Public Sub New_Entry()
   ' '------------------------------- 
   ' 'Called so for historical reason
   ' 'clear the checkboxes 
   ' '------------------------------- 
   Dim cb As CheckBox
 
  ' 
   ' Dim hCtrl As Control
   ' Dim Option_Box As HBox
   ' Dim cb As CheckBox
   ' Dim Question_Box As VBox
   ' Dim HB As HBox
   ' 
   ' For Each hCtrl In ScrollView1.Children
   '    If hctrl Is Hbox Then
   '       Option_Box = hctrl
   '       For Each hCtrl In Option_Box.Children
   '          If hCtrl Is Vbox Then
   '             Question_Box = hctrl
   '             For Each hCtrl In Question_Box.Children
   '                If hctrl Is Hbox Then
   '                   Hb = hctrl
   '                   For Each hCtrl In hb.children
   '                      If hCtrl Is CheckBox Then
   '                         cb = hCtrl  
   '                         cb.value = False  
   '                      Endif
   '                   Next
   '                Endif
   '             Next
   '          Endif
   '       Next
   '    Endif
   ' Next
   For Each cb In chkBoxes
      cb.value = False
   Next
End

Public Function Make_Questionaire()
   Dim HBox_Question_Row As HBox       'will contain eg question 1 and question 6 etc
   Dim options As String[]
   Dim question As String
   Dim TL As TextLabel
   
   With HBox_Question_Row = New HBox(Scrollview1)              'make a new row    
      .Expand = False
      .height = 170 
   End With  
   question = "1. Overall, how would you rate the RLS discomfort in you legs or arms?"
   options = New String[]                                     'add the questions
   options.add("Very Severe")
   options.add("Severe")
   options.add("Moderate")
   options.add("Mild")
   options.add("None")
   Question_Box(1, question, options, HBox_Question_Row)
   question = "6.  Overall, how severe is your RLS as a whole ?"
   options = New String[]  
   options.add("Very Severe")
   options.add("Severe")
   options.add("Moderate")
   options.add("Mild")
   options.add("None")
   question_box(6, question, options, HBox_Question_Row)
   With HBox_Question_Row = New HBox(Scrollview1)              'make a new row    
      .Expand = False
      .height = 170 
   End With  
   question = "2. Overall, how would you rate the need to move around because of your RLS symptoms?"
   options = New String[]  
   options.add("Very Severe")
   options.add("Severe")
   options.add("Moderate")
   options.add("Mild")
   options.add("None")
   question_box(2, question, options, HBox_Question_Row)
   question = "7.How often do you get RLS symptoms?"
   options = New String[]  
   options.add("Very Severe (This means 6 to 7 days a week.)")
   options.add("Severe (This means 4 to 5 days a week.")
   options.add("Moderate (This means 2 to 3 days a week.)")
   options.add("Mild(This means 1 day a week or less.)")
   options.add("None")
   question_box(7, question, options, HBox_Question_Row)
   With HBox_Question_Row = New HBox(Scrollview1)              'make a new row    
      .Expand = False
      .height = 170 
   End With  
   question = "3. Overall, how much relief of your RLS arm or leg discomfort do you get from moving around?"
   options = New String[]  
   options.add("No relief")
   options.add("Slight relief")
   options.add("Moderate relief")
   options.add("Either complete Or almost complete relief")
   options.add("No RLS symptoms and therefore question does not apply")
   question_box(3, question, options, HBox_Question_Row)
   question = "8. When you have RLS symptoms, how severe are they on an average day ?"
   options = New String[]  
   options.add("Very Severe (This means 8 hours per 24 hour day or more.)")
   options.add("Severe (This means 3 to 8 hours per 24 hour day.)")
   options.add("Moderate (This means 1 to 3 hours per 24 hour day.)")
   options.add("Mild (This means less than 1 hour per 24 hour day.)")
   options.add("None")
   question_box(8, question, options, HBox_Question_Row)
   With HBox_Question_Row = New HBox(Scrollview1)              'make a new row    
      .Expand = False
      .height = 170 
   End With  
   question = "4. Overall, how severe is your sleep disturbance from your RLS symptoms?"
   options = New String[]  
   options.add("Very Severe")
   options.add("Severe")
   options.add("Moderate")
   options.add("Mild")
   options.add("None")
   question_box(4, question, options, HBox_Question_Row)
   question = "9. Overall, how severe is the impact of your RLS symptoms on your ability to carry out your daily affairs, "
   "for example carrying out a satisfactory family, home, social, school, or work life?"
   options = New String[]
   options.add("Very Severe")
   options.add("Severe")
   options.add("Moderate")
   options.add("Mild")
   options.add("None")
   question_box(9, question, options, HBox_Question_Row)
   With HBox_Question_Row = New HBox(Scrollview1)              'make a new row    
      .Expand = False
      .height = 170 
   End With  
   question = "5.  How severe is your tiredness or sleepiness from your RLS symptoms?"
   options = New String[]  
   options.add("Very Severe")
   options.add("Severe")
   options.add("Moderate")
   options.add("Mild")
   options.add("None")
   question_box(5, question, options, HBox_Question_Row)
   question = "10. How severe is your mood disturbance from your RLS symptoms–for example angry, depressed, sad,"
   "anxious, Or irritable?"
   options = New String[]  
   options.add("Very Severe")
   options.add("Severe")
   options.add("Moderate")
   options.add("Mild")
   options.add("None")
   question_box(10, question, options, HBox_Question_Row)
   With TL = New TextLabel(Scrollview1)
      .AutoResize = True
      .text = "<P align='center'><B>The patient should rate the severity of their symptoms in the last week overall</B></P>" 
      "<HR>1<P align='center'><B>MILD</B></P>2<BR><HR>"
      "3<P align='center'><B>MODERATE</B></P>4<BR><BR><HR>"
      "5<P align='center'><B>SEVERE</B></P>6<BR><BR><HR>"
      "7<P align='center'><B>VERY SEVERE</B></P>8<BR><HR>"
   End With
  Print chkBoxes 
End

Public Function Question_Box(question_number As Integer, question As String, options As String[], parent_box As Hbox) As HBox
   
   Dim VBox_Questions As VBox
   Dim option_row As HBox
   Dim chkbox As CheckBox
   Dim lblQuestion As TextLabel
   Dim x As Integer = 5
   Dim option As String
   Dim spacer As HBox
   
   With VBox_Questions = New Vbox(parent_box) 'attatch new box which will contain label and questions to the parent box
      .Expand = True  
   End With
   
   With lblQuestion = New TextLabel(VBox_Questions)
      .text = question
      .Font.bold = True
      .height = 48
      .AutoResize = True   
   End With 
   For Each option In options                'for each question
      With option_row = New HBox(VBox_Questions)   'create new hbox to contain checkbox and question
         .height = 24
         .Expand = False
      End With
      With Spacer = New HBox(option_row)           'add a bit of space
         .width = 12
      End With
      With chkbox = New CheckBox(option_row) As "chkboxScore"   
         .Height = 24
         .Value = False 
         .text = option 
         .Expand = True
         .tag = x - 1
      End With
      chkBoxes.Add(chkbox, chkBoxes.count)
      Print options[5 - x], x - 1
      Dec x   
   Next
   'max_height
   Return parent_box
   
End


Public Sub chkboxScore_Click()
   '-----------------------------------------------------------------------
   'Add the score, but first, uncheck all other boxes
   'bit fiddley but need to do this by hand
   'If the checkbox being clicked is true then
   'its parent.parent control tag (ie the main container for the options)
   'is set to "answered"
   'when all are answered show the score
   '-----------------------------------------------------------------------
   
   Dim Option_Box As HBox
   Dim hCtrl As Control
   Dim cb As CheckBox
   
   Last.parent.parent.tag = ""
   If Last.value = True Then 
      Last.parent.tag = "skip"                           'designate the Hbox holding the checked box to be skipped over
      For Each hCtrl In Last.parent.parent.children      'parent.parent = the Hbox holding the question and rows of checkboxes and spacers
         If hctrl Is Hbox Then
            Option_Box = hctrl
            If Option_Box.tag <> "skip" Then            'otherwise if find a checkbox set its value back to false   
               For Each hctrl In Option_Box.Children
                  If hctrl Is CheckBox Then
                     cb = hctrl  
                     cb.value = False  
                  Endif
               Next
            Else
               score += Last.tag 
               Last.parent.parent.tag = "answered"
               Last.parent.tag = ""        'remove the skip
            End If   
         Endif
      Next
   Else
      score -= Last.tag  
   End If   
   If Last.parent.parent.tag = "answered" Then
      Inc questions_answered
   Else
      Dec questions_answered
   End If   
      With lblScore
         .text = "Score:" & Str(score) & "/40 "
      End With
   
End


Public Sub ToolButton1_Click()

     FClinical.DecisionSupport_Show("", True)

End
