' Gambas class file

Public Sub Button1_Click()
   
   Dim message As New CHL7Message_REF_I12
   Dim ReceivingFacility As CHL7Datatype_HD
   Dim ConsultingProvider As Collection
   Dim ReferredtoProvider As Collection
   Dim PrimaryCareProvider As Collection
   Dim ReferralLetterText As String
   Dim TempFile As File 'just for testing
   Dim sLine As String 'just for testing
   Dim AdmissionType As String
   Dim ObservationResultStatus As String
   Dim AttachmentsArray As New String[]
   
   ReceivingFacility = New CHL7Datatype_HD
    
 ConsultingProvider = modDBConnect.currentUser
 ReferredtoProvider = modDBConnect.currentUser
 PrimaryCareProvider = modDBConnect.currentUser
 
   
   ReceivingFacility.ApplicationIdentifier = "Bernd general practice"
   
   TempFile = Open "/home/bernd/svn/easygp/referraltext"
   While Not Eof(TempFile)
      Line Input #TempFile, sLine
      ReferralLetterText = ReferralLetterText & sLine & "\n"
   Wend
   
   'possiblilities for the observation result status
   ' C RECORD COMING OVER Is A CORRECTION And THUS REPLACES A RESULT 338
   ' D DELETES THE OBX RECORD 339
   ' F FINAL RESULTS; CAN ONLY BE CHANGED With A CORRECTED RESULT.340
   ' I SPECIMEN In LAB; RESULTS PENDING 341
   ' P PRELIMINARY RESULTS 342
   ' R RESULTS ENTERED - - Not VERIFIED 343
   ' S PARTIAL RESULTS 344
   ' U RESULTS STATUS CHANGE To FINAL.RESULTS DID Not CHANGE(DON 'T TRANSMIT TEST).   346
   ' X RESULTS CANNOT BE OBTAINED For THIS OBSERVATION 345    
   ObservationResultStatus = "S"
   
   AdmissionType = "R"  'A  = ACCIDENT   E = EMERGENCY L = LABOR  R = ROUTINE 
   AttachmentsArray.Add(ReferralLetterText, 1)
   AttachmentsArray.Add("/home/bernd/svn/test.pdf", 2)
   AttachmentsArray.Add("/home/bernd/svn/test.JPG", 3)
   message.createHL7Message_REF_I12(ConsultingProvider, ReferredtoProvider, PrimaryCareProvider,, 1, ObservationResultStatus, "A", "R", "GRF", "RP", "S", AttachmentsArray,, AdmissionType)

     
End 
