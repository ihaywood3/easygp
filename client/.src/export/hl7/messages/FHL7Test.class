' Gambas class file

Public Sub Button1_Click()
   
   Dim message As New CHL7Message_REF_I12
   Dim ReceivingFacility As CHL7Datatype_HD
   Dim ConsultingProvider As Collection
   Dim ReferredtoProvider As Collection
   Dim PrimaryCareProvider As Collection
   Dim ReferralLetterText As String
   Dim TempFile As File 'just for testing
   Dim sLine As String 'just for testing
   Dim AdmissionType As String
   Dim ObservationResultStatus As String
   Dim AttachmentsArray As New String[]
   Dim ReferralStatus As String
   Dim ReferralPriority As String
   Dim ReferralType As String
   Dim ReferralDisposition As String
   Dim ReferralReason As String
   ReferralReason = "S" 'Second opinion = ‘S’ Patient preference = ‘P’ Provider ordered = ‘O’ Work load = ‘W’ 
   ReferralDisposition = "WR" 'Send written report = ‘WR’ Return patient after evaluation =‘RP’Assume management = ‘AM’Second opinion = ‘SO’ NOTE: ‘SO’ = Provide second, third Or other opinion. Additional Australian table values: Discharge summary = ‘DS’ Update care plan = ‘UCP’ Update health record = ‘UHR’ Case conference = ‘CC’ Notification – no further action =‘FI
   ReferralType = "GRF" 'General referral = ‘GRF’Discharge referral = ‘DRF’Shared care update = ‘SCU’Notification = ‘NOT’Shared EHR update = ‘SEU’Decision support system update =‘DSU’
   
   ReferralPriority = "R" 'With highest priority = 'S' As soon as possible = 'A' Urgent = 'U' Early = 'E' Routine = 'R'
   ReferralStatus = "A" 'Accepted = 'A' Pending = 'P' Rejected = 'R' Expired = 'E'
   
   ReceivingFacility = New CHL7Datatype_HD
    
 ConsultingProvider = modDBConnect.currentUser
 ReferredtoProvider = modDBConnect.currentUser
 PrimaryCareProvider = modDBConnect.currentUser
 
   
   ReceivingFacility.ApplicationIdentifier = "Bernd general practice"
   

   
   'possiblilities for the observation result status
   ' C RECORD COMING OVER Is A CORRECTION And THUS REPLACES A RESULT 338
   ' D DELETES THE OBX RECORD 339
   ' F FINAL RESULTS; CAN ONLY BE CHANGED With A CORRECTED RESULT.340
   ' I SPECIMEN In LAB; RESULTS PENDING 341
   ' P PRELIMINARY RESULTS 342
   ' R RESULTS ENTERED - - Not VERIFIED 343
   ' S PARTIAL RESULTS 344
   ' U RESULTS STATUS CHANGE To FINAL.RESULTS DID Not CHANGE(DON 'T TRANSMIT TEST).   346
   ' X RESULTS CANNOT BE OBTAINED For THIS OBSERVATION 345    
   ObservationResultStatus = "S"
   
   AdmissionType = "R"  'A  = ACCIDENT   E = EMERGENCY L = LABOR  R = ROUTINE 
   

      'this reads a letter from a text file 
      '
   AttachmentsArray.Add("/home/bernd/svn/easygp/referraltext.txt", 1)
   AttachmentsArray.Add("/home/bernd/svn/test.pdf", 2)
   AttachmentsArray.Add("/home/bernd/svn/test.JPG", 3)
   message.createHL7Message_REF_I12(ReferredtoProvider, 1, ObservationResultStatus, ReferralStatus, ReferralPriority, ReferralType, ReferralDisposition, ReferralReason, AttachmentsArray, ConsultingProvider, PrimaryCareProvider,,,, AdmissionType)
  
  '- ReferredToProvider: Needs to be a collection and contains the information of the Receiving doctor
    '- ToTransferPatient_fk_Patient: Needs to be an integer and contains the foreign key which gives the information were the data of the to reffering patient is storred in the DB
   '- ObservationResultStatus: Needs to be a string which is coded according to the HL7 table 85 
   '- ReferralStatus is a String and needs to be coded according to the hl7 table 0283 Accepted = 'A' Pending = 'P' Rejected = 'R' Expired = 'E'
   '- ReferralPriority is a string and needs to be coded according to the hl7 table 0280 (conditional) With highest priority = 'S' As soon as possible = 'A' Urgent = 'U' Early = 'E' Routine = 'R'
   '- ReferralType is a hl7 Datatype sting and needs to be coded according to the hl7 table 0281 (conditional) General referral = ‘GRF’Discharge referral = ‘DRF’Shared care update = ‘SCU’Notification = ‘NOT’Shared EHR update = ‘SEU’Decision support system update =‘DSU’
   '- ReferralDisposition is a string and needs to be coded according to hl7 table 0282 and says what is expected of the receiver (Optional) (Send written report = ‘WR’ Return patient after evaluation =‘RP’Assume management = ‘AM’Second opinion = ‘SO’ NOTE: ‘SO’ = Provide second, third Or other opinion. Additional Australian table values: Discharge summary = ‘DS’ Update care plan = ‘UCP’ Update health record = ‘UHR’ Case conference = ‘CC’ Notification – no further action =‘FI’)
   '- ReferralReason is a string and must be coded according to the hl7 table 0336 (Second opinion = ‘S’ Patient preference = ‘P’ Provider ordered = ‘O’ Work load = ‘W’ 
   '- Attachments(optional): this is a string array and caintains sings such a letter text a pdf or a picture as a sting ( be carefull to convert the attachments into the right format before calling this function
   '- ConsultingProvider(Optional): Needs to be a collection and contains the information of the consulted doctor 
    '- PrimaryCareProvider(Optional): Needs to be a collection and contains the information of the primary doctor of the patient
   '- ReceivingFacility_HD(optional): Needs to be a object of the cHL7Datatype_HD class and contains the information of the receiving facility 
   '- OriginatingReferralIdentifier(Optional) is a hl7 EI datatype and contains the global universal identifyer of this referral message (GUID) it can be passed to this function if this is a answer to a previos referral message otherwise a GUID will be generated from this function
   '- AdmissionType(optional): Needs to be a string which is coded according to the HL7 user table 7

     
End 
