' Gambas class file

Public Sub Button1_Click()
   
   Dim message As New CHL7Message_REF_I12
   Dim ReceivingFacility As CHL7Datatype_HD
   Dim ConsultingProvider As Collection
   Dim ReferredtoProvider As Collection
   Dim PrimaryCareProvider As Collection
   Dim ReferralLetterText As String
   Dim TempFile As File 'just for testing
   Dim sLine As String 'just for testing
   Dim AdmissionType As String
   Dim ObservationResultStatus As String
   Dim AttachmentsArray As New String[]
   
   ReceivingFacility = New CHL7Datatype_HD
    
 ConsultingProvider = modDBConnect.currentUser
 ReferredtoProvider = modDBConnect.currentUser
 PrimaryCareProvider = modDBConnect.currentUser
 
   
   ReceivingFacility.ApplicationIdentifier = "Bernd general practice"
   
   TempFile = Open "/home/bernd/svn/easygp/referraltext"
   While Not Eof(TempFile)
      Line Input #TempFile, sLine
      ReferralLetterText = ReferralLetterText & sLine & "\n"
   Wend
   
   'possiblilities for the observation result status
   ' C RECORD COMING OVER Is A CORRECTION And THUS REPLACES A RESULT 338
   ' D DELETES THE OBX RECORD 339
   ' F FINAL RESULTS; CAN ONLY BE CHANGED With A CORRECTED RESULT.340
   ' I SPECIMEN In LAB; RESULTS PENDING 341
   ' P PRELIMINARY RESULTS 342
   ' R RESULTS ENTERED - - Not VERIFIED 343
   ' S PARTIAL RESULTS 344
   ' U RESULTS STATUS CHANGE To FINAL.RESULTS DID Not CHANGE(DON 'T TRANSMIT TEST).   346
   ' X RESULTS CANNOT BE OBTAINED For THIS OBSERVATION 345    
   ObservationResultStatus = "S"
   
   AdmissionType = "R"  'A  = ACCIDENT   E = EMERGENCY L = LABOR  R = ROUTINE 
   AttachmentsArray.Add(ReferralLetterText, 1)
   message.createHL7Message_REF_I12(ConsultingProvider, ReferredtoProvider, PrimaryCareProvider, ReceivingFacility, 1, ObservationResultStatus, "A", "R", "GRF", "RP", "S", AttachmentsArray,, AdmissionType)

   '----------------------------------------------------------------------
   'Variables:
     '- ConsultingDoctor_XCN: Needs to be a object of the cHL7Datatype_XCN class and contains the information of the receiving doctor 
   '- ProviderRole_ST:  needs to be a string and contains the information what role the cunsulting doctor has in this referral message that is coded according to the hl7 table 0286 Referring Provider = 'RP' Primary Care Provider = 'PP' Consulting Provider = 'CP' Referred To Provider = 'RT'
   '- ReceivingFacility_HD: Needs to be a object of the cHL7Datatype_HD class and contains the information of the receiving facility 
   '- ToTransferPatient_fk_Patient: Needs to be an integer and contains the foreign key which gives the information were the data of the to reffering patient is storred in the DB
   '- ObservationResultStatus: Needs to be a string which is coded according to the HL7 table 85 
   '- ReferralStatus is a String and needs to be coded according to the hl7 table 0283 Accepted = 'A' Pending = 'P' Rejected = 'R' Expired = 'E'
   '- OriginatingReferralIdentifier(Optional) is a hl7 EI datatype and contains the global universal identifyer of this referral message (GUID) it can be passed to this function if this is a answer to a previos referral message otherwise a GUID will be generated from this function
   '- ReferralPriority is a hl7 datatype CE and needs to be coded according to the hl7 table 0280 (conditional) With highest priority = 'S' As soon as possible = 'A' Urgent = 'U' Early = 'E' Routine = 'R'
   '- ReferralType is a hl7 Datatype sting and needs to be coded according to the hl7 table 0281 (conditional) General referral = ‘GRF’Discharge referral = ‘DRF’Shared care update = ‘SCU’Notification = ‘NOT’Shared EHR update = ‘SEU’Decision support system update =‘DSU’
   '- ReferralDisposition is a hl7 datatype CE and needs to be coded according to hl7 table 0282 and says what is expected of the receiver (Optional) (Send written report = ‘WR’ Return patient after evaluation =‘RP’Assume management = ‘AM’Second opinion = ‘SO’ NOTE: ‘SO’ = Provide second, third Or other opinion. Additional Australian table values: Discharge summary = ‘DS’ Update care plan = ‘UCP’ Update health record = ‘UHR’ Case conference = ‘CC’ Notification – no further action =‘FI’)
   '- ReferralReason is a hl7 datatype CE and must be coded according to the hl7 table 0336 (Second opinion = ‘S’ Patient preference = ‘P’ Provider ordered = ‘O’ Work load = ‘W’ 
   '- Attachments(optional): this is a string array and caintains sings such a letter text a pdf or a picture as a sting ( be carefull to convert the attachments into the right format before calling this function
   '- AdmissionType(optional): Needs to be a string which is coded according to the HL7 user table 7
   '- PatientClass(optional): Needs to be a string which is coded according to the HL7 user table 4
   '----------------------------------------------------------------------
   
End 
