' Gambas class file

Public Sub Button1_Click()

Dim message As New CHL7MessageTransferPatient
Dim ReceivingFacility As CHL7Datatype_HD
Dim ConsultingDoctor As CHL7Datatype_XCN
Dim ReferralLetterText As String
Dim TempFile As File 'just for testing
Dim sLine As String 'just for testing
Dim AdmissionType As String
Dim ObservationResultStatus As String

ConsultingDoctor = New CHL7Datatype_XCN
ReceivingFacility = New CHL7Datatype_HD

ConsultingDoctor.ProviderNumber = "xy4567896"
ConsultingDoctor.GivenName = "Friedel"
ConsultingDoctor.FamilyName = "Schmitt"
ConsultingDoctor.AssigningAuthority.UniversalID = "AUSHICPR"
ConsultingDoctor.NameTypeCode = "L"
ConsultingDoctor.IdentifyerTypeCode = "UPIN"

ReceivingFacility.ApplicationIdentifier = "MedicalCenterXY"

TempFile = Open "/home/bernd/svn/easygp/referraltext"
While Not Eof(TempFile)
  Line Input #TempFile, sLine
  ReferralLetterText = ReferralLetterText & sLine & "\n"
Wend

'possiblilities for the observation result status
' C RECORD COMING OVER Is A CORRECTION And THUS REPLACES A RESULT 338
' D DELETES THE OBX RECORD 339
' F FINAL RESULTS; CAN ONLY BE CHANGED With A CORRECTED RESULT.340
' I SPECIMEN In LAB; RESULTS PENDING 341
' P PRELIMINARY RESULTS 342
' R RESULTS ENTERED - - Not VERIFIED 343
' S PARTIAL RESULTS 344
' U RESULTS STATUS CHANGE To FINAL.RESULTS DID Not CHANGE(DON 'T TRANSMIT TEST).   346
' X RESULTS CANNOT BE OBTAINED For THIS OBSERVATION 345    
ObservationResultStatus = "S"

AdmissionType = "R"  'A  = ACCIDENT   E = EMERGENCY L = LABOR  R = ROUTINE 
message.CreateHL7Message_TransferPatient(ConsultingDoctor, ReceivingFacility, 1, ReferralLetterText, ObservationResultStatus, AdmissionType)

End 
