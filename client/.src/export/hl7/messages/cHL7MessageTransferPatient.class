' Gambas class file

' 
' Function to fill all required fields for the message
' 

Public Sub CreateHL7Message_TransferPatient(cc As CConsult)
   
   Dim MSH As CHL7Segment_MSH
   Dim PID As CHL7Segment_PID
   Dim PV1 As CHL7Segment_PV1

   
   MSH = New CHL7Segment_MSH
   PID = New CHL7Segment_PID
   'PV1 = New CHL7Segment_PV1
   '
   MSH.MessageType_MSG_Req.message_code = "ADT"
   MSH.MessageType_MSG_Req.trigger_event = "A02"
   MSH.MessageControlID_ST_Req = Format$(Now, "dd-mm-yy-hh-MM")
   PID.Populate(cc)
   
   'PV1.SegmentID_ID_Req = "PV1"
   'PV1.SetID_SI_Opt = "1"
   'PV1.tientClass_IS_Req = ?
   'PV1.ReferringDoctor_XCN_Opt.ProviderNumber = UserInformation["provider_number"]
   'PV1.ReferringDoctor_XCN_Opt.FamilyName = UserInformation["surrname"] 
   'PV1.ReferringDoctor_XCN_Opt.GivenName = UserInformation["firstname"]
   'PV1.ReferringDoctor_XCN_Opt.Prefix = UserInformation["titel"]
   'PV1.ReferringDoctor_XCN_Opt.AssigningAuthority.UniversalID = "AUSHICPR"
   'PV1.ReferringDoctor_XCN_Opt.NameTypeCode = "L"
   
  modHL7Emitter.Emit("\n", File.Out, [MSH, PID]) ' NOTE: separator here should be \r, but to be visible in a UNIX terminal use \n
End


Static Public Sub UnitTest()
   
  Dim cc As CConsult
  Dim s As New CHL7MessageTransferPatient
  
  cc = New CConsult(modContactsDBI.Patient_Get_Using_PK(1)) 
  s.CreateHL7Message_TransferPatient(cc) 
End
