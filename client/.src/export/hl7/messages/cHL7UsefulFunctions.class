' Gambas class file

' Copyright (C) 2012 Bernd Brinkmann brinkmann_bernd@gmx.de

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'----------------------------------------------------------------------
'
'

Public Function FindTheRightPhoneNumber(Fk_Patient As Integer) As CHL7Datatype_XTN
   
   Dim p As Collection
   Dim Contacts As Collection
   Dim ReturnValue As New CHL7Datatype_XTN
   Dim anyphone As String
   Dim right_types As String[] = ["Mobile  Phone", "Home", "Work", "Phone", "VOIP"]
   
   Contacts = modContactsDBI.person_comms_get(Fk_Patient)
   
   For Each p In Contacts
      If right_types.Exist(p!type) Then
         anyphone = p!value
         If p!preferred_method Then  'if this contact number is the preferred number set this as Phone number 
            
            'Telecommunication use code table 0201
            '          ' Asn Answering Service Number Nummer des Antwortdienstes    
            '          ' BPN Beeper Number    
            '          ' EMR Emergency Number Notfallnummer    
            '          ' NET Network(email)Address Netzwerkadresse(E - Mail)    
            '          ' ORN Other Residence Number Nebenwohnsitznummer    
            '          ' PRN Primary Residence Number Hauptwohnsitznummer    
            '          ' VHN Vacation Home Number Ferienwohnsitznummer    
            '          ' WPN Work Number Dienstnummer    
            '          
            'Telecommunication equipment type  table 0202
            '          ' BP     Beeper    
            '          ' CP     Cellular Phone Mobiltelephon    
            '          ' FX     Fax Fax    
            '          ' Internet Internet Address: Use Only If Telecommunication Use Code Is NET    
            '          ' MD     Modem Modem    
            '          ' PH     Telephone Telephon    
            '          ' X.400  X.400 email address: Use Only If Telecommunication Use Code Is Net
            '          
            If p!type = "Mobile  Phone" Then 
               ReturnValue.telecommunicationUseCode_ID = "PRN"
               ReturnValue.telecommunicationEquipmentType_ID = "CP" 
            Else
               ReturnValue.telecommunicationEquipmentType_ID = "PH"
            Endif
            
            If p!type = "Home" Then
               ReturnValue.telecommunicationUseCode_ID = "PRN"
            Endif
            If p!type = "Work" Then 
               ReturnValue.telecommunicationUseCode_ID = "WPN"
            Endif
            If p!type = "Phone" Then 
               ReturnValue.telecommunicationUseCode_ID = "PRN"
            Endif
            If p!type = "VOIP" Then 
               ReturnValue.telecommunicationUseCode_ID = "PRN"
            Endif
            
            ReturnValue.PhoneNumber_ST = p!value
            Return ReturnValue
         End If
      Endif
   Next
               If p!type = "Mobile  Phone" Then 
               ReturnValue.telecommunicationUseCode_ID = "PRN"
               ReturnValue.telecommunicationEquipmentType_ID = "CP" 
            Else
               ReturnValue.telecommunicationEquipmentType_ID = "PH"
            Endif
            
            If p!type = "Home" Then
               ReturnValue.telecommunicationUseCode_ID = "PRN"
            Endif
            If p!type = "Work" Then 
               ReturnValue.telecommunicationUseCode_ID = "WPN"
            Endif
            If p!type = "Phone" Then 
               ReturnValue.telecommunicationUseCode_ID = "PRN"
            Endif
            If p!type = "VOIP" Then 
               ReturnValue.telecommunicationUseCode_ID = "PRN"
            Endif
            
            ReturnValue.PhoneNumber_ST = anyphone
   Return ReturnValue
   
End

