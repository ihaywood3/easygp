' Gambas class file

'Variable name : Variablecontent_DataType_Required(Req)orOptional(Opt)
' 
' TODO:
' 
' Set Function For Each Optional variable To make this vatiale accessable form the outside And To be able To controll the value taht has To be set that it Is A proper value For this variable(syntax etc)


Public SegmentID_ST_Req As String = "MSH"
Public SendingApplication_HD_Opt As New CHL7Datatype_HD
Public SendingFacility_HD_Opt As New CHL7Datatype_HD
Public ReceivingApplication_HD_Opt As New CHL7Datatype_HD
Public ReceivingFacility_HD_Opt As New CHL7Datatype_HD
Public MessageDateTime_TS_Opt As New CHL7Datatype_TS
Public Security_ST_Opt As String
Public MessageType_ST_Req As String
Public MessageControlID_ST_Req As String
Public ProcessingID_PT_Req As New CHL7Datatype_PT
Public VersionID_ID_Req As String
Public SequenceNumber_NM_Opt As Integer
Public ContinuationPointer_ST_Opt As String
Public AcceptAcknowledgmentType_ID_Opt As String
Public ApplicationAcknowledgmentType_ID_Opt As String
Public CoountryCode_ID_Opt As String
Public CharacterSet_ID_opt As String
Public PrincipalLanguageOfMessage_CE_Opt As CHL7Datatype_CE

Public Sub FillWithData(ReceivingFacility_HD As CHL7Datatype_HD, MessageType As String)
   Dim UserInformation As Collection
   Dim PrimaryKey As Integer
   UserInformation = New Collection
   UserInformation = modDBConnect.currentUser
   
   PrimaryKey = modDBConnect.exec_query("Select nextval('documents.hl7_messages_pk_seq') as Pk;")!Pk   'gets the a unique value for the table were the massege will be strored an this value is also used to create a universalID
   
   SendingApplication_HD_OPT.ApplicationIdentifier = "EasyGP UltimateVersion 2.0.3.0.4.0.2.0.4.0.5"
   SendingFacility_HD_Opt.ApplicationIdentifier = UserInformation!organisation
   ReceivingFacility_HD_Opt = ReceivingFacility_HD
   MessageDateTime_TS_Opt.Year = Year(Now)
   MessageDateTime_TS_Opt.Month = Month(Now)
   MessageDateTime_TS_Opt.Day = Day(Now)
   MessageDateTime_TS_Opt.Hour = Hour(Now)
   MessageDateTime_TS_Opt.Minute = Minute(Now)
   MessageDateTime_TS_Opt.Second = Second(Now)
   MessageType_ST_Req = MessageType
   MessageControlID_ST_Req = Year(Now) & "-" & Month(Now) & "-" & Day(Now) & "-" & Hour(Now) & "-" & Minute(Now) & "-" & Second(Now) & " - " & PrimaryKey
   ProcessingID_PT_Req.ProcessingID = "P" 
   VersionID_ID_Req = "2.3.1"
End




Public Function GetString(MshSegment As CHL7Segment_MSH) As String

  Return "MSH|^~" & "\\" & "&|" & MshSegment.SendingApplication_HD_Opt.ApplicationIdentifier & "|" & MshSegment.SendingFacility_HD_Opt.ApplicationIdentifier & "|" & "|" & ReceivingFacility_HD_Opt.ApplicationIdentifier & "|" & MshSegment.MessageDateTime_TS_Opt.Year & MshSegment.MessageDateTime_TS_Opt.Month & MshSegment.MessageDateTime_TS_Opt.Day & MshSegment.MessageDateTime_TS_Opt.Hour & MshSegment.MessageDateTime_TS_Opt.Second & "+1000" & "|" & "|" & MshSegment.MessageType_ST_Req & "|" & MshSegment.MessageControlID_ST_Req & "|" & MshSegment.ProcessingID_PT_Req.ProcessingID & "|" & MshSegment.VersionID_ID_Req & "|" & "|" & "|" & "|" & "|" & "Aus"  

End
