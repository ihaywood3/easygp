' Gambas class file

'Variable name : Variablecontent_DataType_Required(Req)orOptional(Opt)
' 
' TODO:
' 
' Set Function For Each Optional variable To make this vatiale accessable form the outside And To be able To controll the value taht has To be set that it Is A proper value For this variable(syntax etc)


Public SegmentID_ST_Req As String = "MSH"
Public SendingApplication_HD_Opt As New CHL7Datatype_HD
Public SendingFacility_HD_Opt As New CHL7Datatype_HD
Public ReceivingApplication_HD_Opt As New CHL7Datatype_HD
Public ReceivingFacility_HD_Opt As New CHL7Datatype_HD
Public MessageDateTime_TS_Opt As New CHL7Datatype_TS
Public Security_ST_Opt As String
Public MessageType_ST_Req As String
Public MessageControlID_ST_Req As String
Public ProcessingID_PT_Req As New CHL7Datatype_PT
Public VersionID_ID_Req As String
Public SequenceNumber_NM_Opt As String
Public ContinuationPointer_ST_Opt As String
Public AcceptAcknowledgmentType_ID_Opt As String
Public ApplicationAcknowledgmentType_ID_Opt As String
Public CountryCode_ID_Opt As String
Public CharacterSet_ID_opt As String
Public PrincipalLanguageOfMessage_CE_Opt As New CHL7Datatype_CE

Public Sub _new(ReceivingFacility_HD As CHL7Datatype_HD, MessageType As String)
   Dim UserInformation As Collection
   Dim PrimaryKey As Integer
   UserInformation = New Collection
   UserInformation = modDBConnect.currentUser
   
   PrimaryKey = modDBConnect.exec_query("Select nextval('documents.hl7_messages_pk_seq') as Pk;")!Pk   'gets the a unique value for the table were the massege will be strored an this value is also used to create a universalID
   
   SegmentID_ST_Req = "1"
   SendingApplication_HD_OPT.ApplicationIdentifier = "EasyGP UltimateVersion 2.0.3.0.4.0.2.0.4.0.5"
   SendingFacility_HD_Opt.ApplicationIdentifier = UserInformation!organisation
   ReceivingFacility_HD_Opt = ReceivingFacility_HD
   MessageDateTime_TS_Opt.Year = Year(Now)
   MessageDateTime_TS_Opt.Month = Month(Now)
   MessageDateTime_TS_Opt.Day = Day(Now)
   MessageDateTime_TS_Opt.Hour = Hour(Now)
   MessageDateTime_TS_Opt.Minute = Minute(Now)
   MessageDateTime_TS_Opt.Second = Second(Now)
   MessageType_ST_Req = MessageType
   MessageControlID_ST_Req = Year(Now) & "-" & Month(Now) & "-" & Day(Now) & "-" & Hour(Now) & "-" & Minute(Now) & "-" & Second(Now) & "-" & PrimaryKey
   ProcessingID_PT_Req.ProcessingID = "P" 
   VersionID_ID_Req = "2.3.1"
   CountryCode_ID_Opt = "AU"
End




Public Function Emit(dest As Stream)

Print #dest, "MSH|^~\\&|";
modHL7Emitter.Emit("|", dest, [SegmentID_ST_Req, SendingApplication_HD_Opt, SendingFacility_HD_Opt, ReceivingApplication_HD_Opt, ReceivingFacility_HD_Opt, MessageDateTime_TS_Opt,
 Security_ST_Opt, MessageType_ST_Req, MessageControlID_ST_Req, ProcessingID_PT_Req, VersionID_ID_Req, SequenceNumber_NM_Opt,
 ContinuationPointer_ST_Opt, AcceptAcknowledgmentType_ID_Opt, ApplicationAcknowledgmentType_ID_Opt, CountryCode_ID_Opt, CharacterSet_ID_opt, PrincipalLanguageOfMessage_CE_Opt])

End
