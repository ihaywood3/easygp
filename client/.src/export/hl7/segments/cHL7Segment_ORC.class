' Gambas class file

Public OrderControlCode_ST As String
Public PlacerOrderNumber_EI As New CHL7Datatype_EI
Public FillerOrderNumber_EI As New CHL7Datatype_EI
Public PlacerGroupNumber_EI As New CHL7Datatype_EI
Public OrderStatus_ST As String
Public DateTimeOfTransaction_TS As New CHL7Datatype_TS
Public OrderProvider As New CHL7Datatype_XCN
Public OrderingFacilityName As New CHL7Datatype_XON
Public OrderingFacilityAddress As New CHL7Datatype_AD
Public OrderingFacilityPhoneNumber As New CHL7Datatype_XTN
Public OrderingProviderAddress As New CHL7Datatype_AD

Public Sub _new(OrderControlCode As String, Optional PlacerOrderNumber As CHL7Datatype_EI, Optional FillerOrderNumber As CHL7Datatype_EI, Optional PlacerGroupNumber As CHL7Datatype_EI)
     
   Dim UserInformation As Collection
      
   UserInformation = New Collection
   UserInformation = modDBConnect.currentUser
   
   OrderControlCode_ST = OrderControlCode
   Try PlacerOrderNumber_EI = PlacerOrderNumber
   Try FillerOrderNumber_EI = FillerOrderNumber
   Try PlacerGroupNumber_EI = PlacerGroupNumber
   OrderStatus_ST = "NM"
DateTimeOfTransaction_TS.Year = Year(Now)
DateTimeOfTransaction_TS.Month = Month(Now)
DateTimeOfTransaction_TS.Day = Day(Now)
DateTimeOfTransaction_TS.Hour = Hour(Now)
DateTimeOfTransaction_TS.Minute = Minute(Now)
DateTimeOfTransaction_TS.Second = Second(Now)
   
   
   OrderProvider.FamilyName = UserInformation["surname"] 
   OrderProvider.GivenName = UserInformation["firstname"]
   ' OrderProvider.IdentifyerTypeCode
   ' OrderProvider.LastNamePrefix 
   ' OrderProvider.MiddleInitialOrName
   OrderProvider.NameTypeCode = "L"
   OrderProvider.Prefix = UserInformation["titel"]
   OrderProvider.ProviderNumber = UserInformation["provider_number"]
   ' OrderProvider.SourceTable
   ' OrderProvider.Suffix
   OrderProvider.AssigningAuthority.UniversalID = "AUSHICPR" 
'    OrderProvider.AssigningFacility
   
   ' OrderingFacilityAddress =
   ' OrderingFacilityName =
   ' OrderingFacilityPhoneNumber =
   ' OrderingProviderAddress =
   ' 
End

Public Function Emit(dest As Stream)
   modHL7Emitter.Emit("|", dest, [OrderControlCode_ST, PlacerOrderNumber_EI, CHL7Datatype_EI, FillerOrderNumber_EI,
   PlacerGroupNumber_EI, OrderStatus_ST, DateTimeOfTransaction_TS, OrderProvider, OrderingFacilityName,
   OrderingFacilityAddress, OrderingFacilityPhoneNumber, OrderingProviderAddress])
'    Return "ORC|" & OrderStatus_ST & "||" & "46433 ^ Whitebridge Medical Centre ^ 69954767 - 2392 - 495E-87 FE - 9 CBD3BACD06F ^ GUID" & "|||||||||" & OrderProvider.ProviderNumber & "^" & OrderProvider.FamilyName & "^" & OrderProvider.GivenName & "^^^" & OrderProvider.Prefix & "^^^^^^^" & OrderProvider.AssigningAuthority.UniversalID  
End
