' Gambas class file

' Copyright (C) 2012-2013 Bernd Brinkmann brinkmann_bernd@gmx.de

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'----------------------------------------------------------------------
'
Public OrderControlCode_ST As String
Public PlacerOrderNumber_EI As New CHL7Datatype_EI
Public FillerOrderNumber_EI As New CHL7Datatype_EI
Public PlacerGroupNumber_EI As New CHL7Datatype_EI
Public OrderStatus_ST As String
Public DateTimeOfTransaction_TS As New CHL7Datatype_TS
Public OrderProvider As New CHL7Datatype_XCN
Public OrderingFacilityName As New CHL7Datatype_XON
Public OrderingFacilityAddress As New CHL7Datatype_AD
Public OrderingFacilityPhoneNumber As New CHL7Datatype_XTN
Public OrderingProviderAddress As New CHL7Datatype_AD

Public Sub _new(OrderControlCode As String, Optional PlacerOrderNumber As CHL7Datatype_EI, Optional FillerOrderNumber As CHL7Datatype_EI, Optional PlacerGroupNumber As CHL7Datatype_EI)
   
   Dim UserInformation As Collection
   
   UserInformation = New Collection
   UserInformation = modDBConnect.currentUser
   
   OrderControlCode_ST = OrderControlCode
   Try PlacerOrderNumber_EI = PlacerOrderNumber
   Try FillerOrderNumber_EI = FillerOrderNumber
   Try PlacerGroupNumber_EI = PlacerGroupNumber
   OrderStatus_ST = "NM"
   DateTimeOfTransaction_TS.TimeStamp = Now
   
   ' OrderProvider.FamilyName = UserInformation["surname"] 
   ' OrderProvider.GivenName = UserInformation["firstname"]
   ' OrderProvider.NameTypeCode = "L"
   ' OrderProvider.Prefix = UserInformation["titel"]
   ' OrderProvider.ProviderNumber = UserInformation["provider_number"]
   ' OrderProvider.AssigningAuthority.UniversalID = "AUSHICPR" 
   ' ' 
   ' 
End

Public Function Emit(dest As Stream)
   '----------------------------------------------------------------------
   'This function puts the information contained by this class object into HL7 format
   'Variables:
   '-dest:  a stream variable where the result will be written to 
   '----------------------------------------------------------------------
   '
   
   modHL7Emitter.Emit("|", dest, ["ORC", OrderControlCode_ST, PlacerOrderNumber_EI, CHL7Datatype_EI, FillerOrderNumber_EI,
      PlacerGroupNumber_EI, OrderStatus_ST, DateTimeOfTransaction_TS, OrderProvider, OrderingFacilityName,
      OrderingFacilityAddress, OrderingFacilityPhoneNumber, OrderingProviderAddress])
   '    Return "ORC|" & OrderStatus_ST & "||" & "46433 ^ Whitebridge Medical Centre ^ 69954767 - 2392 - 495E-87 FE - 9 CBD3BACD06F ^ GUID" & "|||||||||" & OrderProvider.ProviderNumber & "^" & OrderProvider.FamilyName & "^" & OrderProvider.GivenName & "^^^" & OrderProvider.Prefix & "^^^^^^^" & OrderProvider.AssigningAuthority.UniversalID  
   
End
