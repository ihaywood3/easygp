' Gambas class file

' Copyright (C) 2012-2013 Bernd Brinkmann brinkmann_bernd@gmx.de

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'----------------------------------------------------------------------
'
' PV1 - patient visit segment
' 
' 
' The PV1 segment Is Used To convey additional information about the patient â€™s admission/registration that is unique to this visit.

Public SegmentID_ID_Req As String = "PV1"
Public SetID_SI_Opt As String
Public PatientClass_IS_Req As String
Public AssignedPatientLocation_PL_Opt As String
Public AdmissionType_PL_Opt As String
Public AdmitNumber_CX_Opt As New CHL7Datatype_CX
Public PriorPatientLocation_PL_Opt As New CHL7Datatype_PL
Public AttendingDoctor_XCN_Opt As New CHL7Datatype_XCN
Public ReferringDoctor_XCN_Opt As New CHL7Datatype_XCN
Public ConsultingDoctor_XCN_Opt As New CHL7Datatype_XCN
Public HospitalService_Is_Opt As String
Public TemporaryLoacation_PL_Opt As New CHL7Datatype_PL
Public PreAdmitTestIdicator_Is_Opt As String
Public ReadmissionIndicator_Is_Opt As String
Public AdmitSource_Is_Opt As String
Public AmbulatoryStatus_Is_Opt As String
Public VIPIndicator_Is_Opt As String
Public AdmittingDoctor_CN_Opt As New CHL7Datatype_CN
Public PatientType_Is_Opt As String
Public VisitNumber_CX_Opt As New CHL7Datatype_CX
Public FinancialClass_FC_Opt As String
Public ChargePriceIndicator_Is_Opt As String
Public CourtesyCode_Is_Opt As String
Public CreditRating_Is_Opt As String
Public ContractCode_Is_Opt As String
Public ContractEffectiveDate_DT_Opt As New CHL7Datatype_DT
Public ContractAmount_NM_Opt As String
Public ContractPeriod_NM_Opt As String
Public InterestCode_Is_Opt As String
Public TransferToBadDebtCode_Is_Opt As String
Public TransferToBadDebtDate_DT_Opt As New CHL7Datatype_DT
Public BadDebtAgencyCode_ST_Opt As String
Public BadDebtTransferAmt_NM_Opt As String
Public BadDebtRecoveryAmt_NM_Opt As String
Public DeleteAccountIndicator_Is_Opt As String
Public DeleteAccountDate_DT_Opt As New CHL7Datatype_DT
Public DischargeDisposition_Is_Opt As String
Public DischargedToLocation_CM_Opt As String
Public DietType_Is_Opt As String
Public ServicingFacility_Is_Opt As String
Public BedStatus_Is_Opt As String
Public AccountStatus_Is_Opt As String
Public PendingLocation_PL_Opt As New CHL7Datatype_PL
Public PriorTemporaryLocation_PL_Opt As New CHL7Datatype_PL
Public AdmitDateTime_TS_Opt As New CHL7Datatype_TS
Public DischargeDateTime_TS_Opt As New CHL7Datatype_TS
Public CurrentPatientBalance_NM_Opt As String
Public TotalCharges_NM_Opt As String
Public TotalAdjustments_NM_Opt As String
Public TotalPayments_NM_Opt As String
Public AlternateVisitID_CX_Opt As New CHL7Datatype_CX
Public VisitIndicator_Is_Opt As String
Public OtherHealthcareProvider_CN_Opt As New CHL7Datatype_CN

Public Sub _new(ConsultingDoctor As Collection, Optional AdmissionType As String, Optional PatientClass As String = "O")
  
   Dim UserInformation As New Collection

   UserInformation = modDBConnect.currentUser
   
   SegmentID_ID_Req = "PV1"
   SetID_SI_Opt = "1"
   PatientClass_IS_Req = PatientClass  ' O=Outpatient, E=emergency, I=inpatient, P=preadmission clinic, B=obstetrics, R=recurring
   AdmissionType_PL_Opt = AdmissionType   'A  = ACCIDENT   E = EMERGENCY L = LABOR  R = ROUTINE 
   ReferringDoctor_XCN_Opt.ProviderNumber = UserInformation["provider_number"]
   ReferringDoctor_XCN_Opt.FamilyName = UserInformation["surname"] 
   ReferringDoctor_XCN_Opt.GivenName = UserInformation["firstname"]
   ReferringDoctor_XCN_Opt.Prefix = UserInformation["title"]
   ReferringDoctor_XCN_Opt.AssigningAuthority.ApplicationIdentifier = "AUSHICPR"
   ReferringDoctor_XCN_Opt.NameTypeCode = "L" 'Legal Name
   ReferringDoctor_XCN_Opt.IdentifierTypeCode = "UPIN" ' not sure if correct
   
   ConsultingDoctor_XCN_Opt.ProviderNumber = ConsultingDoctor["provider_number"]
   ConsultingDoctor_XCN_Opt.FamilyName = ConsultingDoctor["surname"]
   ConsultingDoctor_XCN_Opt.GivenName = ConsultingDoctor["firstname"]
   ConsultingDoctor_XCN_Opt.Prefix = ConsultingDoctor["title"]
   ConsultingDoctor_XCN_Opt.AssigningAuthority.ApplicationIdentifier = "AUSHICPR"
   ConsultingDoctor_XCN_Opt.NameTypeCode = "L" ' Legal Name
   ConsultingDoctor_XCN_Opt.IdentifierTypeCode = "UPIN" ' not sure if correct
   
End

Public Sub Emit(dest As Stream)
   '----------------------------------------------------------------------
   'This function puts the information contained by this class object into HL7 format
   'Variables:
   '-dest:  a stream variable where the result will be written to 
   '----------------------------------------------------------------------
   '

   modHL7Emitter.Emit("|", dest, [SegmentID_ID_Req, SetID_SI_Opt, PatientClass_IS_Req, AssignedPatientLocation_PL_Opt, AdmissionType_PL_Opt, AdmitNumber_CX_Opt, PriorPatientLocation_PL_Opt, AttendingDoctor_XCN_Opt,
      ReferringDoctor_XCN_Opt, ConsultingDoctor_XCN_Opt, HospitalService_Is_Opt, TemporaryLoacation_PL_Opt, PreAdmitTestIdicator_Is_Opt,
      ReadmissionIndicator_Is_Opt, AdmitSource_Is_Opt, AmbulatoryStatus_Is_Opt, VIPIndicator_Is_Opt, AdmittingDoctor_CN_Opt, PatientType_Is_Opt,
      VisitNumber_CX_Opt, FinancialClass_FC_Opt, ChargePriceIndicator_Is_Opt, CourtesyCode_Is_Opt, CreditRating_Is_Opt, ContractCode_Is_Opt,
      ContractEffectiveDate_DT_Opt, ContractAmount_NM_Opt, ContractPeriod_NM_Opt, InterestCode_Is_Opt, TransferToBadDebtCode_Is_Opt,
      TransferToBadDebtDate_DT_Opt, BadDebtAgencyCode_ST_Opt, BadDebtTransferAmt_NM_Opt, BadDebtRecoveryAmt_NM_Opt, 
      DeleteAccountIndicator_Is_Opt, DeleteAccountDate_DT_Opt, DischargeDisposition_Is_Opt, DischargedToLocation_CM_Opt, DietType_Is_Opt, 
      ServicingFacility_Is_Opt, BedStatus_Is_Opt, AccountStatus_Is_Opt, PendingLocation_PL_Opt, PriorTemporaryLocation_PL_Opt, AdmitDateTime_TS_Opt, 
      DischargeDateTime_TS_Opt, CurrentPatientBalance_NM_Opt, TotalCharges_NM_Opt, TotalAdjustments_NM_Opt, TotalPayments_NM_Opt,
      AlternateVisitID_CX_Opt, VisitIndicator_Is_Opt, OtherHealthcareProvider_CN_Opt])

End
