' Gambas class file

' Copyright (C) 2012-2013 Bernd Brinkmann brinkmann_bernd@gmx.de

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'----------------------------------------------------------------------
'
'Variable name : Variablecontent_DataType_Required(Req)orOptional(Opt)
' 
' TODO:
' 
' Set Function For Each Optional variable To make this vatiale accessable form the outside And To be able To controll the value taht has To be set that it Is A proper value For this variable(syntax etc)
Public ReferralStatus_ID As New CHL7Datatype_CE
Public ReferralPriority_CE As New CHL7Datatype_CE
Public ReferralType_CE As New CHL7Datatype_CE
Public ReferralDisposition_CE As New CHL7Datatype_CE
Public ReferralCategory_CE As New CHL7Datatype_CE
Public OriginatingReferralIdentifier_CE As New CHL7Datatype_EI
Public EffectiveDate_TS As New CHL7Datatype_TS
Public ExpirationDate_TS As New CHL7Datatype_TS
Public ProcessDate_TS As New CHL7Datatype_TS
Public ReferralReason_CE As New CHL7Datatype_CE
Public ExternalReferralIdentifier_EI As New CHL7Datatype_EI


Public Sub _new(ReferralStatus As CHL7Datatype_CE, OriginatingReferralIdentifier As CHL7Datatype_EI, Optional ReferralPriority As CHL7Datatype_CE, Optional ReferralType As CHL7Datatype_CE, Optional ReferralDisposition As CHL7Datatype_CE, Optional ReferralReason As CHL7Datatype_CE)
   '-------------------------------
   'this function is called when a new EVN object of this class is created and it automatically fills 
   'this object with all the required data
   'Variables:
   '- ReferralStatus is hl7 CE datatype and needs to be coded according to the hl7 table 0283 Accepted = 'A' Pending = 'P' Rejected = 'R' Expired = 'E'
   '- OriginatingReferralIdentifier is a hl7 datatype EI and contains the global universal identifyer of this referral message (GUID)
   '- ReferralPriority is a hl7 datatype CE and needs to be coded according to the hl7 table 0280 (conditional) With highest priority = 'S' As soon as possible = 'A' Urgent = 'U' Early = 'E' Routine = 'R'
   '- ReferralType is a hl7 Datatype EI and needs to be coded according to the hl7 table 0281 (conditional) General referral = ‘GRF’Discharge referral = ‘DRF’Shared care update = ‘SCU’Notification = ‘NOT’Shared EHR update = ‘SEU’Decision support system update =‘DSU’
   '- ReferralDisposition is a hl7 datatype CE and needs to be coded according to hl7 table 0282 and says what is expected of the receiver (Optional) (Send written report = ‘WR’ Return patient after evaluation =‘RP’Assume management = ‘AM’Second opinion = ‘SO’ NOTE: ‘SO’ = Provide second, third Or other opinion. Additional Australian table values: Discharge summary = ‘DS’ Update care plan = ‘UCP’ Update health record = ‘UHR’ Case conference = ‘CC’ Notification – no further action =‘FI’)
   '- ReferralReason is a hl7 datatype CE and must be coded according to the hl7 table 0336 (Second opinion = ‘S’ Patient preference = ‘P’ Provider ordered = ‘O’ Work load = ‘W’ ‘S’ = Provide second, third or other oppinion    Notification(FYI) = ‘F’ Event summary = ‘E’
   '--------------------------------
   
   ReferralStatus_ID = ReferralStatus
   OriginatingReferralIdentifier_CE = OriginatingReferralIdentifier
  
   If Not IsNull(ReferralPriority) Then ReferralPriority_CE = ReferralPriority 
  
   If Not IsNull(ReferralType) Then ReferralType_CE = ReferralType
  
   If Not IsNull(ReferralDisposition) Then ReferralDisposition_CE = ReferralDisposition
  
   If Not IsNull(ReferralReason) Then ReferralReason_CE = ReferralReason
   ProcessDate_TS.TimeStamp = Now
   EffectiveDate_TS.TimeStamp = Now
   
End

Public Function Emit(dest As Stream)
   '----------------------------------------------------------------------
   'This function puts the information contained by this class object into HL7 format
   'Variables:
   '-dest:  a stream variable where the result will be written to 
   '----------------------------------------------------------------------
   '
   modHL7Emitter.Emit("|", dest, ["RF1", ReferralStatus_ID, ReferralPriority_CE, ReferralType_CE, ReferralDisposition_CE,
      ReferralCategory_CE, OriginatingReferralIdentifier_CE, EffectiveDate_TS, ExpirationDate_TS, ProcessDate_TS, 
      ReferralReason_CE, ExternalReferralIdentifier_EI])
   
End
' Gambas class file
