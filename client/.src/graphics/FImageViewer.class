' Gambas class file

Private Form_Magnify As FMagnify
Private Pictures As Collection
Private Picture As Collection
Private obs As Observer
Private NotesViewer As FHtmlViewer

Private currentconsult As CConsult

Public Sub Init(cons As CConsult)
   
   currentconsult = cons
   Form_Magnify = New FMagnify(VBox_DisplayArea)
   Reload()
   With NotesViewer = New FHtmlViewer(Vbox_ProgressNotes)
      .lblHtmlViewerHeading.Visible = True   
   End With
   
End

Public Sub Reload()
   
   Dim PB As PictureBox
   Dim Pic As Picture
   Dim HB As HBox
   Dim C As Collection
   
   Pictures = modImagesDBI.Patient_Images_Get(currentconsult!patient!fk_patient) 
   
   For Each picture In Pictures
      C = modGraphics.Blob_Convert_To_Picture(picture!image)
      Pic = C!picture
      picture!path = C!path
      With HB = New HBox(Scrollview1)
         .width = 100
         .background = Color.White
         .padding = 2 
      End With
      With PB = New PictureBox(HB) As "PictureBoxes"
         .Picture = Pic
         .Stretch = True 
         .Width = 100
         .tag = picture     
      End With
   Next
   
End

Public Sub PictureBoxes_MouseUp()

   Dim pn As Collection 
   
   Form_Magnify.Picture_Load(Last.tag!path)
   For Each PN In currentconsult!progress_notes
      If PN!fk_consult = Last.tag!fk_consult Then
         Print PN!notes
         PN!notes = Replace(PN!notes, "800", "25")
         PN!notes = Replace(Pn!notes, "600", "25")
         With NotesViewer
       
             PN!notes = modConsultDBI.Images_Get(PN!notes)
             .WebView1.HTML = PN!notes
            .lblHtmlViewerHeading.text = "Consult:" & Format(PN!consult_date, "dd/mm/yyyy") & " -  " & PN!title & " " & PN!firstname & " " & pn!surname
         End With
         Break
      End If
   Next

End
