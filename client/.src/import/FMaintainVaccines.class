' Gambas class file
' Copyright (C) 2008,2009 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'PURPOSE: Maintain vaccines and their schedule
'
Private currentSchedule As Collection  
Private currentvaccine As Collection
Private bediting As Boolean
Private bexit As Boolean
Private bkeyvalid As Boolean
Private Schedules As Collection
Private vaccines As Collection

Public Sub Form_Open()
  'gvar.staff_member = modGlobal.logon(Me)
  init()
  
End
Public Sub init()
  
  Settings_Load()
  Schedules = New Collection
  modVaccinationDBI.Schedules_Get(lvwSchedules)
  EditArea_Clear()
End

Public Sub Form_Close()
  
  Settings_SAve()
  
End

Public Sub Settings_SAve()
  
  
  
End

Public Sub Settings_Load()
  
  
  
End

Public Sub EditAreaButtons_Click()

  Select Case Last.tag
  Case "new"
   EditArea_Clear()
   currentSchedule = New cVaccineSchedule
  Case "accept"
      Schedule_Accept()
      
  End Select

End

Public Sub Schedule_New()
  EditArea_Clear()
End 

Public Sub Schedule_Accept()
       If Not Valid_Data() Then Return
       SchedulesList_UPdate()
       
End
Public Function SchedulesList_UPdate()
  
  
  
End

Public Function Valid_Data() As Boolean
    Return True
    
End


Public Function EditArea_TxtBox_ExcludeKeys(keycode As Integer) As Boolean  
      Select Case Last.Tag
        Case "schedule"
          bKeyValid = True
        Case "age from", "age to"
          bKeyValid = modUtil.AllowKeys(const.AllowKeys_Date_DWMY, keycode)
        Case "date inactive"
         bKeyValid = modUtil.AllowKeys(const.AllowKeys_Date_DWMY, keycode)
      End Select
       Return bKeyValid

End

Public Sub EditArea_Clear()
   bexit = True
     txtSchedule.text = ""
     txtAgeFrom.text = ""
     txtAgeTo.text = ""
     txtDateInactive.text = ""
     txtAgeTo.text = ""
     chkFemaleOnly.value = False
     chkATSI.value = False
     chkSeasonal.value = False
     currentSchedule = New cVaccineSchedule
     listview1.Visible = False
   bExit = False
  
End

Public Sub txtEditArea_KeyPress()
bkeyvalid = EditArea_TxtBox_ExcludeKeys(key.code)
 If bkeyvalid = False Then
     Stop Event
     Return
   End If
'Print "here", Key.code, Last.tag
  Select Case Key.Code
     Case Key.tab, Key.Return
      Select Case Last.tag
    
       Case "schedule"
       'Print "in schedule"
            txtAgeFrom.SetFocus()
            
       Case "age from"
            txtAgeTo.SetFocus()
       Case "age to"
           txtDateInactive.SetFocus() 'most likely don't want the check boxes
       Case "inactive"
            tbAccept.SetFocus()
      End Select
    Case Key.Down
      If listview1.Visible Then
         listview1.SetFocus()
         listview1.MoveFirst
         listview1.Item.Selected = True
      End If
  End Select


End
Public Sub listview1_DblClick()
        listview1.MoveCurrent
        listview1.tag.text = listview1.Item.text
        listview1.Visible = False
  
  
End

Public Sub listview1_KeyPress()
   If Key.code = Key.return Then
          listview1_DblClick()
          Select Case Last.tag.tag
          Case "schedule"
            txtAgeFrom.SetFocus()
            modVaccinationDBI.Vacccines_Guess(lvwPossibleVaccines, txtSchedule.text)
            
          End Select
          
   End If
   
  
End

Public Sub chkEditArea_Click()
   Select Case Last.tag
   Case "atsi"
         currentSchedule.ATSI = Last.value
   Case "seasonal"
         ' currentSchedule.
   Case "female only"
         currentSchedule.female_only = Last.value
   End Select

  

End

Public Sub chkEditArea_KeyPress()
  Select Case Key.Code
  Case Key.tab, Key.return
      Select Case Last.tag
      Case "atsi"
           chkSeasonal.SetFocus()
      Case "seasonal"
           txtDateInactive.SetFocus()
      Case "female only"
          chkATSI.SetFocus()
      End Select
 
 End Select
End

Public Sub txtEditArea_Change()
   Select Case Last.tag
   Case "schedule"
       currentSchedule.Name = Trim(txtSchedule.text)
   Case "date inactive"
         If Len(Trim(txtDateInactive.text)) Then
            Try currentSchedule.date_inactive = Val(txtDateInactive.text)
         End If 
   Case "vaccines"
   
   End Select
   
  

End

Public Sub txtEditArea_GotFocus()

     Select Case Last.tag
   Case "schedule"
        With listview1
          .top = vboxEditArea.Top + Hbox_Schedule.Top + hBox_Schedule.Height
          .left = txtSchedule.Left
          .width = txtSchedule.width
          .height = 200
          .Visible = False
        End With
   Case "age from"
   Case "age  to"
   End Select
listview1.Visible = False
End

Public Sub txtEditArea_KeyRelease()
   Select Case Last.tag
   Case "schedule"
     modVaccinationDBI.TargetDisease_get(listview1, txtSchedule)
   Case "vaccines"
   modVaccinationDBI.Vacccines_Guess(lvwPossibleVaccines, TxtFindVaccine.text)
   End Select

End
