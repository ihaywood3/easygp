' Gambas class file

Public Sub Init(occ As String)
   
  TextLabel1.text = "Please verify the spelling of this occupation" 
  txtOccupationNew.text = occ
End

Public Sub Run() As Boolean

   Return Not Me.ShowModal()

End

Public Sub btnOK_Click()
   Dim mso As CRow
   Dim R As Result
   Dim sql As String
   
   If txtOccupationVerified.text = "" Then 
      txtOccupationVerified.SetFocus()
      Return
   Endif                                                       
   '-----------------------------------------------------------
   'if the verified occupation spelling different to that found
   ' in the table putting the data into this field
   'save this as a probable mis-spelt occupation
   '-----------------------------------------------------------
   If modUtil.StripExtraBlanks(txtOccupationVerified.text) <> Trim(txtOccupationNew.text) Then    
      sql = "Select * from import_export.lu_misspelt_occupations where misspelt_occupation ILIKE $$"
      sql &= Lower(Trim(txtOccupationNew.text)) & "$$ AND " 
      sql &= "occupation ILIKE $$" & Lower(modUtil.StripExtraBlanks(txtOccupationVerified.text)) & "$$"
      R = modDBConnect.exec_query(sql)
      If Not R.count Then 
         mso = New CRow
         mso!occupation = Lower(modUtil.StripExtraBlanks(txtOccupationVerified.text))
         mso!misspelt_occupation = Lower(Trim(txtOccupationNew.text)) 'don't strip internal blanks
         mso.Save("import_export.lu_misspelt_occupations", "fk_lu_misspelt_occupations")
      modDBConnect.CommitTrans()
      End If   
   End If   
   const.globalstring = Lower(modUtil.StripExtraBlanks(txtOccupationVerified.text))
   Me.Close(True)

End

Public Sub btnCancel_Click()
   const.globalstring = ""
   Me.Close

End


