' Gambas class file

Private sRootDir As String
Private form_pdf As FPdf

Public Sub Form_Open()
   
   form_pdf = New FPdf(Vbox_PDF)
   
End

Public Sub Button1_Click()
   
   Dim sFile As String
   Dim sRootDir As String
   Dim sfile_ext As String
   Dim sFile_stem As String
   Dim x As Integer
   Dim cmd As String 
   Dim sSourceFile As String
   Dim sDestinationFile As String
   
   listview1.Clear()
   If Dialog.SelectDirectory() Then Return
   For Each sfile In Dir(Dialog.Path)
      sRootDir = Dialog.Path
      sSourceFile = modUtil.filepath_fix_Blanks(sRootDir &/ sfile)
      sDestinationFile = sRootDir &/ modUtil.Filename_Protect(File.BaseName(sFile)) & "." & File.Ext(Sfile)
      
      Select Case Lower(File.Ext(sFile))
         Case "rtf"
            If InStr(Lower(sFile), "letter") Or InStr(Lower(sFile), "report") Then  
               label1.text = "converting file: " & sSourceFile & " to pdf......"
               cmd = "cp " & sSourceFile & " " & sDestinationFile
               Shell cmd Wait
               cmd = "sh /usr/local/Ted/rtf2pdf.sh " & sDestinationFile & " " & sRootDir &/ File.BaseName(sDestinationFile) & ".pdf"
               Shell cmd Wait  
               listview1.Add(listview1.count, sRootDir &/ File.BaseName(sDestinationFile) & ".pdf")
               Shell "rm " & sDestinationFile Wait
            End If  
         Case "bmp"
         Case "tif"
         Case Else
            Message.Info("found a different extension " & File.Ext(sfile))
            
      End Select
      ' If InStr(Lower(sFile), "letter") Then  
      '    Print modUtil.filepath_fix_Blanks(sRootDir &/ sfile)
      '    sSourceFile = modUtil.filepath_fix_Blanks(sRootDir &/ sfile)
      '    sDestinationFile = sRootDir &/ modUtil.Filename_Protect(File.BaseName(sFile)) & "." & File.Ext(Sfile)
      '    Print sRootDir &/ modUtil.Filename_Protect(File.BaseName(sFile)) & "." & File.Ext(Sfile)
      '   '  Copy modUtil.filepath_fix_Blanks(sRootDir &/ sfile) To sRootDir &/ modUtil.Filename_Protect(File.BaseName(sFile)) & "." & File.Ext(Sfile)
      '     cmd = "cp " & sSourceFile & " " & sDestinationFile
      '     Shell cmd Wait
      '     cmd = "sh /usr/local/Ted/rtf2pdf.sh " & sDestinationFile & " " & sRootDir &/ File.BaseName(sDestinationFile) & ".pdf"
      '     Shell cmd Wait  
      '     listview1.Add(listview1.count, sRootDir &/ File.BaseName(sDestinationFile) & ".pdf")
      '     Wait 
      ' Endif
      
      ' If LCase(File.Ext(sFile)) = "rtf" Then    
      '      listview1.Add(listview1.count, sFile)
      ' End If  
      ' End If  
      
   Next
   
End

Public Sub Button1_Click_bak()
   
   Dim sFile As String
   Dim sRootDir As String
   Dim sfile_ext As String
   Dim sFile_stem As String
   Dim x As Integer
   Dim cmd As String 
   Dim sSourceFile As String
   Dim sDestinationFile As String
   
   If Dialog.SelectDirectory() Then Return
   For Each sfile In Dir(Dialog.Path)
      sRootDir = Dialog.Path
      
      If InStr(Lower(sFile), "letter") Then  
         Print modUtil.filepath_fix_Blanks(sRootDir &/ sfile)
         sSourceFile = modUtil.filepath_fix_Blanks(sRootDir &/ sfile)
         sDestinationFile = sRootDir &/ modUtil.Filename_Protect(File.BaseName(sFile)) & "." & File.Ext(Sfile)
         Print sRootDir &/ modUtil.Filename_Protect(File.BaseName(sFile)) & "." & File.Ext(Sfile)
         '  Copy modUtil.filepath_fix_Blanks(sRootDir &/ sfile) To sRootDir &/ modUtil.Filename_Protect(File.BaseName(sFile)) & "." & File.Ext(Sfile)
         cmd = "cp " & sSourceFile & " " & sDestinationFile
         Shell cmd Wait
         cmd = "sh /usr/local/Ted/rtf2pdf.sh " & sDestinationFile & " " & sRootDir &/ File.BaseName(sDestinationFile) & ".pdf"
         Shell cmd Wait  
         listview1.Add(listview1.count, sRootDir &/ File.BaseName(sDestinationFile) & ".pdf")
         Wait 
      Endif
      
      ' If LCase(File.Ext(sFile)) = "rtf" Then    
      '      listview1.Add(listview1.count, sFile)
      ' End If  
      ' End If  
      
   Next
   
End

Public Sub Listview1_Click()

   listview1.MoveCurrent()
   Print sRootDir &/ listview1.Item.Text
   form_pdf.Load_Pdf(listview1.Item.Text)
   
End
