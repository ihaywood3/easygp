' Gambas class file

' Copyright (C) 2008-2014 Dr. Richard Terry
' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.
' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'----------------------------------------------------------------------
'A form to display system wide available shortcuts
'----------------------------------------------------------------------

Private shortcuts_available As Collection
Private form_text_editor As FEditor
Private SpellChecker As ClskSpell
Private form_password As FPassword

Static Private form_shortcuts_available As FShortcutsAvailable

Public Sub Init()
   
   With form_text_editor = New FEditor(VBox_TextEditor)
      .lblHeading.Visible = False
      .tbLoadFile.Visible = False   
   End With
   
   With SpellChecker = New ClskSpell
      .EditorControlToCheck = form_text_editor.teNotes
      .TempFileForSpelling = User.home &/ "myspelltemp.txt"
      .TempFileForErrors = User.home &/ "myspellerrors.txt"
   End With
   Settings_load
   form_shortcuts_available = Me   
   Reload   
   
End

Static Public Sub Reload_Available()
   '-------------------------------------------------------------------------
   'Called by FStaffPreferencesShortCuts after user saves their shortcuts
   'so that if they have shared a shortcut it will update
   '-------------------------------------------------------------------------  
   
   Try form_shortcuts_available.Reload 'if in FClinical this is null
   
End

Public Sub Reload()
   
   Dim Shortcut As Collection
   
   shortcuts_available = modUtil.Copy_Collection_Keyed_Sequentially(modConsultDBI.Shortcuts_Available_Get(modDBConnect.currentUser!fk_clinic))
   lvShortCuts.Clear
   For Each shortcut In shortcuts_available
      lvShortCuts.Add(lvShortCuts.Count, shortcut!shortcut) 
   Next
   If lvShortcuts.count Then
      With lvShortcuts
         .SetFocus
         .Item.Selected = True
      End With
   Endif
   
End

Private Sub Settings_Load()
   
   HSplit_Available_Shortcuts.Layout = Settings["FShortCutsAvailable/HSplit_Available_Shortcuts.layout", modUtilGUI.HSplit([1, 3])]
   
End

Public Sub Settings_Save()
   
   Settings["FShortCutsAvailable/HSplit_Available_Shortcuts.layout"] = HSplit_Available_Shortcuts.Layout
   
End

Public Sub txtFilterText_GotFocus()
   'user can filter the expanded text
   
End

Public Sub lvShortCuts_Select()
   
   With form_text_editor
       .teNotes.RichText = shortcuts_available[lvShortCuts.Key]!expanded
       .DataChange_Update_Indicators(False)
   End With
   
End

Public Sub tbEditAvailable_Click()
   
End

Public Sub EditArea_Buttons_Click()
   
   Select Case Last.tag
      Case "edit"
         If Not modDBConnect.IsAdmin Then   
            Message.title = "Editing System Wide Shortcuts"
            Message.info("Only the Admin user is allowed to edit system wide shortcuts.")
         Else
            With form_password = New FPassword
               .tlPassword.text = "Only the Admin user 'EasyGP is allowed to modify system wide progress note shortcuts. Please enter the password."
               .txtboxPassword.SetFocus
               .ShowModal
            End With
       '     VBox_TextEditor.Enabled = True   
            
         Endif  
      Case "save"
         Available_Shortcuts_Save
   End Select
   
End

Private Sub Available_Shortcuts_Save()
   
   
   
End
