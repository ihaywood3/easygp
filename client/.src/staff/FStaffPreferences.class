' Gambas class file

' Copyright (C) 2008-10 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'----------------------------------------------------------------------
'STAFF PREFERENCES
'
'PURPOSE       Allow staff members to determine how they want the program to behave
'              Tabs are loaded according to role (see admin.lu_roles)
'              For example a doctor who orders requests gets to configure how this behaves
'              but the request config won't be seen by secretaries
'
'DATABASE      
'HOW THIS WORKS:
'                
'BUGS           Probably plenty please email me rterry@pacific.net.au
'             
'TODO          
'             

'-----------------------------------------------------------------------------------------------' 
Private Form_RequestPreferences As FStaffRequestPreferences
Private Form_PrescribingPreferences As FPrescribingPreferences
Private Form_FontsColors As FStaffPreferencesFontsColors
Private Form_GeneralPreferences As FStaffPreferencesClinical
Private Form_Help As FHtmlViewer
Private Form_Workcenter As FStaffInboxPreferences

Private help_dir As String

Private cIconPanel_Section_Fonts As Integer = 0
Private cIconPanel_Section_Pathways As Integer = 1
Private cIconPanel_Section_Clinical As Integer = 2
Private cIconPanel_Section_Prescribing As Integer = 3
Private cIconPanel_Section_Requests As Integer = 4
Private cIconPanel_Section_Workcenter As Integer = 5
Static Private form_staffpreferences As FStaffPreferences

Static Public Sub set_heading(hc As Integer)
   
   form_staffpreferences.heading_set(hc)
   
End

Public Sub heading_set(hc As Integer)
   
   hbox_heading.Background = hc 
   lblSectionHeading.Background = hc
   
End

Public Sub IconPanel1_Click()
   
   Select Case IconPanel1.index
      Case cIconPanel_Section_Fonts
         If IsNull(Form_FontsColors) Then
            With Form_FontsColors = New FStaffPreferencesFontsColors(IconPanel1) 'VBox_FontsColors)
               .Init() 
            End With       
         Endif
         Show_Help("user-preferences-fonts-and-colors.html")
      Case cIconPanel_Section_Clinical
         If IsNull(Form_GeneralPreferences) Then
        With Form_GeneralPreferences = New FStaffPreferencesClinical(IconPanel1)
           .Init()
       End With
          Show_Help("general-staff-preferences.html")
         Endif
      Case cIconPanel_Section_Workcenter
          If IsNull(Form_Workcenter) Then
               With Form_Workcenter = New FStaffInboxPreferences(IconPanel1)
                  .Init()
               End With
          Endif
      Case cIconPanel_Section_Requests
         If IsNull(Form_RequestPreferences) Then
            With Form_RequestPreferences = New FStaffRequestPreferences(IconPanel1)
               .Set_Staff_member(modDBConnect.currentUser!fk_staff)
               .Init()
               .RequestsDefaults_Refresh()
            End With
             Show_Help("user-request-provider-defaults.html")
         Endif
         
   End Select
   
End

Public Sub Show_Help(sHtmlFile As String)
   
   modEditAreaHelpers.Help_Show("user-preferences-fonts-and-colors.html", Form_Help)
   
End Sub

Public Sub Init()
   
   Dim Vbox_RequestPreferences As Vbox
   Dim VBox_PrescribingPreferences As VBox
   help_dir = Application.Path &/ "help/"
  
   
   '---------------------------------------
   'all users get to set their colors/fonts
   '---------------------------------------
   form_staffpreferences = Me
   With Form_Help = New FHtmlViewer(Vbox_Help)
      .tbWebBrowserZoomIn.Visible = True
      .tbWebBrowserZoomOut.Visible = True  
     Try .WebView1.Zoom = Settings["Staff Preferences/Help_Viewer_Zoom"]
   End With
    IconPanel1.index = 0
   IconPanel1_Click()
   ' With Form_FontsColors = New FStaffPreferencesFontsColors(IconPanel1) 'VBox_FontsColors)
   '    .Init() 
   ' End With
   '    With Form_GeneralPreferences = New FStaffPreferencesGeneral(Vbox_GeneralPreferences)
   '        .Init()
   '    End With
   '    Select Case modDBConnect.currentUser!role
   '    
   '     Case "doctor", "sysadmin" 'until I remove myself as sysadmin
   '         TabStrip1.count = 4
   '         '---------------------------------------------------------------------------------------
   '         'New tab on tabstrip for defaults for the inbox, eg. foreground/background color for hl7
   '         '---------------------------------------------------------------------------------------
   '         '-----------------------------------------------------------
   '         'Add a new tabstrip for doctors provider request preferences
   '         '-----------------------------------------------------------
   '         TabStrip1.index = 2
   '         TabStrip1.text = "Default Providers For Requests"
   '         With Vbox_RequestPreferences = New VBox(TabStrip1)
   '              .Expand = True 
   '         End With
   '         With Form_RequestPreferences = New FStaffRequestPreferences(Vbox_RequestPreferences)
   '          .Set_Staff_member(modDBConnect.currentUser!fk_staff)
   '          .Init()
   '          .RequestsDefaults_Refresh()
   '         End With
   '         '-----------------------------------------------------------
   '         'Add a new tabstrip for doctors prescribing preferences
   '         '-----------------------------------------------------------
   '         TabStrip1.index = 3 
   '         TabStrip1.text = "Prescribing Preferences"
   '         With VBox_PrescribingPreferences = New VBox(TabStrip1)
   '              .Expand = True 
   '         End With
   '         With Form_PrescribingPreferences = New FPrescribingPreferences(VBox_PrescribingPreferences)
   '         
   '         End With          
   '     Case "secretary"
   '        IconPanel1.index = 0
   '   End Select
   ' TabStrip1.index = 0
   
End
Public Sub Settings_Load()
   
  Try Form_Help.WebView1.Zoom = Settings["Staff Preferences/Help_Viewer_Zoom"]
   
End

Public Sub Settings_save()
   
 '  Form_RequestPreferences.Settings_save()
 ' Form_FontsColors.Settings_save()
 '  Form_GeneralPreferences.Settings_Save()
   Settings["Staff Preferences/Help_Viewer_Zoom"] = Form_Help.WebView1.Zoom
 
End
