' Gambas class file

' Copyright (C) 2008-2013 Dr. Richard Terry
' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.
' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'----------------------------------------------------------------------
'STAFF PREFERENCES
'
'PURPOSE       Allow staff members to determine how they want the program to behave
'              Tabs are loaded according to role (see admin.lu_roles)
'              For example a doctor who orders requests gets to configure how this behaves
'              but the request config won't be seen by secretaries
'
'                
'BUGS           Probably plenty please email me rterry@pacific.net.au
'             
'TODO          
'             

'-----------------------------------------------------------------------------------------------' 
Private Form_RequestPreferences As FStaffPreferencesRequests
Private Form_PrescribingPreferences As FStaffPreferencesPrescribing
Private Form_FontsColors As FStaffPreferencesFontsColors
Private Form_Clinical_Preferences As FStaffPreferencesClinical
Private Form_Help As FHtmlViewer
'Private Form_Workcenter As FStaffPreferencesWorkCentre
Private Form_LibraryPreferences As FStaffPreferencesLibrary
Private cIconPanel_Section_Clinical As Integer
Private cIconPanel_Section_Fonts As Integer 
Private cIconPanel_Section_Library As Integer 
Private cIconPanel_Section_Prescribing As Integer 
Private cIconPanel_Section_Requests As Integer 
Private cIconPanel_Section_Workcenter As Integer 
Private iCurrent_Section As Integer
Private Obj As Object 
Private TabIcons As New Collection
Private bIniting As Boolean
Private bStopArrange As Boolean

Static Private form_staffpreferences As FStaffPreferences

Static Public Sub set_heading(hc As Integer)
   
   form_staffpreferences.heading_set(hc)
   
End

Public Sub heading_set(hc As Integer)
   
   hbox_heading.Background = hc 
   lblSectionHeading.Background = hc
   
End


Public Sub Init()
   '------------------------------------
   'Build the iconpanel according to role
   '------------------------------------
   
   Dim role As String
   Dim tabnames As New String[]
   Dim x As Integer
   
   biniting = True
   form_staffpreferences = Me
   With Form_Help = New FHtmlViewer(Vbox_Help)
      .tbWebBrowserZoomIn.Visible = True
      .tbWebBrowserZoomOut.Visible = True  
      Try .WebView1.Zoom = Settings["Staff Preferences/Help_Viewer_Zoom"]
   End With
   tabicons.add("tabicons/24/desktop_2424.png", "Clinical")
   tabicons.add("tabicons/22/font22x22.png", "Fonts & Colors")
   tabicons.add("tabicons/32/centigrade_pills3232.png", "Prescribe")
   tabicons.add("tabicons/22/emblem-office.png", "Library")
   tabicons.add("tabicons/16/bloodtube16x16.png", "Requests")
   tabicons.add("tabicons/22/scanner.png", "Workcentre")
   '------------------------
   'What is the staff role?
   '-----------------------
   If modDBConnect.IsAdmin Then
      role = "sysadmin"
      ' currently this just doesn't make sense for the sysadmin
      Return
   Else
      role = modDBConnect.currentUser!role
   Endif
   Select Case role 
      Case "doctor", "doctor - assistant"
         tabnames.Add("Clinical")
         tabnames.Add("Fonts & Colors")
         tabnames.Add("Prescribe")
         tabnames.Add("Library")
         tabnames.Add("Ordering")
      '   tabnames.Add("Workcentre")
         
         cIconPanel_Section_Clinical = 0
         cIconPanel_Section_Fonts = 1
         cIconPanel_Section_Prescribing = 2
         cIconPanel_Section_Library = 3
         cIconPanel_Section_Requests = 4
      '   cIconPanel_Section_Workcenter = 5
      Case "secretary", "practice manager"  
         tabnames.Add("Fonts & Colors")
         cIconPanel_Section_Fonts = 0
      Case "sysadmin"
         tabnames.Add("Prescribe")
         tabnames.Add("Library")
         tabnames.Add("Ordering")
      '   tabnames.Add("Workcentre")

         cIconPanel_Section_Prescribing = 0
         cIconPanel_Section_Library = 1
         cIconPanel_Section_Requests = 2
      '   cIconPanel_Section_Workcenter = 3
   End Select
   '------------------------------------------------------
   'Ok, have the particular tabs for each role, build them
   '-------------------------------------------------------
   IconPanel2.count = tabnames.Count 
   For x = 0 To tabnames.Count - 1
      With iconpanel2
         .index = x
         .text = tabnames[x]
         Try .picture = Picture.Load(tabicons[tabnames[x]])
         IconPanel_Add_Section(.text)
      End With 
   Next
   Try Settings_Load()
   IconPanel2.index = 0
   IconPanel2_Click()
   bIniting = False  
End

Public Sub IconPanel2_Click()
   '------------------------------------------------------
   'User has clicked on one of the icons in the icon panel
   'Try and save any un-saved data on the previous tab
   '------------------------------------------------------
    Select Case IconPanel2.index
      Case cIconPanel_Section_Fonts
         obj = Form_FontsColors
         Form_Help.Help_Show("user-preferences-fonts-and-colors.html")
      Case cIconPanel_Section_Clinical
         Form_Help.Help_Show("staff-preferences---clinical.html")
         obj = Form_Clinical_Preferences
      Case cIconPanel_Section_Prescribing
         Form_Help.Help_Show("staff-preferences---prescribing.html")
         obj = Form_Clinical_Preferences
      ' Case cIconPanel_Section_Workcenter
      '    Form_Help.Help_Show("staff-preferences---workcenter.html")
      '    obj = Form_Workcenter
      Case cIconPanel_Section_Library
         Form_Help.Help_Show("staff-preferences---library.html")
         obj = Form_LibraryPreferences
      Case cIconPanel_Section_Requests
         Form_Help.Help_Show("staff-preferences-ordering.html")
         obj = Form_RequestPreferences
   End Select
 Catch
 Return 'short term error catch removed save from fStaffPreferences  
End

Public Sub IconPanel_Add_Section(sSection As String) 
   '-------------------------------
   'Adds a section to the iconpanel
   '-------------------------------   

   Select Case sSection
      Case "Fonts & Colors"
         With Form_FontsColors = New FStaffPreferencesFontsColors(IconPanel2) 'VBox_FontsColors)
            .Init() 
            .Background = Me.Background
         End With       
      Case "Clinical"
         With Form_Clinical_Preferences = New FStaffPreferencesClinical(IconPanel2)
            .Init()
            .Background = Me.Background
         End With
      Case "Prescribe"
         With Form_PrescribingPreferences = New FStaffPreferencesPrescribing(IconPanel2)
            .Init() 
            .Background = Me.Background
         End With 
      ' Case "Workcentre"
      '    With Form_Workcenter = New FStaffPreferencesWorkCentre(IconPanel2)
      '       .Init()
      '       .Background = Me.Background
      '    End With
      Case "Library"
         With Form_LibraryPreferences = New FStaffPreferencesLibrary(IconPanel2)
            .Init()
            .Background = Me.Background
         End With
      Case "Ordering"
         With Form_RequestPreferences = New FStaffPreferencesRequests(IconPanel2)
            .Set_Staff_member(modDBConnect.currentUser!fk_staff)
            .Init()
            .Background = Me.Background
            .Reload()
         End With
   End Select
   
End


Private Sub Settings_Load()
   
   Form_Help.WebView1.Zoom = Settings["FStaffPreferences/Help_Viewer_Zoom", 1.0]
   HSplit_Main.Layout = Settings["FStaffPreferences/HSplit_Main.Layout", modUtil.HSplit([809, 902])]
   
End

Public Sub Settings_save()
   
   Form_RequestPreferences.Settings_save()
   Settings["FStaffPreferences/Help_Viewer_Zoom"] = Form_Help.WebView1.Zoom
   Settings["FStaffPreferences/HSplit_Main.Layout"] = HSplit_Main.Layout

End




