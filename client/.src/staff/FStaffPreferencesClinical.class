' Gambas class file

'
' Copyright (C) 2008-11 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'----------------------------------------------------------------------
'PURPOSE    Allow user to set their peferences for how the clinical section behaves
'----------------------------------------------------------------------------------
Private bExit As Integer 
Private Settings_Section As String 
Private bShowPatientPicture As Boolean
Private bPatientListUsePhotoID As Boolean
Private bPatientForceConfirm As Boolean
Private Form_Toolbar_Config As FConfigToolbar
Private ToolButtons As Collection
Private bDataChanged As Boolean

Public Sub Init()
   '----------------------------------------------------------------------------
   'Set up gui, load currently used toolbuttons and default values if they exist
   '----------------------------------------------------------------------------
   lblMeasure.text = "  Enforce Confirm Identity  "
   modEditAreaHelpers.Resize_labels(Vbox_EditArea_Inner, lblMeasure)
   Toolbuttons = modAdminDBI.Clinical_Toolbuttons_Get(modDBConnect.currentUser!fk_staff)
   With Form_Toolbar_Config = New FConfigToolbar(Vbox_ToolBarconfig)
      .Init("", Toolbuttons)
   End With
 
   chkShowPatientPicture.value = modAdminDBI.Config_Get_Staff_Member("clinical_show_patient_photo", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) 
   If modAdminDBI.Config_Get_Staff_Member("clinical_use_photo_id", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbPhotoID.Value = True
   Else
      rbPhotoID.value = False  
   Endif
   If modAdminDBI.Config_Get_Staff_Member("clinical_enforce_confirm_id", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbConfirmIdentityYes.Value = True
   Else
      rbConfirmIdentityYes.Value = True
   Endif
   cmbStartUpTab.index = cmbStartUpTab.Find(modAdminDBI.Config_Get_Staff_Member("clinical_startup_tab", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff))
End 

Public Sub Save()
   
   If bDataChanged Then
      modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "clinical_show_patient_photo", CBool(chkShowPatientPicture.value), modDBConnect.currentUser!fk_staff) 
      modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "clinical_use_photo_id", bPatientListUsePhotoID, modDBConnect.currentUser!fk_staff) 
      modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "clinical_enforce_confirm_id", bPatientForceConfirm, modDBConnect.currentUser!fk_staff)
      modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "clinical_startup_tab", cmbStartUpTab.Text, modDBConnect.currentUser!fk_staff) 
      modDBConnect.CommitTrans()
   End If    

End



Public Sub EditAreaCheckBox_Click()

   If bExit Then Return 
   Select Case Last.tag
      Case "show patient picture"
         If Last.value = True Then
            bShowPatientPicture = True
         Else
            bShowPatientPicture = False 
         End If    
   End Select
   
   bDataChanged = True  
   
End

Public Sub rbEditArea_Click()

   If bexit Then Return 
   Select Case Last.tag
      Case "simple list"
         bPatientListUsePhotoID = False
      Case "photo id"
         bPatientListUsePhotoID = True 
      Case "confirm yes"
         bPatientForceConfirm = True
      Case "confirm no"
         bPatientForceConfirm = False  
   End Select
   bDataChanged = True  
   
End

Public Sub cmbStartUpTab_Click()
   
   bDataChanged = True  
   
End
