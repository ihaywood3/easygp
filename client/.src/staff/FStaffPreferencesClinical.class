' Gambas class file

'
' Copyright (C) 2008-2016 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'-----------------------------------------------------------------------------------
'PURPOSE    Allow user to set their peferences for how the clinical section behaves
'TO ADD NEW PARAMAMETERS   Add your radiobuttons to the gui
'                          Add your saving code in rbEditArea_Click()
'                          Add your code to display this when program runs in Init()
'                          To call this parameter elsewhere in program use 
'                          modAdminDBI.Config_Get_Staff_Member(Param... defaults etc)
'TO ADD TOOLBUTTONS IN FCLINICAL - user education
'                                - right clicking on the toolbutton area > popup
'-----------------------------------------------------------------------------------
Private bExit As Integer
Private Form_Toolbar_Config As FConfigToolbar
Private ToolButtons As Collection

Public Sub Init()
   '----------------------------------------------------------------------------
   'Set up gui, load currently used toolbuttons and default values if they exist
   '----------------------------------------------------------------------------
   
   bExit = True
   lblMeasure.text = "  Multi Column Team Care Arrangements  "
   modEditAreaHelpers.Resize_labels(Vbox_EditArea_Inner, lblMeasure)
   Toolbuttons = modAdminDBI.Clinical_Toolbuttons_Get(modDBConnect.currentUser!fk_staff)
   
   chkShowPatientPicture.value = modAdminDBI.Config_Get_Staff_Member("clinical_show_patient_photo", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff)
   If modAdminDBI.Config_Get_Staff_Member("clinical_use_photo_id", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbUsePhotoIDYes.Value = True
   Else
      rbUsePhotoIDNo.value = True
   Endif
   If modAdminDBI.Config_Get_Staff_Member("referrals_allow_save_unfinished_letters", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbAllowUnfinishedLettersYes.Value = True
   Else
      rbAllowUnfinishedLettersNo.value = True
   Endif
   If modAdminDBI.Config_Get_Staff_Member("progress_notes_enforce_coding", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbEnforceProgressNoteCodingYes.Value = True
   Else
      rbEnforceProgressNoteCodingNo.value = True
   End If   
   If modAdminDBI.Config_Get_Staff_Member("multi-column-health-summary", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbMultiColumnHealthSummaryYes.value = True
   Else
      rbMultiColumnHealthSummaryNo.Value = True 
   Endif
   If modAdminDBI.Config_Get_Staff_Member("clinical_enforce_confirm_id", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbConfirmIdentityYes.Value = True
   Else
      rbConfirmIdentityNo.value = True
   Endif
   If modAdminDBI.Config_Get_Staff_Member("multi-column-team-care-arrangements", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbMultiColumnTeamCareArrangementYes.value = True
   Else
      rbMultiColumnTeamCareArrangementNo.Value = True 
   Endif
   If modAdminDBI.Config_Get_Staff_Member("multi-column-gpmp", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbMultiColumnGPMPYes.value = True
   Else
      rbMultiColumnGPMPNo.Value = True 
   Endif
   If modAdminDBI.Config_Get_Staff_Member("health-summaries-providers-have-headings", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbGPMPProvidersHaveHeadingsYes.value = True
   Else
      rbGPMPProvidersHaveHeadingsNo.Value = True 
   Endif
   
   'if "inr_point_of_care_testing" is true the FINR the inr management module won't automatically load hl7 lab values by default
   If modAdminDBI.Config_Get_Staff_Member("inr_point_of_care_testing", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbINRPointOfCareTestingYes.value = True
   Else
      rbINRPointOfCareTestingNo.Value = True
   End If
   If modAdminDBI.Config_Get_Staff_Member("show-edit-last-consult-button", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbEditLastConsultButtonYes.value = True
   Else
      rbEditLastConsultButtonNo.value = True 
   Endif
   If modAdminDBI.Config_Get_Staff_Member("print-tca-consent-forms", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbPrintTCAConsentFormsYes.value = True
   Else
      rbPrintTCAConsentFormsNo.value = True
   End If   
   'spelling stuff
   If modAdminDBI.Config_Get_Staff_Member("spelling-prescriptions", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbSpellCheckPrescriptionsYes.value = True
   Else
      rbSpellCheckPrescriptionsNo.value = True
   End If   
   If modAdminDBI.Config_Get_Staff_Member("spelling-requests", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbSpellCheckRequestsYes.value = True
   Else
      rbSpellCheckRequestsNo.value = True
   End If  
   If modAdminDBI.Config_Get_Staff_Member("spelling-health-issues", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbSpellCheckHealthIssuesYes.value = True
   Else
      rbSpellCheckHealthIssuesNo.value = True
   End If  
   If modAdminDBI.Config_Get_Staff_Member("centrelink-form-use-pre-printed", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbCentreLinkFormPlainPaperYes.value = True
   Else
      rbCentreLinkFormPlainPaperNo.value = True
   End If  
   'If yes, then the FStaffTasks in FClinical will let user enter only the 'What to do' line
   If modAdminDBI.Config_Get_Staff_Member("clinical-screen-task-restricted-entry", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff) Then
      rbTasksInClinicalRestrictedEntryYes.value = True
   Else
      rbTasksInClinicalRestrictedEntryNo.value = True
   End If  

   HBox_SpellCheckText.Height = tlSpellCheckText.Height
   cmbStartUpTab.index = cmbStartUpTab.Find(modAdminDBI.Config_Get_Staff_Member("clinical_startup_tab", False, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff))
   cmbNotesDisplay.index = modAdminDBI.Config_Get_Staff_Member("notes_date_display_order", 0, Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff)
   bexit = False
   
End

Public Sub rbEditArea_Click()
   '-------------------------------------------------------
   'User has clicked on a radiobutton in the editing area
   'to set how the parameters will work in clinical section
   '-------------------------------------------------------
   
   Dim sINRMessageTitle As String = "INR Testing Method"
   Dim sINRMessage As String = "The changes to the method of INR testing will not be applied until you close and restart EasyGP"
   
   If bexit Then Return
   Select Case Last.tag
         ' Case "use photo id yes"
         '    modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "clinical_use_photo_id", True, modDBConnect.currentUser!fk_staff)
         ' Case "use photo id no"
         '    modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "clinical_use_photo_id", False, modDBConnect.currentUser!fk_staff)
      Case "force confirm patient identity yes"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "clinical_enforce_confirm_id", True, modDBConnect.currentUser!fk_staff)
      Case "force confirm patient identity no"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "clinical_enforce_confirm_id", False, modDBConnect.currentUser!fk_staff)
      Case "allow unfinished letters yes"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "referrals_allow_save_unfinished_letters", True, modDBConnect.currentUser!fk_staff)
      Case "allow unfinished letters no"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "referrals_allow_save_unfinished_letters", False, modDBConnect.currentUser!fk_staff)
      Case "progress note coding yes"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "progress_notes_enforce_coding", True, modDBConnect.currentUser!fk_staff)
         FClinical.ProgressNotesEnforceCoding_UpdateFlag(True)
      Case "progress note coding no"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "progress_notes_enforce_coding", False, modDBConnect.currentUser!fk_staff)
         FClinical.ProgressNotesEnforceCoding_UpdateFlag(False) 'fixme does not work "illegal instruction" ?why
      Case "inr test with external laboratory"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "inr_point_of_care_testing", False, modDBConnect.currentUser!fk_staff)
         Goto Message_user
      Case "inr test in office"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "inr_point_of_care_testing", True, modDBConnect.currentUser!fk_staff)
         Goto Message_user
      Case "multi column health summary no"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "multi-column-health-summary", False, modDBConnect.currentUser!fk_staff)
      Case "multi column health summary yes"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "multi-column-health-summary", True, modDBConnect.currentUser!fk_staff)
      Case "multi column health tca no"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "multi-column-team-care-arrangements", False, modDBConnect.currentUser!fk_staff)
      Case "multi column tca yes"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "multi-column-team-care-arrangements", True, modDBConnect.currentUser!fk_staff)
      Case "multi column tca no"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "multi-column-team-care-arrangements", False, modDBConnect.currentUser!fk_staff)
      Case "multi column gpmp yes"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "multi-column-gpmp", True, modDBConnect.currentUser!fk_staff)
      Case "multi column gpmp no"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "multi-column-gpmp", False, modDBConnect.currentUser!fk_staff)
      Case "provider headings yes"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "health-summaries-providers-have-headings", True, modDBConnect.currentUser!fk_staff)
      Case "provider headings no"   
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "health-summaries-providers-have-headings", False, modDBConnect.currentUser!fk_staff)
      Case "edit last consult button yes"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "show-edit-last-consult-button", True, modDBConnect.currentUser!fk_staff)
         FClinical.EditLastConsultButton_Display(True)
      Case "edit last consult button no"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "show-edit-last-consult-button", False, modDBConnect.currentUser!fk_staff)
         FClinical.EditLastConsultButton_Display(False)
      Case "print tca consent forms no"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "print-tca-consent-forms", False, modDBConnect.currentUser!fk_staff)
      Case "print tca consent forms yes"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "print-tca-consent-forms", True, modDBConnect.currentUser!fk_staff)
      Case "prescription spelling yes"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "spelling-prescriptions", True, modDBConnect.currentUser!fk_staff)
      Case "prescription spelling no"    
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "spelling-prescriptions", False, modDBConnect.currentUser!fk_staff)
      Case "request spelling yes"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "spelling-requests", True, modDBConnect.currentUser!fk_staff)
      Case "request spelling no"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "spelling-requests", False, modDBConnect.currentUser!fk_staff)
      Case "health issue spelling yes"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "spelling-health-issues", True, modDBConnect.currentUser!fk_staff)
      Case "health issue spelling no"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "spelling-health-issues", False, modDBConnect.currentUser!fk_staff)
      Case "centrelink form pre-printed yes"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "centrelink-form-use-pre-printed", True, modDBConnect.currentUser!fk_staff)
      Case "centrelink form pre-printed no"  
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "centrelink-form-use-pre-printed", False, modDBConnect.currentUser!fk_staff)
      Case "task restricted entry yes"
         modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "clinical-screen-task-restricted-entry", True, modDBConnect.currentUser!fk_staff)
      Case "task restricted entry no"  
          modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "clinical-screen-task-restricted-entry", False, modDBConnect.currentUser!fk_staff)
   End Select
   modDBConnect.CommitTrans()
   modAdminDBI.Prefs_Staff_Reset
   Return
   
Message_user:
   Message.Title = sINRMessageTitle
   Message.Info(sINRMessage)
   
End

Public Sub cmbStartUpTab_Click()
   
   If bexit Then Return
   modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "clinical_startup_tab", cmbStartUpTab.Text, modDBConnect.currentUser!fk_staff)
   modDBConnect.CommitTrans
   modAdminDBI.Prefs_Staff_Reset
   
End

Public Sub cmbNotesDisplay_Click()
   
   If bexit Then Return
   modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "notes_date_display_order", cmbNotesDisplay.index, modDBConnect.currentUser!fk_staff)
   modDBConnect.CommitTrans
   modAdminDBI.Prefs_Staff_Reset
   const.iClinicalNotesDisplayOrder = cmbNotesDisplay.Index
   
End


