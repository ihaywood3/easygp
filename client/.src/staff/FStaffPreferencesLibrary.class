' Gambas class file

' Copyright (C) 2008-2013 Dr. Richard Terry
' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.
' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'---------------------------------------------------------------------------------
'PURPOSE    Allow user to set their peferences for how the library section behaves
'---------------------------------------------------------------------------------
Private bDataChanged As Boolean
Private bExit As Boolean

Public Sub Form_Open()
   
   Init()
   
End

Public Sub Form_Leave()

   If bexit Then Return     
   Save()
   
End

Public Sub Init()
   
   bExit = True
   lblmeasure.text = "  Path to Patient Handout Files (local)  "
   modEditAreaHelpers.Resize_labels(Vbox_EditArea, lblmeasure)
   Try txtLibraryPathLocal.text = modAdminDBI.Config_Get_Staff_Member("library_directory_local", "", Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff)
   Try txtHandoutDirectoryLocal.text = modAdminDBI.Config_Get_Staff_Member("handout_directory_local", "", Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff)
   Try txtLibraryHomePage.text = modAdminDBI.Config_Get_Staff_Member("library_default_home_page", "", Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff)
   
   bExit = False
   
End

Public Function Save() As Boolean
   
   Dim smsg As String
   
   If Not IsDir(Trim(txtLibraryPathLocal.text)) Then
      smsg = "Please supply a valid path for the location of the library files on your local computer.\n\nThis file path is used as a fall back if the network is unavailable.\n\n"
      smsg &= "You may browse for a file path by clicking the browse button next to this textbox."
      Message.Info(sMsg)
      txtLibraryPathLocal.SetFocus()
      Return False
   Endif
   ' If Not IsDir(Trim(txtHandoutDirectoryLocal.text)) Then
   '     smsg = "Please supply a valid path for the location of the patient handout files on your local computer.\n\nThis file path is used as a fall back if the network is unavailable.\n\n"
   '     smsg &= "You may browse for a file path by clicking the browse button next to this textbox."
   '     Message.Info(sMsg)
   '     txtHandoutDirectoryLocal.SetFocus()
   '     Return
   ' Endif
   If bDataChanged Then
      modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "library_directory_local", Trim(txtLibraryPathLocal.text), modDBConnect.currentUser!fk_staff)
      '   modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "handout_directory_local", Trim(txtHandoutDirectoryLocal.text), modDBConnect.currentUser!fk_staff)
      modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "library_default_home_page", Trim(txtLibraryHomePage.text), modDBConnect.currentUser!fk_staff)
      modDBConnect.CommitTrans()
      Return True
   End If
   
End

Public Sub EditArea_TextBox_Change()
   
   If bExit Then Return
   bDataChanged = True
   
End

Public Sub EditArea_Buttons_Click()
   
   Dim hctrl As Control
   Dim aTextbox As TextBox

   bexit = True   
   If Dialog.SelectDirectory() Then 
      bexit = False  
      Return
   End If   
   For Each hctrl In Last.parent.children
      If hctrl Is Textbox Then
         bexit = False  
         aTextbox = hctrl
         aTextbox.text = Dialog.Path
         Break
      End If
   Next
   
End

Public Sub EditArea_TextBox_GotFocus()
   
End
