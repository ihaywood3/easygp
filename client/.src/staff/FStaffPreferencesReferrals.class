' Gambas class file

' Copyright (C) 2008-2013 Dr. Richard Terry

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'-----------------------------------------------------------------------
'Set preferences for the referrals section
'-----------------------------------------------------------------------
Public Sub Init()
   '-----------------------------------------
   'Set the default referral template for tex   
   '-----------------------------------------     

   modEditAreaHelpers.Resize_labels(Vbox_EditArea, lblmeasure)
   Try txtReferralLatexTemplate.text = modAdminDBI.Config_Get_Staff_Member("tex-referral_template_user", "", Null, modDBConnect.currentUser!fk_clinic, modDBConnect.currentUser!fk_staff)
   If Trim(txtReferralLatexTemplate.text) <> "" Then
     Try Display_Template
   Endif
End

Public Sub Display_Template()
   Dim sLetterTeX As String
 '  sLetterTeX = modUtil.Find_File("templates/" & Trim(txtReferralLatexTemplate.text))
   sLetterTeX = File.Load(txtReferralLatexTemplate.text) 
   FStaffPreferences.PDF_Load(modPrinting.Latex_To_PDF(sLetterTeX))
End

Public Sub ToolButton1_Click()
   '------------------------------------------
   'Save the default referral template for tex
   '------------------------------------------  

   Dim sLetterTeX As String
   
   If Dialog.OpenFile() Then Return                                           'popup a file dialog to get filename and path
   txtReferralLatexTemplate.text = Dialog.path                     'put just the filename in the textbox and sagve the config param
   modAdminDBI.Config_Save_staff_member(modDBConnect.currentUser!fk_clinic, "tex-referral_template_user", Dialog.path, modDBConnect.currentUser!fk_staff)
   sLetterTeX = File.Load(Dialog.path)                                        'grab the tex
   FStaffPreferences.PDF_Load(modPrinting.Latex_To_PDF(sLetterTeX))
   
                                      
   
End

