' Gambas class file

' This program is free software: you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation, either version 3 of the License, or
' (at your option) any later version.

' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.

' You should have received a copy of the GNU General Public License
' along with this program.  If not, see <http://www.gnu.org/licenses/>.
'--------------------------------------------------------------------------------
'Original Code courtesy of Rolf Schmidt <rolf.frogs@t-online.de>
'English translation by Horst Herb  Horst Herb <my.list.subscriptions@gmail.com>
'Modifications to the original gambas2 GUI rterry@pacific.net.au
'--------------------------------------------------------------------------------
Private firstNumber As String   
Private secondNumber As String
Private Operator As String
Private ColonSet As Boolean

Public Sub Form_Open()
  firstNumber = "0"
  secondNumber = "0"
  Operator = ""
  Me.Center
End

' Process entered operator
Private Sub calculate(what As String)
  If what <> "="
    Operator = what
    secondNumber = "0"
   ' Ausgabe means output. I suppose "Ausgabe" represents a dialog element, so I have not translated it
   ' Ausgabe.Text = "0" 
  Else 
    ' Execute calculations
    Select Operator
      Case "+"
        Ausgabe.Text = (CStr(CFloat(firstNumber) + CFloat(secondNumber)))
      Case "-"
        Ausgabe.Text = (CStr(CFloat(firstNumber) - CFloat(secondNumber)))
      Case "X"
        Ausgabe.Text = (CStr(CFloat(firstNumber) * CFloat(secondNumber)))
      Case "/"
        Ausgabe.Text = (CStr(CFloat(firstNumber) / CFloat(secondNumber)))
    End Select
    firstNumber = "0"
    secondNumber = "0"
    Operator = ""
  End If
  Catch 
    Ausgabe.Text = "Error"
End

' Process entered numbers
Private Sub numbers(ziffer As String)
  If ziffer = ","
    ziffer = "."
  End If
  If Operator = "" ' Still input of the first number
    If firstNumber = "0" And Ziffer <> "."
      firstNumber = ""
    End If
    firstNumber = firstNumber & ziffer
    Ausgabe.Text = firstNumber
  Else
    If secondNumber = "0" And Ziffer <> "."
      secondNumber = ""
    End If
    secondNumber = secondNumber & ziffer
    Ausgabe.Text = secondNumber
  End If
End

' Enter numbers via mouse click
Public Sub Tasten1_Click()
  numbers(Last.Text)
  
  lblCalculation.text &= Last.text
End

' Enter operators via mouse click
Public Sub Tasten2_Click()
   calculate(Last.Text)
   lblCalculation.text &= " " & Last.text & " " 
End

' The keyboard interface
Public Sub Form_KeyPress()

  If Key.Code >= 48 And Key.Code <= 59 Or Key.Code = 44 Or Key.Code = 46
    numbers(Chr(Key.Code))
  End If
  If Key.Code = 42 Or Key.Code = 43 Or Key.Code = 45 Or Key.Code = 47 Or Key.Code = 61
    calculate(Chr(Key.Code))
  Endif 
  Select Key.Code
    Case 4100
      calculate("=")
    Case 67
      Button_C_Click
    Case 69
      Button_CE_Click
    End Select 
End

Public Sub Button_C_Click()

  firstNumber = "0"
  secondNumber = "0"
  Operator = ""
  Ausgabe.Text = "0"
  lblCalculation.text = ""
End

Public Sub Button_CE_Click()

  secondNumber = "0"
  Ausgabe.Text = "0"

End

Public Sub tbClose_Click()

   Me.Close()

End


